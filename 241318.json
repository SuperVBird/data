{"id":241318,"link":"https://chinadigitaltimes.net/chinese/2012/07/翻墙-centos下安装配置pptp-vpn服务器及常见问题/","date":"2012-07-21T02:30:25Z","modified":"2012-07-21T02:30:25Z","title":"翻墙 | CentOS下安装配置PPTP VPN服务器及常见问题","content":"<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://teaker.wordpress.com/2012/07/15/centos%E4%B8%8B%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEpptp-vpn%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%8A%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/\">http://teaker.wordpress.com/2012/07/15/centos%e4%b8%8b%e5%ae%89%e8%a3%85%e9%85%8d%e7%bd%aepptp-vpn%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%8f%8a%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98/</a></p>\n<div></div>\n<div>\n<p>VPN的英文全称是&#8221;Virtual Private Network&#8221;，中文翻译是&#8221;虚拟专用网络&#8221;。虚拟专用网络我们可以把它理解成是虚拟出来的企业内部专线。它可以通过特殊的加密的通讯协议在连接在Internet上的位于不同地方的两个或多个企业内部网之间建立一条专有的通讯线路，就好比是架设了一条专线一样，但是它并不需要真正的去铺设光缆之类的物理线路。这就好比去电信局申请专线，但是不用给铺设线路的费用，也不用购买路由器等硬件设备。VPN技术原是路由器具有的重要技术之一，目前在交换机，防火墙设备或Windows等软件里也都支持VPN功能，一句话，VPN的核心就是在利用公共网络建立虚拟私有网。</p>\n<p>虚拟专用网（VPN）被定义为通过一个公用网络（通常是因特网）建立一个临时的、安全的连接，是一条穿过混乱的公用网络的安全、稳定的隧道。虚拟专用网是对企业内部网的扩展。虚拟专用网可以帮助远程用户、公司分支机构、商业伙伴及供应商同公司的内部网建立可信的安全连接，并保证数据的安全传输。虚拟专用网可用于不断增长的移动用户的全球因特网接入，以实现安全连接；可用于实现企业网站之间安全通信的虚拟专用线路，用于经济有效地连接到商业伙伴和用户的安全外联网虚拟专用网。</p>\n<p>PPTP全称为Point to Point Tunneling Protocol ― 点到点隧道协议，是VPN协议中的一种。</p>\n<p> 一、CentOS 5.x/6.x下PPTP VPN服务器安装</p>\n<p>1、安装相关软件包<br />32位版：<br /># yum install -y ppp libpcap iptables<br /># wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.i386.rpm\">http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.i386.rpm</a><br /> # rpm -ivh pptpd-1.3.4-2.rhel5.i386.rpm<br />64位版：<br /># yum install -y ppp libpcap iptables<br /># wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.x86_64.rpm\">http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.x86_64.rpm</a><br /> # rpm -ivh pptpd-1.3.4-2.rhel5.x86_64.rpm</p>\n<p>2、配置文件编写<br />①、配置文件/etc/ppp/options.pptpd<br /># mv /etc/ppp/options.pptpd /etc/ppp/options.pptpd.bak<br /> # vim /etc/ppp/options.pptpd<br />输入以下内容：</p>\n<p>name pptpd<br />refuse-pap<br />refuse-chap<br />refuse-mschap<br />require-mschap-v2<br />require-mppe-128<br /> proxyarp<br />lock<br />nobsdcomp<br />novj<br />novjccomp<br />nologfd<br />idle 2592000<br />ms-dns 8.8.8.8<br />ms-dns 8.8.4.4<br />#这里的DNS可以查看服务器本机使用的DNS地址。</p>\n<p> ②、配置文件# /etc/ppp/chap-secrets<br /># mv /etc/ppp/chap-secrets /etc/ppp/chap-secrets.bak<br /># vim /etc/ppp/chap-secrets<br />输入以下内容</p>\n<p># Secrets for authentication using CHAP<br /> # client server secret IP addresses<br />myusername pptpd mypassword *</p>\n<p>注：这里的myusername和mypassword即为PPTP VPN的登录用户名和密码， 改成你自己的。</p>\n<p> ③、配置文件/etc/pptpd.conf<br /># mv /etc/pptpd.conf /etc/pptpd.conf.bak<br /># vim /etc/pptpd.conf<br />输入以下内容：</p>\n<p>option /etc/ppp/options.pptpd<br /> logwtmp<br />localip 192.168.80.1<br />remoteip 192.168.80.11-30</p>\n<p>注：为拨入VPN的用户动态分配192.168.80.11～192.168.80.30之间的IP</p>\n<p> ④、配置文件/etc/sysctl.conf<br /># vim /etc/sysctl.conf<br />修改以下内容：<br />net.ipv4.ip_forward = 1<br />保存、退出后执行：<br />sysctl -p</p>\n<p>3、启动PPTP VPN 服务器端：<br /> # /etc/init.d/pptpd start</p>\n<p>4、设置iptables规则并重启：<br /># vim /etc/sysconfig/iptables<br />加入下列规则：</p>\n<p> -A RH-Firewall-1-INPUT -p tcp -m state �state NEW -m tcp �dport 1723 -j ACCEPT<br />-A POSTROUTING -s <a rel=\"nofollow\" target=\"_blank\" href=\"http://192.168.80.0/255.255.255.0\">192.168.80.0/255.255.255.0</a> -o eth0 -j MASQUERADE</p>\n<p> 重启防火墙：<br /># /etc/init.d/iptables start</p>\n<p>PPTP VPN服务器接入常见问题总结：</p>\n<p> 1、VPN客户端拨入时出现721错误：</p>\n<p>这种情况大数多原因为客户系统，如果为WINXP并且安装了SP2，则可能会出现这种情况，解决方法为：修改注册表HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlClass4D36E972-E325-11CE-BFC1-08002bE10318，其中其中 是 WAN 微型端口 (PPTP) 驱动程序的网络适配器，在此项中新建一个DWORD 值ValidateAddress，然后设置为0即可。<br /> 服务器端PPP协议配置不正确也会导致此类错误。</p>\n<p>2、VPN客户端拨入时出现800错误：</p>\n<p> 这种情况大数多原因为客户系统连接服务器时使用域名，因临时DNS无法解析而出现这种错误，可更换DNS试一下，如果还是出错此类错误，则可能是无法连接到VPN服务器，可能是VPN服务器关闭或出现故障，也可能是客户电脑上的防火墙阻止了VPN连接请求，可关闭防火墙试一下。<br />有些使用中转服务器连接到VPN服务器的客户端，也可能出现此类错误，原因为中转服务器中转功能出现故障。</p>\n<p> 3、VPN客户端拨入时出现619错误：</p>\n<p>这种情况大数多原因为客户机连接Internet的网关（如家庭宽带路由或公司上网网关路由或防火墙）NAT-T功能关闭或对VPN支持性不好，主要是对GRE及PPTP协议的NAT-T不支持。可打开网关路由的NAT-T功能，如果还是出现错误，则需要更换网关设备，现在市面上大多数设备已经支持。</p>\n<p>4、VPN客户端拨入时出现691错误：</p>\n<p>这种情况大数多原因为客户机连接VPN服务器异常中断，因多数服务器限制一个帐户同时只有一个人使用，所以一旦异常断开，则需等待3分钟左右。有些VPN服务器没有设置异常断线检查功能也可能导致用户一旦异常断开后很长时间不能连接。所以解决办法为在服务器上设置异常断线检查程序或功能。</p>\n<p>5、VPN客户端拨入时出现733错误：</p>\n<p>这种情况大数多原因为客户机拨入VPN服务器后无法获取IP地址，可修复DHCP服务器或设置静态IP地址或地址池。</p>\n<p>6、VPN客户端拨入时出现734 ppp链接控制协议终止：</p>\n<p>这种情况多数为VPN服务器配置有问题，如果是PPP配置有问题，不支持MPPE加密或支持度不好。请重新编译PPP及MPPE相关程序。对于用于游戏代理的用户，可不使用加密（需在服务器端不要求加密）。</p>\n<p>7、VPN客户端拨入时出现718错误：</p>\n<p>拨入时用户名和密码出错误，有时也因为服务器端认证服务出现故障。</p>\n<p></div>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\" https://mycdt0.info\"> https://mycdt0.info</a>，穿墙访问《中国数字时代》（当看到“此网站的安全证书有问题”的提示时，请选择“继续浏览此网站(不推荐)”，忽略证书警告并继续访问网站）。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-5261101383726054579?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/mstlf\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[7775,8510,8795]}