{"id":244698,"link":"https://chinadigitaltimes.net/chinese/2012/08/翻墙-如何不受dns污染/","date":"2012-08-02T16:45:20Z","modified":"2012-08-02T16:45:20Z","title":"翻墙 | 如何不受DNS污染","content":"<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.iroowe.com/fuck_the_dns_pullution/\">http://www.iroowe.com/fuck_the_dns_pullution/</a></p>\n<div></div>\n<div>\n<p>这个话题，也是一直想写，现在有点时间了，就顺便写下吧，备忘和科普用吧。PS：使用此技能必须有个可用的VPN。没有的话，污染无解。还有我是针对Linux的，windows用户拜拜！  </p>\n<div>\n<h3>什么是DNS污染</h3>\n<div>\n<p>回答这个问题之前，如果你不知道DNS的作用是什么，我可以简单的说，DNS的中文是域名系统，英文是Domain Name System，简称DNS，是因特网的一项业务服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。（抄自<a rel=\"nofollow\" target=\"_blank\" href=\"http://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F\">域名系统</a>）<br />  然后，DNS污染简单来说就是让找不到正确的IP，然后就没有然后，上不了网了，开着VPN也没用。</p>\n<p>下面举个例子吧，下面同样域名得到差异很大的结果。如果我们使用国内的DNS服务器或者ISP提供的DNS服务器，就算开着VPN，我们也不能正常的DNS解析的。</p>\n<div>\n<div>\n<pre><span>[</span>23:13:07<span>]</span> roowe<span>@</span>roowe-gentoo <span>/</span>tmp$ nslookup <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a> 8.8.8.8  Server:         8.8.8.8  Address:        8.8.8.8<span>#53</span>     Non-authoritative answer:  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.148.82  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.149.230  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.150.39     <span>[</span>23:14:37<span>]</span> roowe<span>@</span>roowe-gentoo <span>/</span>tmp$ nslookup <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a> 114.114.114.114  Server:         114.114.114.114  Address:        114.114.114.114<span>#53</span>     Non-authoritative answer:  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 46.82.174.68</pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h3>How To Break</h3>\n<div>\n<p>使用dnsmasq和resolvconf，每个Linux的发行版的源应该都有这两个工具，安装方法就不说了。</p>\n<p>具体选项自己去看man吧。dnsmasq的配置大概如下，就是让国内的域名交给国内的114去解析。</p>\n<div>\n<div>\n<pre>no-resolv  no-poll  <span>server</span>=8.8.8.8  <span>server</span>=8.8.4.4  no-dhcp-interface=eth0  expand-hosts  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://115.com\">115.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://126.com\">126.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://163.com\">163.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://17cdn.com\">17cdn.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://51.la\">51.la</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://6rooms.com\">6rooms.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://acfun.tv\">acfun.tv</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://alimama.com\">alimama.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://alipay.com\">alipay.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://atpanel.com\">atpanel.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://baidu.com\">baidu.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://bdimg.com\">bdimg.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://bilibili.tv\">bilibili.tv</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span>cn<span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://douban.com\">douban.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://douban.fm\">douban.fm</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://gfan.com\">gfan.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://hoopchina.com\">hoopchina.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://iask.com\">iask.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://ifeng.com\">ifeng.com</a><span>/</span>218.104.111.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://ifengimg.com\">ifengimg.com</a><span>/</span>218.104.111.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://ku6.com\">ku6.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://ku6cdn.com\">ku6cdn.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://lxdns.com\">lxdns.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://microsoft.com\">microsoft.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://mydrivers.com\">mydrivers.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://qq.com\">qq.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://qstatic.com\">qstatic.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://renren.com\">renren.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://sogou.com\">sogou.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://sohu.com\">sohu.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://soso.com\">soso.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tanx.com\">tanx.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://taobao.com\">taobao.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://taobaocdn.com\">taobaocdn.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tbcache.com\">tbcache.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tdimg.com\">tdimg.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tencent.com\">tencent.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://thawte.com\">thawte.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tmall.com\">tmall.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tudou.com\">tudou.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://tudouui.com\">tudouui.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://weibo.com\">weibo.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://wrating.com\">wrating.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://xiami.com\">xiami.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://xiami.net\">xiami.net</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://xunlei.com\">xunlei.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://ykimg.com\">ykimg.com</a><span>/</span>114.114.114.114  <span>server</span>=<span>/</span><a rel=\"nofollow\" target=\"_blank\" href=\"http://youku.com\">youku.com</a><span>/</span>114.114.114.114</pre>\n</div>\n</div>\n<p>resolvconf的作用就是 managing multiple DNS configurations，要不然resolv.conf配置全乱了，第一个都不是我们想要的127.0.0.1。</p>\n<p>resolvconf配置如下。</p>\n<div>\n<div>\n<pre><span>resolv_conf</span>=<span>/</span>etc<span>/</span>resolv.conf  <span>name_servers</span>=127.0.0.1</pre>\n</div>\n</div>\n<p>用了resolvconf之后，我们自动生成的resolv.conf配置大概如下：</p>\n<div>\n<div>\n<pre><span>[</span>23:46:30<span>]</span> roowe<span>@</span>roowe-gentoo <span>/</span>tmp$ <span>cat</span> <span>/</span>etc<span>/</span>resolv.conf   <span># Generated by resolvconf</span>  nameserver 127.0.0.1  nameserver 8.8.8.8  nameserver 8.8.4.4</pre>\n</div>\n</div>\n<p>最后/etc/init.d/dnsmasq start下，就可以用了。也可以作为服务项加入自启动里面。</p>\n</div>\n</div>\n<div>\n<h3>后话</h3>\n<div>\n<p>科学上网，为国争光。</p>\n<p>现在我们nslookup的结果大概如下。</p>\n<div>\n<div>\n<pre><span>[</span>23:52:46<span>]</span> roowe<span>@</span>roowe-gentoo <span>/</span>tmp$ nslookup <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Server:         127.0.0.1  Address:        127.0.0.1<span>#53</span>     Non-authoritative answer:  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.150.39  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.150.7  Name:   <a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com\">twitter.com</a>  Address: 199.59.148.10</pre>\n</div>\n</div>\n</div>\n</div>\n<div>\n<h3>Update:</h3>\n<div></div>\n<div>\n<h4>2012-07-05 Thu</h4>\n<div>\n<p>由于换工作室了，我又舍不得将自己的电脑搬过来，因为周六日回去华师宿舍的时候，没有电脑玩是很蛋疼的事情，这个时候就突然想拥有台笔记本咯。在这边的工作室，我就用着我们之前作为服务器的机子，机子虽破，少开几个google-chrome的TAB和不打开eclipse，应该还是能用的。</p>\n<p>说回正题，这边服务器是之前安装的fedora16,用了gentoo之后，发现fedora很多包都更新得很慢，我虽然不是很热衷于新版本，但是现在有些新版本的feture是我需要呀，比如Xfce按住Alt+Tab之后的左右方向键在xfce-4.9是有效，但是在4.8版本是没有用的，�！还有Emacs还没有升级到24呀。想到这里，我就想马上搬我的电脑过来用gentoo。除了更新慢之外,还有些包没有，比如resolvconf这个包竟然没有。所以就没法管理resolv.conf了，但是为了使用dnsmasq，还是有办法的，在 /etc/sysconfig/network-scripts/ifcfg-p33p1（这个文件是我的，找你相应的）这个文件后面添加DNS1=127.0.0.1，然后/etc/init.d/network restart下就好了。PS：我没用NetworkManager，这货坑爹的，直接用network来管理。</p>\n</p></div>\n</div>\n</div>\n</div>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\" https://mycdt0.info\"> https://mycdt0.info</a>，穿墙访问《中国数字时代》（当看到“此网站的安全证书有问题”的提示时，请选择“继续浏览此网站(不推荐)”，忽略证书警告并继续访问网站）。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-4255358624447498389?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=2ea93c5b7b\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/msuvD\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[8795]}