{"id":222962,"link":"https://chinadigitaltimes.net/chinese/2012/04/阮一峰-javascript编程风格/","date":"2012-04-28T20:10:22Z","modified":"2012-05-04T20:35:03Z","title":"阮一峰 | Javascript编程风格","content":"<p><p><a rel=\"nofollow\" href=\"http://www.crockford.com/\">Douglas Crockford</a>是Javascript权威，<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2009/05/data_types_and_json.html\">Json格式</a>就是他的发明。</p>\n<p>去年11月他有一个演讲（<a rel=\"nofollow\" href=\"http://www.youtube.com/watch?v=taaEzHI9xyY\">Youtube</a>），谈到了好的Javascript编程风格是什么。</p>\n<p><a rel=\"nofollow\" href=\"http://www.youtube.com/watch?v=taaEzHI9xyY\"><img src=\"http://image.beekka.com/blog/201204/bg2012042701.jpg\" /></a></p>\n<p>我非常推荐这个演讲，它不仅有助于学习Javascript，而且能让你心情舒畅，因为Crockford讲得很幽默，时不时让听众会心一笑。</p>\n<p>下面，我根据这个演讲和Crockford编写的<a rel=\"nofollow\" href=\"http://javascript.crockford.com/code.html\">代码规范</a>，总结一下&#8221;Javascript编程风格&#8221;。</p>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042702.jpg\" /></p>\n<p><strong>所谓&#8221;编程风格&#8221;（programming style），指的是编写代码的样式规则。</strong>不同的程序员，往往有不同的编程风格。</p>\n<p>有人说，编译器的规范叫做&#8221;语法规则&#8221;（grammar），这是程序员必须遵守的；而编译器忽略的部分，就叫&#8221;编程风格&#8221;（programming style），这是程序员可以自由选择的。这种说法不完全正确，<strong>程序员固然可以自由选择编程风格，但是好的编程风格有助于写出质量更高、错误更少、更易于维护的程序。</strong></p>\n<p>所以，有一点应该明确，<strong>&#8220;编程风格&#8221;的选择不应该基于个人爱好、熟悉程度、打字工作量等因素，而要考虑如何尽量使代码清晰易读、减少出错。你选择的，不是你喜欢的风格，而是一种能够清晰表达你的意图的风格。</strong>这一点，对于Javascript这种语法自由度很高、设计<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2010/01/12_javascript_syntax_structures_you_should_not_use.html\">不完全成熟</a>的语言尤其重要。</p>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042704.jpg\" /></p>\n<p><strong>一、大括号的位置</strong></p>\n<p>绝大多数的编程语言，都用大括号（{}）表示区块（block）。起首的大括号的位置，有许多不同的<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Indent_style\">写法</a>。</p>\n<p>最流行的有两种。一种是起首的大括号另起一行：</p>\n<blockquote>\n<p>　　block</p>\n<p>　　</p>\n<p>　　　　&#8230;</p>\n<p>　　</p>\n</blockquote>\n<p>另一种是起首的大括号跟在关键字的后面：</p>\n<blockquote>\n<p>　　block </p>\n<p>　　　　&#8230;</p>\n<p>　　</p>\n</blockquote>\n<p>一般来说，这两种写法都可以接受。但是，Javascript要使用后一种，因为Javascript会自动添加句末的分号，导致一些难以察觉的错误。</p>\n<blockquote>\n<p>　　return </p>\n<p>　　</p>\n<p>　　　　key:value;</p>\n<p>　　;</p>\n</blockquote>\n<p>上面的代码的原意，是要返回一个对象，但实际上返回的是undefined，因为Javascript自动在return语句后面添加了分号。为了避免这一类错误，需要写成下面这样：</p>\n<blockquote>\n<p>　　return </p>\n<p>　　　　key : value;</p>\n<p>　　;</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则1：表示区块起首的大括号，不要另起一行。</strong></p>\n</blockquote>\n<p><strong>二、 圆括号</strong></p>\n<p>圆括号（parentheses）在Javascript中有两种作用，一种表示调用函数，另一种表示不同的值的组合（grouping）。我们可以用空格，区分这两种不同的括号。</p>\n<blockquote>\n<p>　　<strong>规则2：调用函数的时候，函数名与左括号之间没有空格。</strong></p>\n</blockquote>\n<blockquote>\n<p>　　<strong>规则3：函数名与参数序列之间，没有空格。</strong></p>\n</blockquote>\n<blockquote>\n<p>　　<strong>规则4：所有其他语法元素与左括号之间，都有一个空格。</strong></p>\n</blockquote>\n<p>按照上面的规则，下面的写法都是不规范的：</p>\n<blockquote>\n<p>　　foo (bar)</p>\n<p>　　return(a+b);</p>\n<p>　　if(a === 0) &#8230;</p>\n<p>　　function foo (b) &#8230;</p>\n<p>　　function(x) &#8230;</p>\n</blockquote>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042705.jpg\" /></p>\n<p><strong>三、分号</strong></p>\n<p>分号表示语句的结束。大多数情况下，如果你省略了句尾的分号，Javascript会自动添加。</p>\n<blockquote>\n<p>　　var a = 1</p>\n</blockquote>\n<p>等同于</p>\n<blockquote>\n<p>　　var a = 1;</p>\n</blockquote>\n<p>因此，有人<a rel=\"nofollow\" href=\"http://mislav.uniqpath.com/2010/05/semicolons/\">提倡</a>省略句尾的分号。但麻烦的是，如果下一行的第一个字元（token）是下面这五个字符之一，Javascript将不对上一行句尾<a rel=\"nofollow\" href=\"http://inimino.org/~inimino/blog/javascript_semicolons\">添加分号</a>：&#8221;(&#8220;、&#8221;[&#8220;、&#8221;/&#8221;、&#8221;+&#8221;和&#8221;-&#8220;。</p>\n<blockquote>\n<p>　　x = y</p>\n<p>　　(function ()</p>\n<p>　　　　&#8230;</p>\n<p>　　)();</p>\n</blockquote>\n<p>上面的代码等同于</p>\n<blockquote>\n<p>　　x = y(function ()&#8230;)();</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则5：不要省略句末的分号。</strong></p>\n</blockquote>\n<p><strong>四、with语句</strong></p>\n<p>with可以减少代码的书写，但是会造成混淆。</p>\n<blockquote>\n<p>　　with (o) </p>\n<p>　　　　foo = bar;</p>\n<p>　　</p>\n</blockquote>\n<p>上面的代码，可以有四种运行结果：</p>\n<blockquote>\n<p>　　o.foo = bar;</p>\n<p>　　o.foo = o.bar;</p>\n<p>　　foo = bar;</p>\n<p>　　foo = o.bar;</p>\n</blockquote>\n<p>这四种结果都可能发生，取决于不同的变量是否有定义。因此，</p>\n<blockquote>\n<p>　　<strong>规则6：不要使用with语句。</strong></p>\n</blockquote>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042706.jpg\" /></p>\n<p><strong>五、相等和严格相等</strong></p>\n<p>Javascript有两个表示&#8221;相等&#8221;的运算符：&#8221;相等&#8221;（==）和&#8221;严格相等&#8221;（===）。</p>\n<p>因为&#8221;相等&#8221;运算符会自动转换变量类型，造成很多意想不到的<a rel=\"nofollow\" href=\"http://www.2ality.com/2011/06/javascript-equality.html\">情况</a>：</p>\n<blockquote>\n<p>　　0 == // true</p>\n<p>　　== 0 // false</p>\n<p>　　0 == &#8216;0&#8217; // true</p>\n<p>　　false == &#8216;false&#8217; // false</p>\n<p>　　false == &#8216;0&#8217; // true</p>\n<p>　　&#8221; trn &#8221; == 0 // true</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则7：不要使用&#8221;相等&#8221;（==）运算符，只使用&#8221;严格相等&#8221;（===）运算符。</strong></p>\n</blockquote>\n<p><strong>六、语句的合并</strong></p>\n<p>有些程序员追求简洁，喜欢合并不同目的的语句。比如，原来的语句是</p>\n<blockquote>\n<p>　　a = b;</p>\n<p>　　if (a) &#8230;</p>\n</blockquote>\n<p>他喜欢写成下面这样:</p>\n<blockquote>\n<p>　　if (a = b) &#8230;</p>\n</blockquote>\n<p>虽然语句少了一行，但是可读性大打折扣，而且会造成误读，让别人误以为这行代码的意思是：</p>\n<blockquote>\n<p>　　if （a === b）&#8230;</p>\n</blockquote>\n<p>另外一种情况是，有些程序员喜欢在同一行中赋值多个变量：</p>\n<blockquote>\n<p>　　var a = b = 0;</p>\n</blockquote>\n<p>他以为，这行代码等同于</p>\n<blockquote>\n<p>　　var a = 0, b = 0;</p>\n</blockquote>\n<p>实际上不是，它的真正效果是下面这样：</p>\n<blockquote>\n<p>　　b = 0;</p>\n<p>　　var a = b;</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则8：不要将不同目的的语句，合并成一行。</strong></p>\n</blockquote>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042707.jpg\" /></p>\n<p><strong>七、变量声明</strong></p>\n<p>Javascript会自动将变量声明&#8221;提升&#8221;（hoist）到代码块（block）的头部。</p>\n<blockquote>\n<p>　　if (!o) </p>\n<p>　　　　var o = ;</p>\n<p>　　}</p>\n</blockquote>\n<p>等同于</p>\n<blockquote>\n<p>　　var o;</p>\n<p>　　if (!o) </p>\n<p>　　　　o = ;</p>\n<p>　　}</p>\n</blockquote>\n<p>为了避免可能出现的问题，不如把变量声明都放在代码块的头部。</p>\n<blockquote>\n<p>　　for (var i &#8230;) &#8230;</p>\n</blockquote>\n<p>最好写成：</p>\n<blockquote>\n<p>　　var i;</p>\n<p>　　for (i &#8230;) &#8230;,</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则9：所有变量声明都放在函数的头部。</strong></p>\n</blockquote>\n<blockquote>\n<p>　　<strong>规则10：所有函数都在使用之前定义。</strong></p>\n</blockquote>\n<p><strong>八、全局变量</strong></p>\n<p>Javascript最大的语法缺点，可能就是全局变量对于任何一个代码块，都是可读可写。这对代码的模块化和重复使用，非常不利。</p>\n<blockquote>\n<p>　　<strong>规则11：避免使用全局变量；如果不得不使用，用大写字母表示变量名，比如UPPER_CASE。</strong></p>\n</blockquote>\n<p><img src=\"http://image.beekka.com/blog/201204/bg2012042708.jpg\" /></p>\n<p><strong>九、new命令</strong></p>\n<p>Javascript使用new命令，从建构函数生成一个新对象。</p>\n<blockquote>\n<p>　　var o = new myObject();</p>\n</blockquote>\n<p>这种做法的问题是，一旦你忘了加上new，myObject()内部的this关键字就会指向全局对象，导致所有绑定在this上面的变量，都变成全部变量。</p>\n<blockquote>\n<p>　　<strong>规则12：不要使用new命令，改用<a rel=\"nofollow\" href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/create\">Object.create()</a>命令。</strong></p>\n</blockquote>\n<p>如果不得不使用new，为了防止出错，最好在视觉上把建构函数与其他函数区分开来。</p>\n<blockquote>\n<p>　　<strong>规则13：建构函数的函数名，采用首字母大写（InitialCap）；其他函数名，一律首字母小写。</strong></p>\n</blockquote>\n<p><strong>十、自增和自减运算符</strong></p>\n<p>自增（++）和自减（&#8211;）运算符，放在变量的前面或后面，返回的值不一样，很容易发生错误。</p>\n<p>事实上，所有的++运算符都可以用&#8221;+= 1&#8243;代替。</p>\n<blockquote>\n<p>　　++x</p>\n</blockquote>\n<p>等同于</p>\n<blockquote>\n<p>　　x += 1;</p>\n</blockquote>\n<p>代码变得更清晰了。有一个很可笑的例子，某个Javascript函数库的源代码中出现了下面的片段：</p>\n<blockquote>\n<p>　　++x;</p>\n<p>　　++x;</p>\n</blockquote>\n<p>这个程序员忘了，还有更简单、更合理的写法：</p>\n<blockquote>\n<p>　　x += 2;</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则14：不要使用自增（++）和自减（&#8211;）运算符，用+=和-=代替。</strong></p>\n</blockquote>\n<p><strong>十一、区块</strong></p>\n<p>如果循环和判断的代码体只有一行，Javascript允许该区块（block）省略大括号。</p>\n<p>下面的代码</p>\n<blockquote>\n<p>　　if (a) b(); c();</p>\n</blockquote>\n<p>原意可能是</p>\n<blockquote>\n<p>　　if (a)  b(); c();</p>\n</blockquote>\n<p>但是，实际效果是</p>\n<blockquote>\n<p>　　if (a)  b(); c();</p>\n</blockquote>\n<p>因此，</p>\n<blockquote>\n<p>　　<strong>规则15：总是使用大括号表示区块。</strong></p>\n</blockquote>\n<p>（完）</p>\n<div>\n<h3>文档信息</h3>\n<ul>\n<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a rel=\"nofollow\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">Creative Commons BY-NC-ND 3.0</a></li>\n<li>原文网址：<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2012/04/javascript_programming_style.html\">http://www.ruanyifeng.com/blog/2012/04/javascript_programming_style.html</a></li>\n<li>最后修改时间：2012年4月27日 20:47</li>\n<li>付费支持：<a rel=\"nofollow\" href=\"https://mai.alipay.com/p.htm?id=2012033102826278\"><img alt=\"支付宝担保交易\" src=\"http://chinadigitaltimes.net/chinese/files/2012/04/3a976ef2rmb_32.png.png\" /></a> | <a rel=\"nofollow\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&amp;business=yifeng.ruan@gmail.com&amp;currency_code=USD&amp;amount=2.99&amp;return=http://www.ruanyifeng.com/thank.html&amp;item_name=Ruan%20YiFeng's%20Blog&amp;undefined_quantity=1&amp;no_note=0\"><img alt=\"paypal\" src=\"http://chinadigitaltimes.net/chinese/files/2012/04/5ca83e43dollar_32.png.png\" /></a> </li>\n</ul>\n</div>\n<div>\n<p><a rel=\"nofollow\" href=\"http://yipinzao.com/\"><img src=\"http://www.ruanyifeng.com/blog/images/ad_yipinzao.jpg\" /></a></p>\n</div>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2012/04/fe13a858g2012042701.jpg-150x150.jpg\" /></p>\n<p>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</p>\n<p>Loading&#8230;</p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> </p>\n<p>\n</form>\n","author":1004,"categories":[9203],"tags":[9400]}