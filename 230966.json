{"id":230966,"link":"https://chinadigitaltimes.net/chinese/2012/06/翻墙-openvpn安装配置/","date":"2012-06-13T05:51:15Z","modified":"2012-06-13T05:51:15Z","title":"翻墙 | OpenVPN安装配置","content":"<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.e2fsck.org/openvpn-installation-configuration.html\">http://www.e2fsck.org/openvpn-installation-configuration.html</a></p>\n<div>\n<p>  <span>前言： 一直在用PPTP VPN用的挺好的，但发现openvpn用的人很多，于是我也来安装一下看看, 192.168.0.6为外网IP</span></p>\n<p><strong>第一步 安装准备</strong></p>\n<p>1. 关闭 selinux 和 iptables</p>\n<p>2. 安装 openssl</p>\n<p>安装lzo</p>\n<p>[root@dota ~]# <span>tar xvf lzo-2.04.tar.gz</span></p>\n<p>[root@dota ~]# <span>cd lzo-2.04</span></p>\n<p>  [root@dota lzo-2.04]# <span>./configure</span></p>\n<p>[root@dota lzo-2.04]# <span>make &#038;&#038; make install</span></p>\n<p> </p>\n<p>3. 下载安装 openvpn</p>\n<p>  [root@dota ~]# <span>wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://swupdate.openvpn.org/community/releases/openvpn-2.2.1.tar.gz\">http://swupdate.openvpn.org/community/releases/openvpn-2.2.1.tar.gz</a></span></p>\n<p>  [root@dota ~]# <span>tar xvf openvpn-2.2.1.tar.gz</span></p>\n<p>[root@dota ~]# <span>cd openvpn-2.2.1</span></p>\n</p>\n<p>[root@dota openvpn-2.2.1]# <span>./configure</span></p>\n<p>[root@dota openvpn-2.2.1]# <span>make &#038;&#038; make install</span></p>\n<p>  4. 检查 tun 是否安装</p>\n<p>[root@dota openvpn-2.2.1]# <span>modinfo tun</span></p>\n<p>  5. 启用IP转发</p>\n<p>[root@dota openvpn-2.2.1]# <span>echo 1 > /proc/sys/net/ipv4/ip_forward</span></p>\n<p>  这个要加到开机启动里</p>\n<p>6. 复制配置文件</p>\n<p>[root@dota openvpn-2.2.1]# <span>mkdir -p /etc/openvpn</span></p>\n<p>[root@dota openvpn-2.2.1]# <span>cp -r * /etc/openvpn/</span></p>\n<p>  [root@dota ~]# <span>cp -r sample-config-files/server.conf /etc/openvpn/</span></p>\n<p>7. 创建主CA证书及密钥</p>\n<p>  [root@dota openvpn-2.2.1]# <span>cd /etc/openvpn/easy-rsa/2.0/</span></p>\n<p>[root@dota 2.0]# <span>vi vars</span></p>\n<p>把下面的内容改下</p>\n<p><span>export KEY_COUNTRY=”CN”</span><br />  <span>export KEY_PROVINCE=”JS”</span><br /><span>export KEY_CITY=”Suzhou”</span><br /><span>export KEY_ORG=”<a rel=\"nofollow\" target=\"_blank\" href=\"http://google.com\">google.com</a>”</span><br />  <span>export KEY_EMAIL=”<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:test@google.com\">test@google.com</a>”</span></p>\n<p>[root@dota 2.0]# <span>. ./vars</span>   <span>（注意. .中间有个空格，成功会出现下面的提示）</span><br />  NOTE: If you run ./clean-all, I will be doing a rm -rf on /root/openvpn-2.2.1/easy-rsa/2.0/keys</p>\n<p>[root@dota 2.0]# <span>./clean-all</span></p>\n<p>[root@dota 2.0]# <span>./build-ca</span></p>\n<p>  一路回车即可。</p>\n<p>8. 为服务器创建证书和密钥</p>\n<p>[root@dota 2.0]#<span> ./build-key-server server</span></p>\n<p>一路回车，最后2个 y 确认即可。</p>\n<p>[root@dota 2.0]#<span> ./build-dh</span></p>\n<p>安装 server 所需的 CA 证书</p>\n<p>[root@dota 2.0]#<span> cp keys/ca.crt ../</span><br />  [root@dota 2.0]# <span>cp keys/dh1024.pem ../</span><br />[root@dota 2.0]# <span>cp keys/server.key ../</span><br />[root@dota 2.0]# <span>cp keys/server.crt ../</span></p>\n<p>然后编辑配置文件</p>\n<p>[root@dota 2.0]# <span>cd ../..</span></p>\n<p>[root@dota openvpn]# <span>vi server.conf</span></p>\n<p>  修改成如下配置</p>\n<p><span>dev tap</span><br /><span>;dev tun</span></p>\n<p>  <span>push “dhcp-option DNS 8.8.8.8″</span><br /><span>push “dhcp-option DNS 8.8.4.4″</span></p>\n<p>  <span>ca /etc/openvpn/easy-rsa/ca.crt</span><br /><span>cert /etc/openvpn/easy-rsa/server.crt</span><br /><span>key /etc/openvpn/easy-rsa/server.key   <span># This file should be kept secret</span></span><br />  <span>dh /etc/openvpn/easy-rsa/dh1024.pem</span></p>\n<p><span>再添加1行</span></p>\n<p>  <span>push “redirect-gateway def1″</span>        <span>#重定向客户端网关为VPN服务器的网关</span></p>\n<p>  9. 启动 openvpn server</p>\n<p>[root@dota openvpn]#<span> cp -r /etc/openvpn/sample-scripts/openvpn.init /etc/init.d/openvpn</span></p>\n<p>[root@dota openvpn]# <span>chmod 755 /etc/init.d/openvpn</span></p>\n<p>  [root@dota openvpn]# <span>service openvpn restart</span><br />正在关闭openvpn：[确定]<br />正在启动 openvpn：[确定]<br />[root@dota openvpn]#<span> chkconfig openvpn on</span></p>\n<p>   </p>\n<p>10. 创建客户端证书</p>\n<p>[root@dota 2.0]#<span> cd /root/openvpn-2.2.1/easy-rsa/2.0/build-key</span></p>\n<p>[root@dota 2.0]#<span> ./build-key client</span></p>\n<p>  一路回车，最后2个 y 确认即可。</p>\n<p>[root@dota 2.0]#<span> ./build-dh</span></p>\n<p>  11. 在 iptables 中开启 udp 的 1194 端口</p>\n<p>[root@dota openvpn-2.2.1]# <span>iptables -A INPUT -p udp -m udp –dport 1194 -m state –state NEW -j ACCEPT</span></p>\n<p>12. 转发所有来自 10.8.0.0网段的流量</p>\n<p>[root@dota openvpn-2.2.1]# <span>iptables -t nat -A POSTROUTING -s <a rel=\"nofollow\" target=\"_blank\" href=\"http://10.8.0.0/24\">10.8.0.0/24</a> -j MASQUERADE</span></p>\n<p>转发地址：</p>\n<p>[root@dota keys]#<span> iptables -t nat -A POSTROUTING -s <a rel=\"nofollow\" target=\"_blank\" href=\"http://10.8.0.0/24\">10.8.0.0/24</a> -o eth0 -j SNAT –to-source 192.168.0.6</span></p>\n<p> </p>\n<p><strong>第二步  客户端配置</strong></p>\n<p>  把 /root/openvpn-2.2.1/easy-rsa/2.0/keys 目录下的 ca.crt、client.crt、client.key 和</p>\n<p>/root/openvpn-2.2.1/sample-config-files 目录下的 client.conf 放到客户端安装的 config 目录下</p>\n<p>然后 XP 上安装</p>\n<p>openvpn-2.0.9-gui-1.0.3-install.exe</p>\n<p>安装好后把sample-config目录下的client.ovpn拷贝到config目录下，然后编辑</p>\n<p>  <span>client</span></p>\n<p><span>dev tap</span><br /><span>;dev tun</span></p>\n<p><span>remote 192.168.0.6 1194</span></p>\n<p>  <span>persist-key </span><br /><span>persist-tun </span><br /><span>ca ca.crt </span><br /><span>cert client.crt </span><br />  <span>key client.key </span><br /><span>ns-cert-type server </span><br /><span>comp-lzo </span><br /><span>verb 3</span></p>\n<p><span>redirect-gateway def1</span></p>\n<p>  然后，桌面右下角，右键红色的图标，连接</p>\n<p><strong>附：如果不能上国外网站，请把</strong></p>\n<p>  XP 客户端“本地连接”里，把第一DNS改成“8.8.8.8”</p>\n<p> </p>\n<p><strong>错误：</strong></p>\n<p>1. 如果提示 619 错误，则查看“本地连接”防火墙那栏，会提示有个 windows 服务没开，打开就可以了。</p>\n</div>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\"https://mycdt4.info/chinese/\">https://mycdt4.info/chinese/</a>，穿墙访问《中国数字时代》。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-935403320704839563?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/mstlf\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[8510,8795]}