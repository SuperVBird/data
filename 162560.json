{"id":162560,"link":"https://chinadigitaltimes.net/chinese/2011/06/pptp-vpn-使用国内路由表-自动触发-vpn-连接/","date":"2011-06-20T10:30:43Z","modified":"2011-06-20T10:30:43Z","title":"PPTP VPN 使用国内路由表 + 自动触发 VPN 连接","content":"<p><p>来源：<a href=\"http://www.geektu.com/?p=548\">http://www.geektu.com/?p=548</a>   </p>\n<p>因为一些原因，一直用的 SSH 不太够用，于是买了一个 PPTP VPN。PPTP VPN 的好处是在绝大多数平台上都无需任何客户端，适合各平台使用，同时价钱一般也不贵 XD。</p>\n<p>不过，相比起 OpenVPN 来，PPTP 不用客户端也有一个坏处：不能够配置连接脚本，这样就不好使用国内路由表。（因为 VPN 默认发送全局流量，因此连接 VPN 后访问国内网站速度会慢很多。）</p>\n<p>但是解决办法还是有的。</p>\n<h3>一、国内路由表</h3>\n<p>Google Project “<a href=\"http://code.google.com/p/chnroutes/\">chnroutes</a>” 提供了国内路由表。对 Windows 用户来说，可以下载“pre_created_for_win.zip”压缩包（Downloads 标签页中下载即可），解压后将得到四个文件：vpnup.bat, vpnup.vbs, vpndown.bat, vpndown.vbs。</p>\n<p>两个 vbs 文件下载好后删掉就行（没什么用，部分杀软还会对 vbs 文件报毒）。</p>\n<p>根据 chnroutes 的说明，使用 PPTP VPN 的 Windows 用户可以这样操作：</p>\n<blockquote>\n<p>由于 Windows 上的 PPTP 不支持拨号脚本，所以也只能在进行拨号之前手动执行 vpnup.bat 文件以设置路由表。而在断开 VPN 之后，如果你觉得有必要，可以运行 vpndown.bat 把这些路由信息给清理掉。</p>\n</blockquote>\n<p>这样毕竟还是不方便（要先双击这个 vpnup.bat，然后再双击 VPN 连接，麻烦！）。</p>\n<p>同时，如果你有多网卡，还可能造成添加的路由信息不正确（因为该 bat 采用</p>\n<blockquote>\n<p>for /F &#8220;tokens=3&#8221; %%* in (‘route print ^| findstr &#8220;<0.0.0.0>&#8220;’) do set &#8220;gw=%%*&#8221;</p>\n</blockquote>\n<p>方式来获得以太网连接的网关地址，当你有多网卡时，有可能获取不到正确的出口网关）。</p>\n<p>所以，我把这个 bat 稍稍修改了一下。修改了两个地方：</p>\n<ol>\n<ol>\n<li>手动指定网关（如果你的网络环境相对稳定，并且觉得有必要的话）； </li>\n<li>路由信息添加完毕后，自动触发 rasdial.exe 进行 VPN 的拨号连接。 </li>\n</ol>\n</ol>\n<p> </p>\n<h3>二、修改方法</h3>\n<p><strong>0、提示</strong></p>\n<p>修改 vpnup.bat 时，请使用 EditPlus / Notepad++ 等编辑器，尽量不要使用 Windows 自带的记事本 / 写字板程序。</p>\n<p><strong>1、手动指定网关</strong></p>\n<p>vpnup.bat 文件中用 gw 变量代表以太网出口网关。所以，只要在该 bat 的 route add 语句前，用语句</p>\n<blockquote>\n<p><em>set gw=”你的网关地址”</em></p>\n</blockquote>\n<p>即可：</p>\n<p><a href=\"http://www.geektu.com/blog/wp-content/uploads/2011/02/947bfc947fc6.png\"><img alt=\"指定网关地址\" height=\"255\" src=\"http://www.geektu.com/blog/wp-content/uploads/2011/02/thumb.png\" title=\"指定网关地址\" width=\"625\" /></a></p>\n<p>当然，前提是你的网关相对固定。</p>\n<p><strong>2、自动进行 VPN 拨号</strong></p>\n<p>只要在 vpnup.bat 文件的末尾添加语句</p>\n<blockquote>\n<p><em>rasdial &#8220;你的 PPTP VPN 连接名称&#8221; &#8220;用户名&#8221; &#8220;密码&#8221;</em></p>\n</blockquote>\n<p>即可：</p>\n<p><a href=\"http://www.geektu.com/blog/wp-content/uploads/2011/02/VPN-.png\"><img alt=\"自动进行 VPN 拨号\" height=\"112\" src=\"http://www.geektu.com/blog/wp-content/uploads/2011/02/VPN-_thumb.png\" title=\"自动进行 VPN 拨号\" width=\"492\" /></a></p>\n<p>经过这样两步修改后的 vpnup.bat 脚本就更好用了。这样，你可以把这个 bat 创建一个快捷方式放在桌面上 / 开始菜单里，以后每次开机后只要点击这个 bat 文件就可完成国内路由表的设置 + VPN 连接的触发：</p>\n<p><img alt=\"一键连上 VPN\" height=\"276\" src=\"http://www.geektu.com/blog/wp-content/uploads/2011/02/VPN_thumb.png\" title=\"一键连上 VPN\" width=\"405\" /></p>\n<p>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godelicious/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/delicious/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gofacebook/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/facebook/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gotwitter/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/twitter/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gostumble/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/stumble/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godigg/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/digg/xijie.wordpress.com/4661/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/goreddit/xijie.wordpress.com/4661/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/reddit/xijie.wordpress.com/4661/\" /></a> <img alt=\"\" border=\"0\" height=\"1\" src=\"http://stats.wordpress.com/b.gif?host=xijie.wordpress.com&#038;blog=10068099&#038;post=4661&#038;subd=xijie&#038;ref=&#038;feed=1\" width=\"1\" /></p>\n</p>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2011/06/d7aac4d7thumb.png-150x150.png\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":706,"categories":[15300],"tags":[8510,8795]}