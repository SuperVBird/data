{"id":371305,"link":"https://chinadigitaltimes.net/chinese/2014/11/翻墙-朴素vpn-一种vpn新玩法/","date":"2014-11-19T10:06:23Z","modified":"2014-11-19T10:06:23Z","title":"翻墙 | 朴素VPN 一种VPN新玩法","content":"<div dir=\"ltr\">\n<div>&#30001;&#20110;&#36335;&#30001;&#31649;&#25511;&#31995;&#32479;&#30340;&#24314;&#31435;&#65292;&#23454;&#26102;&#21160;&#24577;&#40657;&#27934;&#36335;&#30001;&#24050;&#25104;&#20026;&#26368;&#26377;&#25928;&#30340;&#23553;&#38145;&#25163;&#27573;&#65292;TCP&#36830;&#25509;&#37325;&#32622;&#21644;DNS&#27745;&#26579;&#25104;&#20026;&#27425;&#35201;&#25163;&#27573;&#65292;&#21033;&#29992;&#28431;&#27934;&#30340;&#31359;&#22681;&#26041;&#27861;&#24050;&#19981;&#20877;&#20855;&#26377;&#26222;&#36941;&#24847;&#20041;&#12290;&#23545;&#27492;&#24212;&#23545;&#26041;&#27861;&#26159;&#22810;&#26679;&#21270;&#21327;&#35758;&#30340;VPN&#26469;&#25269;&#25239;&#35782;&#21035;&#12290;&#36825;&#37324;&#20171;&#32461;&#19968;&#31181;<em>&#22826;&#31616;&#21333;&#12289;&#26377;&#26102;&#24456;&#26420;&#32032;</em>&#30340;&ldquo;&#31351;&#20154;VPN&rdquo;&#12290;</div>\n<div>&#26420;&#32032;VPN&#21482;&#38656;&#35201;&#19968;&#27425;&#20869;&#26680;&#37197;&#32622;&#65288;Linux&#20869;&#26680;&#65289;&#65292;&#21363;&#21487;&#27704;&#20037;&#31283;&#23450;&#36816;&#34892;&#65292;&#19981;&#38656;&#35201;&#20219;&#20309;&#29992;&#25143;&#24577;&#23432;&#25252;&#36827;&#31243;&#12290;&#25152;&#26377;&#27969;&#37327;&#36716;&#25442;&#21644;&#21152;&#23494;&#20840;&#37096;&#30001;&#20869;&#26680;&#23436;&#25104;&#65292;&#21407;&#29983;&#24615;&#33021;&#65292;&#24320;&#38144;&#20960;&#20046;&#27809;&#26377;&#12290;&#38745;&#24577;&#37197;&#32622;&#65292;&#36991;&#20813;&#21160;&#24577;&#25569;&#25163;&#21644;&#21442;&#25968;&#21327;&#21830;&#20135;&#29983;&#25351;&#32441;&#29305;&#24449;&#23548;&#33268;&#34987;&#35782;&#21035;&#12290;&#24182;&#19988;&#25903;&#25345;NAT&#65292;&#31227;&#21160;&#30340;&#20869;&#32593;&#29992;&#25143;&#21487;&#20197;&#20351;&#29992;&#27492;&#26041;&#27861;&#12290;&#25903;&#25345;&#24191;&#27867;&#65292;&#22522;&#20110;L2TPv3&#26631;&#20934;&#65292;Linux&#20869;&#26680;3.2+&#37117;&#26377;&#25903;&#25345;&#65292;&#20854;&#20182;&#25805;&#20316;&#31995;&#32479;&#21407;&#21017;&#19978;&#20063;&#33021;&#25903;&#25345;&#12290;&#20294;&#26377;&#20004;&#20010;&#23616;&#38480;&#65306;&#38656;&#35201;root&#26435;&#38480;&#65307;&#19968;&#20010;&#38567;&#36947;&#21482;&#25903;&#25345;&#19968;&#20010;&#29992;&#25143;&#12290;</div>\n<div>&#26420;&#32032;VPN&#21033;&#29992;UDP&#23553;&#35013;&#30340;&#38745;&#24577;L2TP&#38567;&#36947;&#23454;&#29616;VPN&#65292;&#20869;&#26680;XFRM&#23454;&#29616;&#38745;&#24577;IPsec&#12290;&#23454;&#38469;&#19978;IP-in-IP&#38567;&#36947;&#21363;&#21487;&#23454;&#29616;VPN&#65292;&#20294;&#26159;&#36825;&#31181;&#21327;&#35758;&#26080;&#27861;&#31359;&#36234;NAT&#65292;&#22240;&#27492;&#24517;&#39035;&#21033;&#29992;UDP&#23553;&#35013;&#12290;&#20869;&#26680;3.18&#23558;&#25903;&#25345;<a rel=\"nofollow\" target=\"_blank\" href=\"http://lwn.net/Articles/614348/\">Foo-over-UDP</a>&#65292;&#22312;UDP&#37324;&#38754;&#30452;&#25509;&#23553;&#35013;IP&#65292;&#19982;&#38745;&#24577;&#30340;L2TP-over-UDP&#24456;&#31867;&#20284;&#12290;</div>\n<h2><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%B4%E7%B4%A0vpn\"></a>&#21019;&#24314;&#19968;&#20010;&#26420;&#32032;VPN</h2>\n<ul>\n<li>\n<div>&#20844;&#20849;&#35774;&#32622;</div>\n<pre><code>modprobe l2tp_eth<br>SERVER_IP=xxx.xxx.xxx.xxx SERVER_IF=eth0 CLIENT_IP=192.168.1.2 SESSION=0xdeadbeef COOKIE=baadc0defaceb00c<br></code></pre>\n</li>\n<li>\n<div>&#26381;&#21153;&#22120;</div>\n<pre><code>iptables -t nat -A INPUT -i $SERVER_IF -p udp --dport 5353 -m u32 --u32 '0&gt;&gt;22&amp;0x3C@12 = 0xdeadbeef &amp;&amp; 0&gt;&gt;22&amp;0x3C@16 = 0xbaadc0de &amp;&amp; 0&gt;&gt;22&amp;0x3C@20 = 0xfaceb00c' -j SNAT --to-source 10.53.0.255:6464<br>ip l2tp add tunnel local $SERVER_IP remote 10.53.0.255 tunnel_id 1 peer_tunnel_id 1 encap udp udp_sport 5353 udp_dport 6464<br>ip l2tp add session tunnel_id 1 session_id $SESSION peer_session_id $SESSION cookie $COOKIE peer_cookie $COOKIE<br>ip addr add 10.53.0.1 peer 10.53.0.2 dev l2tpeth0<br>ip link set l2tpeth0 up mtu 1480<br>iptables -t nat -A POSTROUTING -o $SERVER_IF -s 10.53.0.2 -j MASQUERADE<br>sysctl -w net.ipv4.ip_forward=1<br></code></pre>\n</li>\n<li>\n<div>&#23458;&#25143;&#31471;</div>\n<pre><code>ip l2tp add tunnel local $CLIENT_IP remote $SERVER_IP tunnel_id 1 peer_tunnel_id 1 encap udp udp_sport 6464 udp_dport 5353<br>ip l2tp add session tunnel_id 1 session_id $SESSION peer_session_id $SESSION cookie $COOKIE peer_cookie $COOKIE<br>ip addr add 10.53.0.2 peer 10.53.0.1 dev l2tpeth0<br>ip link set l2tpeth0 up mtu 1480<br>ip route add 8.8.8.8 via 10.53.0.1<br></code></pre>\n</li>\n</ul>\n<div>&#23436;&#25104;&#20102;&#65281;&#27979;&#35797;&#65306;&#65288;&#21019;&#24314;&#38567;&#36947;&#21518;ARP&#21551;&#21160;&#20063;&#35768;&#20250;&#31561;&#20960;&#31186;&#12290;&#65289;</div>\n<pre><code>user@client$ ping 10.53.0.1<br>PING 10.53.0.1 (10.53.0.1) 56(84) bytes of data.<br>64 bytes from 10.53.0.1: icmp_seq=1 ttl=64 time=154 ms<br>...<br>user@client$ dig twitter.com @8.8.8.8 +short<br>199.59.148.82<br>199.59.150.7<br>199.59.148.10<br>199.59.150.39<br></code></pre>\n<div>&#38142;&#36335;&#26080;&#27745;&#26579;&#65281;&#20998;&#27493;&#35299;&#37322;&#65306;</div>\n<ol>\n<li>&#31471;&#21475;5353&#12289;6464&#21487;&#33258;&#23450;&#20041;&#25104;&#27604;&#22914;&#31471;&#21475;53&#12290;&#26381;&#21153;&#22120;&#31471;&#21475;&#24517;&#39035;&#20844;&#32593;&#21487;&#35775;&#38382;&#65292;&#23458;&#25143;&#31471;&#21487;&#20197;&#22312;NAT&#20869;&#32593;&#37324;&#12290;&#26381;&#21153;&#31471;VPN&#20869;&#22320;&#22336;&#20026;<code>10.53.0.1</code>&#65292;&#23458;&#25143;&#31471;&#20026;<code>.2</code>&#12290;<code>SESSION</code>&#21644;<code>COOKIE</code>&#19968;&#36215;&#32452;&#25104;&#19968;&#20010;32+64&#20301;&#30340;&#23494;&#30721;&#12290;</li>\n<li>&#26381;&#21153;&#31471;&#39564;&#35777;&#36825;&#20010;&#23494;&#30721;&#28982;&#21518;&#35774;&#32622;SNAT&#12290;&#22240;&#27492;&#65292;&#21516;&#26102;&#21482;&#33021;&#26377;&#19968;&#20010;&#29992;&#25143;&#20351;&#29992;&#36825;&#20010;VPN&#12290;</li>\n<li>&#26381;&#21153;&#31471;&#21019;&#24314;&#38745;&#24577;L2TP&#38567;&#36947;<code>l2tpeth0</code></li>\n<li>&#26381;&#21153;&#31471;&#35774;&#32622;&#36716;&#21457;</li>\n<li>&#23458;&#25143;&#31471;&#21019;&#24314;&#38745;&#24577;L2TP&#38567;&#36947;<code>l2tpeth0</code>&#65288;NAT&#20869;&#32593;&#21487;&#65289;</li>\n<li>&#23458;&#25143;&#31471;&#35774;&#32622;&#36335;&#30001;&#65288;&#20840;&#23616;&#36335;&#30001;&#35265;&#19979;&#65289;</li>\n</ol>\n<h3><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E5%AE%89%E5%85%A8%E6%80%A7\"></a>&#23433;&#20840;&#24615;</h3>\n<div>&#20851;&#20110;&#21327;&#35758;&#35782;&#21035;&#65292;&#30001;&#20110;&#33258;&#23450;&#20041;&#30340;&#31471;&#21475;&#65292;&#38745;&#24577;&#30340;&#37197;&#32622;&#65292;&#27809;&#26377;&#20219;&#20309;&#21160;&#24577;&#30340;&#25569;&#25163;&#21644;&#21442;&#25968;&#21327;&#21830;&#36807;&#31243;&#65292;&#22522;&#20110;&#25351;&#32441;&#30340;&#21327;&#35758;&#35782;&#21035;&#24456;&#38590;&#33719;&#24471;&#20219;&#20309;&#32467;&#26524;&#12290;&#65288;&#35265;&#19979;&#38754;&#38468;&#24405;&#30340;&#23553;&#21253;&#32467;&#26500;&#12290;&#65289;&#27969;&#37327;&#20998;&#26512;&#20173;&#28982;&#26377;&#21487;&#33021;&#35782;&#21035;&#20986;&#26576;&#31181;&#29305;&#24449;&#65292;&#20294;&#26159;&#36825;&#31181;&#23567;&#20247;&#21327;&#35758;&#24212;&#35813;&#19981;&#23481;&#26131;&#25104;&#20026;&#30446;&#26631;&#12290;</div>\n<div>&#20851;&#20110;&#21152;&#23494;&#65292;&#30446;&#21069;&#36825;&#20010;&#38567;&#36947;&#26410;&#37319;&#29992;&#21152;&#23494;&#12290;&#25105;&#30456;&#20449;&#19981;&#22826;&#21487;&#33021;&#23545;&#20219;&#24847;&#31471;&#21475;&#30340;UDP&#37117;&#20570;&#28145;&#24230;&#26816;&#27979;&#12290;&#22914;&#26524;&#38656;&#35201;&#30340;&#35805;&#65292;&#21487;&#20197;&#30475;&#19979;&#38754;&#22312;&#38567;&#36947;&#20869;&#36827;&#34892;IPsec&#21152;&#23494;&#30340;&#26041;&#27861;&#12290;</div>\n<div>&#20869;&#26680;&#30340;L2TP&#38567;&#36947;&#38656;&#35201;&#22266;&#23450;&#19968;&#20010;&#21807;&#19968;&#30340;&#36828;&#31243;&#22320;&#22336;&#21644;&#31471;&#21475;&#65292;&#23548;&#33268;&#19968;&#20010;VPN&#21482;&#33021;&#26377;&#19968;&#20010;&#29992;&#25143;&#65288;&#22810;&#29992;&#25143;VPN&#30340;&#37117;&#26159;&#29992;&#25143;&#24577;&#23454;&#29616;&#30340;&#65289;&#12290;&#22240;&#27492;&#25105;&#20204;&#38656;&#35201;&#25226;NAT&#21518;&#30340;&#31227;&#21160;IP&#22320;&#22336;&#32763;&#35793;&#22238;&#25104;&#22266;&#23450;&#22320;&#22336;&#21644;&#31471;&#21475;&#65288;<code>10.53.0.255:6464</code>&#65289;&#12290;&#20026;&#20102;&#38450;&#27490;&#25298;&#32477;&#26381;&#21153;&#65292;&#38656;&#35201;&#22312;SNAT&#30340;&#26102;&#20505;&#36827;&#34892;&#19968;&#20010;&#31616;&#26131;&#30340;&#35748;&#35777;&#65292;&#20351;&#29992;&#20102;L2TP&#30340;session id&#21644;cookie&#20316;&#20026;96&#20301;&#30340;&#23494;&#30721;&#12290;<code>conntrack -L -p udp</code>&#21487;&#20197;&#26597;&#30475;&#26159;&#21738;&#20010;IP&#22320;&#22336;&#36830;&#25509;&#19978;&#20102;&#12290;&#22914;&#26524;&#29992;&#25143;&#30340;&#22320;&#22336;&#21464;&#20102;&#65292;&#35201;&#31561;&#21040;&#32769;SNAT&#36830;&#25509;&#35760;&#24405;&#36229;&#26102;&#27880;&#38144;&#65288;&#40664;&#35748;&#26159;&#19977;&#20998;&#38047;&#65289;&#25165;&#33021;&#20174;&#26032;&#30340;&#22320;&#22336;&#36830;&#25509;&#65292;&#21152;&#36895;&#36825;&#20010;&#36807;&#31243;&#21487;&#20197;ssh&#30331;&#24405;&#28982;&#21518;<code>conntrack -D -p udp -s $OLD_CLIENT_IP</code>&#28165;&#38500;&#32769;&#22320;&#22336;&#12290;Foo-over-UDP&#27809;&#26377;&#36825;96&#20301;&#30340;&#23383;&#27573;&#21487;&#20197;&#29992;&#26469;&#24403;&#20316;&#23494;&#30721;&#65292;&#25152;&#20197;&#35748;&#35777;&#38656;&#35201;&#20351;&#29992;&#21478;&#22806;&#30340;&#29366;&#24577;&#20250;&#30053;&#40635;&#28902;&#19968;&#20123;&#12290;</div>\n<h3><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1%E9%97%AE%E9%A2%98\"></a>&#23458;&#25143;&#31471;&#36335;&#30001;&#38382;&#39064;</h3>\n<div>&#21487;&#20197;&#35774;&#32622;&#20840;&#23616;VPN&#65292;&#22914;&#65306;</div>\n<pre><code>ip route add `ip route | sed -n \"s/^default/$SERVER_IP/p\"`<br>ip route add 0.0.0.0/1 via 10.53.0.1<br>ip route add 128.0.0.0/1 via 10.53.0.1<br></code></pre>\n<div>&#20063;&#21487;&#20197;&#20351;&#29992;chnroutes&#36825;&#31867;&#31934;&#32454;&#26041;&#26696;&#12290;</div>\n<h2><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E5%8A%A0%E5%AF%86%E7%9A%84%E6%9C%B4%E7%B4%A0vpn%E5%8F%AF%E9%80%89\"></a>&#21152;&#23494;&#30340;&#26420;&#32032;VPN&#65288;&#21487;&#36873;&#65289;</h2>\n<div>&#25509;&#30528;&#19978;&#38754;&#30340;&#35774;&#32622;&#65292;&#36816;&#34892;&#22914;&#19979;&#21629;&#20196;&#37197;&#32622;&#20869;&#26680;XFRM&#26694;&#26550;&#65292;&#23454;&#29616;&#19968;&#20010;&#26420;&#32032;&#30340;&#38745;&#24577;IPsec&#38567;&#36947;&#12290;</div>\n<div>&#21152;&#23494;&#20869;&#32593;&#26381;&#21153;&#31471;&#22320;&#22336;&#20026;<code>10.53.1.1</code>&#65292;&#23458;&#25143;&#31471;&#20026;<code>.2</code>&#12290;&#23433;&#20840;&#20851;&#32852;&#21442;&#25968;<code>spi 102</code>&#21450;&#20854;&#38745;&#24577;&#23494;&#38053;<code>0xc0de0102</code>&#21644;&#21478;&#22806;&#19968;&#32452;&#21442;&#25968;&#37117;&#21487;&#25913;&#12290;</div>\n<ol>\n<li>\n<div>&#26381;&#21153;&#31471;&#21019;&#24314;&#21152;&#23494;&#38567;&#36947;<code>ipsec0</code></div>\n<pre><code>ip tunnel add ipsec0 mode ipip local 10.53.0.1 remote 10.53.0.2 dev l2tpeth0<br>ip addr add 10.53.1.1 peer 10.53.1.2 dev ipsec0<br>ip link set ipsec0 up<br>ip xfrm state add src 10.53.0.1 dst 10.53.0.2 proto esp spi 102 enc blowfish 0xc0de0102<br>ip xfrm state add src 10.53.0.2 dst 10.53.0.1 proto esp spi 201 enc blowfish 0xc0de0201<br>ip xfrm policy add dev l2tpeth0 dir out tmpl proto esp spi 102<br>ip xfrm policy add dev l2tpeth0 dir in tmpl proto esp spi 201<br>iptables -t nat -A POSTROUTING -o eth1 -s 10.53.1.2 -j MASQUERADE<br></code></pre>\n</li>\n<li>\n<div>&#23458;&#25143;&#31471;&#21019;&#24314;&#21152;&#23494;&#38567;&#36947;<code>ipsec0</code></div>\n<pre><code>ip tunnel add ipsec0 mode ipip local 10.53.0.2 remote 10.53.0.1 dev l2tpeth0<br>ip addr add 10.53.1.2 peer 10.53.1.1 dev ipsec0<br>ip link set ipsec0 up<br>ip xfrm state add src 10.53.0.2 dst 10.53.0.1 proto esp spi 201 enc blowfish 0xc0de0201<br>ip xfrm state add src 10.53.0.1 dst 10.53.0.2 proto esp spi 102 enc blowfish 0xc0de0102<br>ip xfrm policy add dev l2tpeth0 dir out tmpl proto esp spi 201<br>ip xfrm policy add dev l2tpeth0 dir in tmpl proto esp spi 102<br>ip route del 8.8.8.8<br>ip route add 8.8.8.8 10.53.1.1<br></code></pre>\n</li>\n</ol>\n<h2><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E5%85%B3%E9%97%ADvpn\"></a>&#20851;&#38381;VPN</h2>\n<div>&#22914;&#26524;&#27809;&#26377;&#35774;&#32622;IPsec&#65292;&#21487;&#20197;&#24573;&#30053;<code>#ipsec</code>&#20043;&#21518;&#30340;&#21629;&#20196;&#12290;</div>\n<ol>\n<li>\n<div>&#26381;&#21153;&#31471;</div>\n<pre><code>iptables -t nat -D INPUT -i eth1 -p udp --dport 5353 -m u32 --u32 '0&gt;&gt;22&amp;0x3C@12 = 0xdeadbeef &amp;&amp; 0&gt;&gt;22&amp;0x3C@16 = 0xbaadc0de &amp;&amp; 0&gt;&gt;22&amp;0x3C@20 = 0xfaceb00c' -j SNAT --to-source $DUMMY_IP:6464<br>iptables -t nat -D POSTROUTING -o $SERVER_IF -s 10.53.0.2 -j MASQUERADE<br>#ipsec<br>ip xfrm state del src 10.53.0.1 dst 10.53.0.2 proto esp spi 102<br>ip xfrm state del src 10.53.0.2 dst 10.53.0.1 proto esp spi 201<br>ip xfrm policy del dev l2tpeth0 dir out<br>ip xfrm policy del dev l2tpeth0 dir in<br>iptables -t nat -D POSTROUTING -o $SERVER_IF -s 10.53.1.2 -j MASQUERADE<br></code></pre>\n</li>\n<li>\n<div>&#23458;&#25143;&#31471;</div>\n<pre><code>ip route del $SERVER_IP<br>#ipsec<br>ip xfrm state del src 10.53.0.2 dst 10.53.0.1 proto esp spi 201<br>ip xfrm state del src 10.53.0.1 dst 10.53.0.2 proto esp spi 102<br>ip xfrm policy del dev l2tpeth0 dir out<br>ip xfrm policy del dev l2tpeth0 dir in<br></code></pre>\n</li>\n<li>\n<div>&#20844;&#20849;</div>\n<pre><code>ip tunnel del ipsec0<br>ip l2tp del tunnel tunnel_id 1<br></code></pre>\n</li>\n</ol>\n<h2><a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/klzgrad/5661b64596d003f61980#%E9%99%84%E5%BD%95\"></a>&#38468;&#24405;</h2>\n<div>&#26410;&#21152;&#23494;&#30340;&#38567;&#36947;&#23458;&#25143;&#31471;tcpdump&#30417;&#21548;<code>curl google.com</code>&#33021;&#30475;&#21040;&#20197;&#19979;&#23553;&#21253;&#32467;&#26500;&#65306;</div>\n<pre><code>Internet Protocol Version 4, Src: 192.168.1.2, Dst: xxx.xxx.xxx.xxx<br>User Datagram Protocol, Src Port: 59126, Dst Port: 5353<br>Layer 2 Tunneling Protocol version 3<br>    Packet Type: Data    Message Session Id=0xdeadbeef<br>    Reserved: 0x0000<br>    Session ID: 0xdeadbeef<br>    Cookie: baadc0defaceb00c<br>Default L2-Specific Sublayer<br>Ethernet II, Src: xx:xx:xx:xx:xx:xx, Dst: xx:xx:xx:xx:xx:xx<br>Internet Protocol Version 4, Src: 10.53.0.2, Dst: 74.125.226.166 (google.com)<br>Transmission Control Protocol, Src Port: 39057, Dst Port: 80, Seq: 1, Ack: 1, Len: 74<br>Hypertext Transfer Protocol<br></code></pre>\n<div>Foo-over-UDP&#38567;&#36947;&#19982;&#38745;&#24577;L2TP&#38567;&#36947;&#38750;&#24120;&#31867;&#20284;&#65292;&#21306;&#21035;&#21482;&#26159;UDP&#37324;&#38754;&#27809;&#26377;&#23553;&#35013;L2TP&#21253;&#22836;&#21644;&#20197;&#22826;&#21253;&#22836;&#65306;</div>\n<pre><code>modprobe fou<br># on the server<br>ip fou add port 5353 ipproto 4<br>iptables -t nat -A INPUT -i eth0 -p udp --dport 5353  -j SNAT --to-source 10.53.0.255:6464<br>ip link add udptun0 type ipip local $SERVER_IP remote 10.53.0.255 encap fou encap-sport 5353 encap-dport 6464<br>ip addr add 10.53.0.1 peer 10.53.0.2 dev udptun0<br>ip link set udptun0 up<br>...<br><br># on the client<br>ip fou add port 6464 ipproto 4<br>ip link add udptun0 type ipip local $CLIENT_IP remote $SERVER_IP encap fou encap-sport 6464 encap-dport 5353<br>ip addr add 10.53.0.2 peer 10.53.0.1 dev udptun0<br>ip link set udptun0 up<br>...</code></pre>\n<p>&#21407;&#22320;&#22336;&#65306;https://gist.github.com/klzgrad/5661b64596d003f61980</div>\n<div>&#32763;&#22681;&#25216;&#26415;&#21338;&#23458;<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.chinagfw.org/2013/09/blog-post.html\">&#35746;&#38405;&#22320;&#22336;&#21450;&#31038;&#20132;&#24080;&#21495;</a></div></p>\n","author":1005,"categories":[18270,18269,15300],"tags":[26049]}