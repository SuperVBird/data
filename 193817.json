{"id":193817,"link":"https://chinadigitaltimes.net/chinese/2011/11/翻墙-openvz-vps-配置-openvpn/","date":"2011-11-03T20:02:00Z","modified":"2011-11-03T20:02:00Z","title":"翻墙 | OpenVZ VPS 配置 OpenVPN","content":"<p><p>来源：<a rel=\"nofollow\" target=\"_blank\" href=\"http://igfw.tk/archives/6129\">http://igfw.tk/archives/6129</a></p>\n<p>前两天在hellohost上购买了一款128内存的linux VPS，无奈发现LNMP一键包装不上，LAMP装上后内存直接爆满，连登录都登陆不了了，小内存的VPS伤不起啊，只好用来配置VPN和SSH用来做一些特殊用途，而OpenVZ VPS貌似只能配置openvpn 。</p>\n<div>首先联系你的VPS服务商让他把TUN/TAP功能打开，默认大部分都是关闭的，你可以用以下命令检测：<br />cat /dev/net/tun<br />若返回以下结果表示OK<br />cat: /dev/net/tun: File descriptor in bad state</div>\n<div><span></span></div>\n<h2>安装openvpn</h2>\n<div>1、添加源</div>\n<blockquote>\n<div>rpm -Uvh <a rel=\"nofollow\" target=\"_blank\" href=\"http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-4.noarch.rpm\">http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-4.noarch.rpm</a></div>\n</blockquote>\n<div>2、安装</div>\n<blockquote>\n<div>yum -y install openvpn</div>\n</blockquote>\n<div>3、将easy-rsa移动到一个方便操作的位置。</div>\n<blockquote>\n<div>cp -R /usr/share/openvpn/easy-rsa /etc/openvpn/</div>\n</blockquote>\n<div>4、进入目录</div>\n<blockquote>\n<div>cd /etc/openvpn/easy-rsa/2.0</div>\n</blockquote>\n<h2>生成证书</h2>\n<div>1、证书国别、名字之类的个人感觉不修改也没什么问题，如要修改运行</div>\n<blockquote>\n<div>vi vars</div>\n</blockquote>\n<div>2、运行以下命令</div>\n<blockquote>\n<div> ./clean-all</div>\n<div> source ./vars                    #使设置生效</div>\n<div>./build-ca server                #创建证书颁发机构CA，一路回车</div>\n<div>./build-key-server server  #生成服务器证书，一路回车，最后两个y</div>\n<div>./build-key bsk                  #生成名为bsk的客户证书，一路回车，最后两个y</div>\n<div>./build-dh                           #生成Diffie Hellman参数</div>\n</blockquote>\n<h2>编辑openvpn配置文件</h2>\n<div>\n<blockquote>\n<div>cd /etc/openvpn/</div>\n<div>vi server.conf</div>\n</blockquote>\n</div>\n<div>输入以下内容</div>\n<div>\n<blockquote>\n<div>port 443</div>\n<div>proto tcp</div>\n<div>dev tun</div>\n<div>ca /etc/openvpn/easy-rsa/2.0/keys/ca.crt</div>\n<div>cert /etc/openvpn/easy-rsa/2.0/keys/server.crt</div>\n<div>key /etc/openvpn/easy-rsa/2.0/keys/server.key</div>\n<div>dh /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem</div>\n<div>server 192.168.0.0 255.255.255.0</div>\n<div>push “redirect-gateway def1″</div>\n<div>push “dhcp-option DNS 8.8.8.8″</div>\n<div>push “dhcp-option DNS 8.8.4.4″</div>\n<div>client-to-client</div>\n<div>keepalive 10 120</div>\n<div>comp-lzo</div>\n<div>persist-key</div>\n<div>persist-tun</div>\n<div>verb 3</div>\n</blockquote>\n</div>\n<h2>配置端口转发</h2>\n<div>\n<blockquote>\n<div>vi /etc/sysctl.conf</div>\n</blockquote>\n</div>\n<div>将net.ipv4.ip_forward = 0改成net.ipv4.ip_forward = 1，将net.ipv4.tcp_syncookies = 1改为#net.ipv4.tcp_syncookies = 1保存，执行sysctl -p使之生效。</div>\n<div>输入</div>\n<blockquote>\n<div>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j SNAT –to-source 1.2.3.4  #1.2.3.4为你的vps IP</div>\n<div>/etc/init.d/iptables save              #保存iptables设置</div>\n<div>/etc/init.d/iptables restar            #重启iptables</div>\n</blockquote>\n<h2>添加开机启动</h2>\n<div>\n<blockquote>\n<div>vi /etc/rc.local</div>\n</blockquote>\n</div>\n<div>添加一行</div>\n<div>\n<blockquote>\n<div>/usr/sbin/openvpn –config /etc/openvpn/server.conf &#038;</div>\n</blockquote>\n</div>\n<h2>启动openvpn</h2>\n<blockquote>\n<div>openvpn –config /etc/openvpn/server.conf &#038;</div>\n</blockquote>\n<div>至此服务端配置完毕。</div>\n<h2>在windows使用openvpn</h2>\n<div>1、下载安装openvpn</div>\n<div>2、在服务器  /etc/openvpn/easy-rsa/2.0/keys/ 文件夹中用sftp类软件下载ca.crt、bsk.crt和bsk.key这三个文件放在openvpn客户端安装路径下得config文件夹中。</div>\n<div>3、在config下新建一个名字为“bsk.ovpn”的文本文件</div>\n<div>\n<blockquote>\n<div>client</div>\n<div>dev tun</div>\n<div>proto tcp</div>\n<div>remote 1.2.3.4 443</div>\n<div>resolv-retry infinite</div>\n<div>nobind</div>\n<div>persist-key</div>\n<div>persist-tun</div>\n<div>ca ca.crt</div>\n<div>cert client1.crt</div>\n<div>key client1.key</div>\n<div>ns-cert-type server</div>\n<div>comp-lzo</div>\n<div>verb 3</div>\n</blockquote>\n<div>将1.2.3.4修改为你的VPS IP</div>\n<div>4、运行 OpenVPN GUI，然后connect。</div>\n</div>\n<div><strong>PS：</strong>如果windows的openvpn可以连接到服务端但是所有网页都打不开可能是iptables没有设置好，请重新配置端口转发。</div>\n<div><strong>PPS：</strong>添加新用户只需运行如下两条命令即可</div>\n<blockquote>\n<div> source ./vars</div>\n<div>./build-key bsk</div>\n</blockquote>\n<div>千万不要运行./clean-all ，否则会将以前生成的证书删除。</div>\n<p><strong>原文：</strong><a rel=\"nofollow\" target=\"_blank\" href=\"http://www.lingbaoboy.com/archives/592.html\">http://www.lingbaoboy.com/archives/592.html</a></p>\n<p>  <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gocomments/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/godelicious/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/delicious/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gofacebook/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/facebook/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gotwitter/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/twitter/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gostumble/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/stumble/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/godigg/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/digg/xijie.wordpress.com/5271/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/goreddit/xijie.wordpress.com/5271/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/reddit/xijie.wordpress.com/5271/\" /></a> <img alt=\"\" border=\"0\" height=\"1\" src=\"http://stats.wordpress.com/b.gif?host=xijie.wordpress.com&#038;blog=10068099&#038;post=5271&#038;subd=xijie&#038;ref=&#038;feed=1\" width=\"1\" /></p>\n<p><img src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/5271/\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=738338\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"738338\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":983,"categories":[15300],"tags":[8510,8795]}