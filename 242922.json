{"id":242922,"link":"https://chinadigitaltimes.net/chinese/2012/07/翻墙-如何排查网络问题/","date":"2012-07-26T04:45:24Z","modified":"2012-07-26T04:45:24Z","title":"翻墙 | 如何排查网络问题","content":"<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://briteming.blogspot.com/2012/07/blog-post_1703.html\">http://briteming.blogspot.com/2012/07/blog-post_1703.html</a></p>\n<div></div>\n<div>\n<div dir=\"ltr\">  要用户判断自己能访问什么网站, 不能访问什么网站, 这很容易. 要判断服务器能否能为其他用户所访问则不那么直接, 我推荐各位使用<b><a rel=\"nofollow\" target=\"_blank\" href=\"http://webkaka.com\">webkaka.com</a></b> 的网站测速功能进行测试.</p>\n<p> 如果大部分国内节点的检测结果是正常, &#8220;内容下载速度(KB/s)&#8221; 较快, 则可能少数国内节点无法访问目标服务器, 出现了网络问题.</p>\n<p> 如果出现的问题属于客户端问题, 请向专业的维护人员求助; 如果出现的问题属于服务器问题, 请尽快联系站长; 如果是网络问题, 请按照下文进行排查.</p>\n<p>网络是分层的<br />但是网络是分层的, 我们每天使用的互联网各层之间的分离是如此透明, 导致用户在浏览网站时根本不知道&#8221;用浏览器访问一个网页&#8221; 这个行为背后到底发生了些什么. 所以在排查网络问题的时候, 也应该用分层的思想来进行排查, 仅仅提出&#8221;为什么我上不了某个网站&#8221; 这个疑问对于解决问题毫无助益.</p>\n<p>按照TCP/IP 参考模型, 网络由低到高可以分成连接层, 网络层, 传输层和应用层 这四层. 在排查网络问题的过程中, 一般只需要通过应用层和传输层就能发现问题的原因, 网络层的ICMP 协议常用于判断连接性, 只有在很特殊的情况下才需要深入到网络层的IP 协议 (如某些长度的packet 不能通过某些路由器).</p>\n<p>关于TCP/IP 参考模型, 可以读一读wikipedia 上的词条 <a rel=\"nofollow\" target=\"_blank\" href=\"http://en.wikipedia.org/wiki/Internet_protocol_suite\">http://en.wikipedia.org/wiki/Internet_protocol_suite</a> , 这个网页也可以作为网络协议速查表使用.</p>\n<p>访问一个网页的背后<br />要知道浏览器为什么不能访问某个网络资源, 首先要明白浏览器访问某个网络资源时, 究竟发生了些什么. 从用户输入网址到浏览器开始获取资源, 这个过程可以简化成如下步骤:</p>\n<p>    客户端进行DNS 查询, 获得目标服务器的ip 地址;<br />    客户端与目标ip 上的目标端口建立TCP 连接(三次握手);<br />    客户端向目标服务器发送HTTP 请求;<br />    目标服务器返回数据</p>\n<p>而浏览网页时可能发生的网络问题, 就发生在这些步骤里, 通常为:</p>\n<p>    客户端无法建立到DNS 服务器的连接 (传输层, 通常为UDP 连接, 也可能为TCP连接);<br />    DNS 服务器没有返回正确的查询结果 (应用层);<br />    客户端无法建立到目标ip 上目标端口的连接 (传输层, TCP连接);<br />    客户端无法建立到目标服务器的HTTP 连接 (应用层);</p>\n<p>把脉</p>\n<p>如同所有的医生, 你需要各种器械来进行诊断, 以判断一个问题到底发生在哪一层, 然后才能对症下药. 针对各层, 我推荐如下诊断工具:<br /> 层       协议       Windows       *nix <br /> 网络层       ICMP       ping       ping <br /> 网络层       ICMP       tracert       traceroute <br /> 网络层       ICMP       mturoute       - <br />  传输层       TCP       tcping       - <br /> 传输层       TCP       tracetcp       - <br /> 传输层       UDP       ftrace       - <br /> 应用层       DNS       nslookup       - <br /> 应用层       HTTP       wget       wget <br /> 应用层       HTTP       firebug       firebug </p>\n<p>*注: ping 系用于检测连通性, trace 系用于寻找问题节点; firebug 是Firefox 的扩展, Chrome 和ie 的开发者工具(F12) 与之功能类似; 本文仅描述思路, 关于这些工具如何使用, 请读者自行Google。</p>\n<p>在排查时建议从高层向底层逐层排查,  </p>\n<p>如果 &#8220;正在解析主机 <a rel=\"nofollow\" target=\"_blank\" href=\"http://urdomain.com\">urdomain.com</a>&#8221; 的结果不是这个样子, 则DNS 查询结果出错, 需要对DNS 服务器进行排查 ( nslookup <a rel=\"nofollow\" target=\"_blank\" href=\"http://urdomain.com\">urdomain.com</a> ).</p>\n<p>如果客户端无法建立连接目标服务器的TCP 连接, 需要用tcping 和tracetcp 进行排查.<br />附: 本文提到的部分工具的项目地址</p>\n<p>tcping <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.elifulkerson.com/projects/tcping.php\">http://www.elifulkerson.com/projects/tcping.php</a><br />mturoute <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.elifulkerson.com/projects/mturoute.php\">http://www.elifulkerson.com/projects/mturoute.php</a><br /> tracetcp <a rel=\"nofollow\" target=\"_blank\" href=\"http://tracetcp.sourceforge.net/\">http://tracetcp.sourceforge.net/</a><br />ftrace <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.r1ch.net/stuff/ftrace/\">http://www.r1ch.net/stuff/ftrace/</a><br />wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://gnuwin32.sourceforge.net/packages/wget.htm\">http://gnuwin32.sourceforge.net/packages/wget.htm</a><br /> firebug <a rel=\"nofollow\" target=\"_blank\" href=\"http://getfirebug.com/\">http://getfirebug.com/</a></div>\n<div><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/3403047092945482439-6032918046667631006?l=briteming.blogspot.com\" alt=\"\" /></div>\n</p></div>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\" https://mycdt0.info\"> https://mycdt0.info</a>，穿墙访问《中国数字时代》（当看到“此网站的安全证书有问题”的提示时，请选择“继续浏览此网站(不推荐)”，忽略证书警告并继续访问网站）。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-2103650304176918590?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=2ea93c5b7b\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/msuvD\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[7775,8795]}