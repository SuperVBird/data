{"id":170122,"link":"https://chinadigitaltimes.net/chinese/2011/08/通过开源程序同时解决dns劫持和dns污染的问题/","date":"2011-08-02T23:30:28Z","modified":"2011-08-02T23:30:28Z","title":"通过开源程序同时解决DNS劫持和DNS污染的问题","content":"<p><p>来源：<a href=\"http://www.adagio.com.nu/?p=581\">http://www.adagio.com.nu/?p=581</a>   </p>\n<p>我们知道，某些网络运营商为了某些目的，对DNS进行了某些操作，导致使用ISP的正常上网设置无法通过域名取得正确的IP地址。常用的手段有：DNS劫持和DNS污染。关于DNS劫持和DNS污染的区别，请查找相关文章。</p>\n<p> 对付DNS劫持的方法很简单，只需要把系统的DNS设置改为为国外的DNS服务器的IP地址即可解决。但是对于DNS污染，一般除了使用代理服务器和 VPN之类的软件之外，并没有什么其它办法。但是利用我们对DNS污染的了解，还是可以做到不用代理服务器和VPN之类的软件就能解决DNS污染的问题， 从而在不使用代理服务器或VPN的情况下访问原本访问不了的一些网站。当然这无法解决所有问题，当一些无法访问的网站本身并不是由DNS污染问题导致的时 候，还是需要使用代理服务器或VPN才能访问的。</p>\n<p><span></span></p>\n<p> 我们知道，DNS污染的数据包并不是在网络数据包经过的路由器上，而是在其旁路产生的。所以DNS污染并无法阻止正确的DNS解析结果返回，但由于旁路 产生的数据包发回的速度较国外DNS服务器发回的快，操作系统认为第一个收到的数据包就是返回结果，从而忽略其后收到的数据包，从而使得DNS污染得逞。 而某些国家的DNS污染在一段时期内的污染IP却是固定不变的，从而可以忽略返回结果是这些IP地址的数据包，直接解决DNS污染的问题。</p>\n<p> 在这里我用Java做了一个简单的小程序并提供源代码，在本机运行后，就能在没有代理服务器和VPN的情况下，直接就能解决DNS污染的问题了。如果没 有安装Java，可以去<a href=\"http://www.java.com/\">http://www.java.com/</a>上安装一个。解开AntiDnsPollution.zip之后，运行 filter.bat（Linux用户请运行filter.sh），等待启动成功。然后设置系统的DNS服务器的IP地址为127.0.0.1即可。然后 打开一个命令行窗口，执行nslookup一些被DNS污染的域名，是不是解析正确了？</p>\n<p> 下面说一下这个小程序的具体工作流程：首先程序启动后，会从文本文件dnsfilter.properties中读取配制，然后去一个不存在的DNS服 务器――但这个IP地址却是国外的――中进行DNS查询被劫持的域名，然后返回的IP地址就是被劫持的IP，被记录下来，之后正常的DNS查询中，就自动 把这些IP地址过滤了。这个程序以后会不定期更新，或许也会出。NET版本，请在我的Google Reader上关注更新。</p>\n<p> 对于高级用户，可以手动用文本编辑器修改配置文件dnsfilter.properties：</p>\n<p> BindToIP：小程序启动后作为DNS服务期绑定53端口，这里指定绑定的IP地址</p>\n<p> DnsServer：国外的DNS服务器，可以设置为OpenDNS或Google DNS服务器的IP地址</p>\n<p> ResponseTimeout：DNS查询返回超时的时间（毫秒）</p>\n<p> TestDnsServer：测试DNS服务器，请指定一个不存在的DNS服务期，但要求IP是国外的</p>\n<p> TestRespTimeout：测试DNS服务器的查询返回超时时间（毫秒），也就是DNS劫持的旁路回复超时时间</p>\n<p> TestCount：测试DNS服务器的次数，为了得到所有被劫持的IP地址，需要一定的测试次数</p>\n<p> 小程序的执行文件和源代码在同一个压缩包内，请点下面的链接下载（含源代码）。</p>\n<p> 下载：<a href=\"http://www.williamlong.info/download/AntiDnsPollution.zip\">不依赖于Java环境的可执行程序（含源码）</a></p>\n<p> 下载：<a href=\"http://www.williamlong.info/download/AntiDnsPollutionJava.zip\">依赖于Java环境的程序（含源码）</a></p>\n<p> 作者Email： lehui99(at)<a href=\"http://gmail.com\">gmail.com</a> ，作者Google Reader：<a href=\"https://www.google.com/reader/shared/lehui99\">https://www.google.com/reader/shared/lehui99</a></p>\n<p>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godelicious/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/delicious/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gofacebook/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/facebook/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gotwitter/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/twitter/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gostumble/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/stumble/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godigg/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/digg/xijie.wordpress.com/4831/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/goreddit/xijie.wordpress.com/4831/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/reddit/xijie.wordpress.com/4831/\" /></a> <img alt=\"\" border=\"0\" height=\"1\" src=\"http://stats.wordpress.com/b.gif?host=xijie.wordpress.com&#038;blog=10068099&#038;post=4831&#038;subd=xijie&#038;ref=&#038;feed=1\" width=\"1\" /></p>\n</p>\n<p><img src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/4831/\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":964,"categories":[15300],"tags":[8510,8795]}