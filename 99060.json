{"id":99060,"link":"https://chinadigitaltimes.net/chinese/2010/08/twitter如何在数千台服务器上快速部署代码？/","date":"2010-08-18T10:11:05Z","modified":"2010-08-18T14:50:51Z","title":"Twitter如何在数千台服务器上快速部署代码？","content":"<p><p>来自: <a href=\"http://www.feedzshare.com/b/126190/2\">博客园新闻频道 &#8211; FeedzShare</a>  <br />\n<br />发布时间:2010年08月16日,  已有 9 人推荐 </p>\n<hr>\n<div>\n<p><img src=\"http://pic002.cnblogs.com/img/dudu/201008/2010081612071216.jpg\" alt=\"\" /></p>\n<p>　　答案是：用BT，也就是你我应该都很熟悉的BitTorrent。</p>\n<p>　　对于网站经营者、创业者来说，扩展性的问题是在网站流量成长过程中势必会面对的问题，如何建立一个具有扩展性的架构(scalable architecture)便是在规划网站事业过程中不可或缺的专业知识。</p>\n<p>　　如果服务本身的功能性符合用户需求，却因为架构、程序性能、数据库性能的问题导致服务增长出现瓶颈时，如何评估、分析网站性能瓶颈？厘清问题后如何找出对应的解決方案，可以思考的相关议题可能包括：</p>\n<ul>\n<li>如何有效率地厘清问题？从客户端的数据（读取时间）或是从服务器端的log日志、硬件的负载率？</li>\n<li>网站性能瓶颈是出現在Client或Server端？是数据库撑不住还是程序性能不好？是Request太多还是数据太大？</li>\n<li>Web Server、DB server如何挤出更多的资源？挤不出资源后如何扩展？扩展后会遇到什么问题？</li>\n</ul>\n<p>　　参考国外知名网站在架构上的做法是很好的一种方式，尽管服务的规模可能无法相比，但根据「正确的做法与经验」踏出对的第一步，肯定是有助于突破网站运营的性能瓶颈。</p>\n<p>　　Twitter身为全球最大的微博服务，运用数千台的服务器提供服务给来自全球各地的用户，然而每当网站內容、应用程序有更新时，如何尽可能地在最短的时间內将程序代码部署(deploy)到所有的服务器便是相当重要的课题。</p>\n<p>　　Twitter的博客上的一篇文章：「<a rel=\"nofollow\" href=\"http://engineering.twitter.com/2010/07/murder-fast-datacenter-code-deploys.html\">Murder: Fast datacenter code deploys using BitTorrent</a>」（不能直接访问）分享了Twitter如何持续改善应用程序的部署流程，在过去Twitter使用<a rel=\"nofollow\" href=\"http://www.capify.org/index.php/Capistrano\">Capistrano</a>部署应用程序，Capistrano是许多Ruby/Rails使用者（当然也有其他语言的开发人员会使用）用来部署程序代码的一个开源项目，开发人员在部署程序代码的过程中都可以通过自动化的部署流程来简化经常重复的工作，尤其在项目必须同时部署到多台应用程序服务器时会特別方便。</p>\n<p>　　Twitter在早期便依赖Capistrano来进行应用程序的部署，每当有新版本的程序代码需要发布时，Capistrano会根据预设好的各种设置、流程到Twitter所有的服务器上进行更新的操作，在过去服务器还不多的情況下一切都很美好，但随着Twitter服务器数量的增长，到了几百台服务器时，事情已经不再像过去一样美好，甚至到后来拥有数千台服务器时，更新的操作会耗费40分钟。</p>\n<p>　　Twitter针对这个问题，认为问题的关键在于：使用集中式的系统，也就是所有的服务器要轮流排队到同一台版本控制系统上进行代码更新。Twitter最初的想法是将版本控制系统也做出分散式的架构，服务器的代码更新就可以分散到不同的机器来压缩部署时间，但事实上版本控制系统即使分散在多台服务器上，这些服务器要更新文件也同样需要时间。因此Twitter发现或许需要一个完全去中心化、最好是像BitTorrent这样的，利用P2P的特点让所有的节点都可以协助进行程序代码的更新。</p>\n<p>　　从结果来看，在采<strong>用了BitTorrent的方式来更新代码，部署的时间从40分钟大幅减少到只要12秒！</strong>实在是非常惊人的改善，数千台服务器的代码更新居然只要短短12秒就能完成。</p>\n<p>　　Twitter也将此次部署流程改善的成果分享出來，项目名称叫做<a rel=\"nofollow\" href=\"http://github.com/lg/murder\">Murder</a>，如果对于技术细节有兴趣的读者，可以再进行深入的研究；笔者简单摘录几个重点如下：</p>\n<ul>\n<li>Murder是以BitTornado为基础开发出来的（BitTornado是一种BitTorrent client）。</li>\n<li>Murder的定位是「协助我们快速地将文件部署到大批服务器上」。</li>\n<li>利用BitTorrent的部署方式可避免防火墙的问题、拥有非常快的传输速度。</li>\n<li>实际的部署代码是搭配Capistrano进行，网页上有很清楚的说明。</li>\n</ul>\n<p>　　以下是Twitter的架构工程师Larry Gadea谈Murder的视频（不能直接访问）：</p>\n<p>　　<a rel=\"nofollow\" href=\"http://vimeo.com/11280885\">Twitter – Murder Bittorrent Deploy System</a> from <a rel=\"nofollow\" href=\"http://vimeo.com/user3690378\">Larry Gadea</a> on <a rel=\"nofollow\" href=\"http://vimeo.com/\">Vimeo</a>.</p>\n<p>　　原文标题：Twitter如何在數千台伺服器上快速部署程式碼</p>\n<p>　　原文链接：<a href=\"http://www.inside.com.tw/07/17/how-twitter-deploys-application-to-thousands-of-servers\">http://www.inside.com.tw/07/17/how-twitter-deploys-application-to-thousands-of-servers</a></p>\n<p>　　简体版编译：博客园</p>\n<p>　　相关新闻：<br />　　· <a href=\"http://news.cnblogs.com/n/69759/\">Twitter将进行长达5小时的维护</a><span>(2010-08-01)</span><br />　　· <a href=\"http://news.cnblogs.com/n/70703/\">Twitter正式发布Tweet按钮 可分享外网文章</a><span>(2010-08-13)</span><br />　　· <a href=\"http://news.cnblogs.com/n/69515/\">Twitter启动用户信息流API桌面客户端测试</a><span>(2010-07-29)</span><br />　　· <a href=\"http://news.cnblogs.com/n/70034/\">分析：Twitter和Facebook谁是真正赢家</a><span>(2010-08-04)</span><br />　　· <a href=\"http://news.cnblogs.com/n/66212/\">Twitter警告世界杯期间可能宕机</a><span>(2010-06-12)</span></p>\n<p>　　本文链接：<a href=\"http://news.cnblogs.com/n/70899/\">http://news.cnblogs.com/n/70899/</a></p>\n<p>　　<a href=\"http://job.cnblogs.com\">程序员找工作，就在博客园</a></p>\n<p>　　<a href=\"http://a4.yeshj.com/rd/34138/\">每天10分钟，轻松学外语</a></p>\n<p><img src=\"http://news.cnblogs.com/news/rssclick.aspx?id=70899\" width=\"1\" height=\"1\" alt=\"\" /></div>\n<p><img src=\"http://img.tongji.linezing.com/1017243/tongji.gif\" /><img src=\"http://img.tongji.linezing.com/997968/tongji.gif\" /></p>\n<p>“要翻墙，<a href=\"http://idajiangyou.info\" target=\"_blank\">用赛风”</a>.</p>\n","author":176,"categories":[9203],"tags":[8800]}