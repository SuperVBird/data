{"id":195957,"link":"https://chinadigitaltimes.net/chinese/2011/11/翻墙-mac下开机自动连接ssh-d/","date":"2011-11-14T07:00:40Z","modified":"2012-02-17T00:06:09Z","title":"翻墙 | Mac下开机自动连接ssh -D","content":"<p><p>ssh -D命令可以为用户提供sock5代理，这也是目前国内用户最经济的fan墙方案。他有价格便宜，使用简单等诸多优点。但是每次开机都需要打开 Terminal，然后敲一句 ssh -qTfnN -D $port $user@$host,然后还要输入密码确实是一件非常麻烦的事情。再加上如果网络条件不好，ssh -D再后台断了都不知道。<br />\n所以今天在这里教大家使用Expect写的脚本自动连接ssh -D，然后使用launchd设置这段脚本开机自启。</p>\n<p><span></span></p>\n<p>首先是自动连接ssh -D的Expect脚本，你可以把这个脚本直接创建在/usr/local/bin 或 /usr/bin下面，这样本机所有的用户都可以直接调用这个脚本连接ssh -D了。在这里我们把这个脚本放到/usr/local/bin下命名为sshd。</p>\n<p>直接在Terminal输入以下命令回车。</p>\n<pre>sudo vi /usr/local/bin/sshd</pre>\n<p>在Password:后面输入你的密码。然后在弹出的”/usr/local/bin/sshd” [New File]字符界面上输入 “i”进入编辑状态。</p>\n<p>输入以下脚本：</p>\n<pre>#!/usr/bin/expect -f\nset port <span style=\"color: #ff0000;\">9000</span>\nset user <span style=\"color: #ff0000;\">username</span>\nset host <span style=\"color: #ff0000;\">yourserver.com</span>\nset password <span style=\"color: #ff0000;\">passwd</span>\nset timeout -1 \n\nspawn ssh -qTfnN -D $port $user@$host\nexpect \"*assword:*\"\n\nsend \"$passwordr\"\n\ninteract\n#expect eof</pre>\n<p>其中9000那改成你要设置的sock5代理的本地端口，username那输入你的ssh服务的用户名，yourserver.com是你的ssh服务器地址或者IP，Passwd是你的ssh密码。<br />\n编辑完成后，按esc退出编辑状态，然后输入“:wq”保存并退出编辑界面。</p>\n<p>接着给/usr/local/bin/sshd加上可执行权限。</p>\n<pre>sudo chmod +x /usr/local/bin/sshd</pre>\n<p>这样的话，你每次直接在Terminal下面输入 /usr/local/bin/sshd ，就可以直接启动ssh -D了。</p>\n<p>不过本着还可以更懒的选择，我们用launchd设置这段脚本开机自启。</p>\n<p>在/Library/LaunchDaemons/下创建一个plist文件，文件名为 com.hebine.sshd.plist （这个文件名大家可以根据自己的喜好随便选。）<br />\nTerminal下输入命令</p>\n<pre>sudo vi /Library/LaunchDaemons/com.hebine.sshd.plist</pre>\n<p>文件内输入以下内容</p>\n<pre><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>Disabled</key>\n<false/>\n<key>KeepAlive</key>\n<true/>\n<key>Label</key>\n<string>com.hebine.sshd</string>\n<key>ProgramArguments</key>\n<array>\n<string>/Users/Ksky/Dropbox/Tools/sshd</string>\n</array>\n<key>RunAtLoad</key>\n<true/>\n<key>StandardOutPath</key>\n<string>/var/log/sshd-out.log</string>\n<key>StandardErrorPath</key>\n<string>/var/log/sshd-err.log</string>\n</dict>\n</plist></pre>\n<p>sshd的日志文件保存在/var/log/sshd-err.log 和 /var/log/sshd-out.log这两个地方。<br />\n然后修改此文件的权限</p>\n<pre>sudo chown -R root:wheel /Library/LaunchDaemons/com.hebine.sshd.plist\nsudo chmod 644 /Library/LaunchDaemons/com.hebine.sshd.plist</pre>\n<p>重启电脑，OK。</p>\n<p><strong>来源</strong>：<a rel=\"nofollow\" target=\"_blank\" href=\"http://blog.hebine.com/archives/1599.html\">http://blog.hebine.com/archives/1599.html</a></p>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":983,"categories":[15300],"tags":[8795]}