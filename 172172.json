{"id":172172,"link":"https://chinadigitaltimes.net/chinese/2011/08/用ssh加密dns查询的方法/","date":"2011-08-15T01:30:30Z","modified":"2011-08-15T01:30:30Z","title":"用ssh加密DNS查询的方法","content":"<p>来源：<a href=\"http://igfw.tk/archives/4408\">http://igfw.tk/archives/4408</a></p>\n<div>\n<div>\n<div>\n<div>\n<p>现在<a href=\"http://igfw.tk/archives/2960\">解决DNS污染的方法</a>一 般是通过修改使DNS使用TCP协议传输和通过延迟DNS查询舍弃GFW干扰的IP来获得真实IP。这两种方法的原理不同，通过修改使DNS使用TCP协 议传输的原理是DNS传输默认使用UDP传输所以GFW的DNS污染也是在UDP传输层，至少现在还没有干扰TCP传输层的DNS请求，所以使用TCP协 议请求的DNS查询目前是不受DNS污染的，不过不能保证以后GFW不会这么干；通过延迟DNS查询的原理是这样的，GFW的DNS污染是这样的，比如你 电脑发出一个域名的DNS查询请求就会通过域名服务器查询，这个过程中GFW检测在其黑名单里的域名，然后迅速返回给你的电脑一个假IP，而你的电脑却把 它当成真的了，等一会DNS服务器查询到的真实IP返回给你就会被系统舍弃，DNS污染就这么着发生了，如果你通过软件延迟DNS查询，等待真实IP返回 再返回给系统，这样就解决了DNS污染。（<a href=\"http://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8B%99%E5%99%A8%E7%B7%A9%E5%AD%98%E6%B1%A1%E6%9F%93\">域名服务器缓存污染</a>）</p>\n<p><span></span></p>\n<p>不过即使这两种都被干扰了你也可以使用VPN或ssh加密DNS查询。</p>\n<p>使用VPN的方法可以参考 <a href=\"http://igfw.tk/archives/2483\">http://igfw.tk/archives/2483</a> 修改路由表让8.8.8.8通过vpn然后设置本机DNS为8.8.8.8，不过这个对个人翻墙就画蛇添足了。</p>\n<p>用ssh加密DNS查询的方法还是有用的，以下是网友路人甲提供的方法，有兴趣的可以研究下。</p>\n<blockquote>\n<p>我找到一个可以用ssh加密DNS查询的方法<br /> 用plink命令， 把下文&#8221;密码&#8221;&#8221;用户名&#8221;&#8221;SSH服务器端口&#8221;&#8221;SSH服务器地址&#8221; 改成你找到的SSH帐号</p>\n<p>plink -N -v -D <a href=\"http://127.0.0.1:5123\">127.0.0.1:5123</a> -L 8853:<a href=\"http://8.8.8.8:53\">8.8.8.8:53</a> -pw 密码 -l 用户名 -P SSH服务器端口 SSH服务器地址</p>\n<p>这条命令运行后可以把本地的<a href=\"http://127.0.0.1:8853\">127.0.0.1:8853</a>当成是<a href=\"http://8.8.8.8:53\">8.8.8.8:53</a>的google DNS，因为做了端口转发。在网卡<br /> 的DNS设定上改成<a href=\"http://127.0.0.1:8853\">127.0.0.1:8853</a>就可以用SSH加密向8.8.8.8做DNS查询了。<br /> （同时这命令也开了一个<a href=\"http://127.0.0.1:5123\">127.0.0.1:5123</a>的本地端口做socks5代理，这样SSH帐号就物尽其用了）</p>\n<p>再结合dnsproxy.exe的cn域名用国内DNS查询的功能就十分完美了。既100%不被DNS污染也不会损失速度。</p>\n<p>==========================================================================</p>\n<p>说漏了，<a href=\"http://127.0.0.1:8853\">127.0.0.1:8853</a>要加在dnsproxy.exe的data/dnsproxy.conf里用，windows不能直用<a href=\"http://127.0.0.1:8853\">127.0.0.1:8853</a><br /> 因为windows只支持标准的53端口DNS服务器。</p>\n<p>不过在XP里可以把8.8.8.8的53端口转成本机的53端口，那命令改成这样<br /> plink -N -v -D <a href=\"http://127.0.0.1:5123\">127.0.0.1:5123</a> -L 53:<a href=\"http://8.8.8.8:53\">8.8.8.8:53</a> -pw 密码 -l 用户名 -P SSH服务器端口 SSH服务器地址</p>\n<p>win7里如果不想用dnsproxy.exe，又想用8.8.8.8就用psexec那招来绑定本机53端口吧。</p>\n<p>===========================================================================</p>\n<p>这个是为了以后，如果TCP查询DNS的方式也被关键字过滤封杀，预先作打算。</p>\n<p>Linux里也能用这样的端口转发，把plink改成ssh就行了(本来plink就是win版的ssh)</p>\n<p>ssh -N -v -D <a href=\"http://127.0.0.1:5123\">127.0.0.1:5123</a> -L 53:<a href=\"http://8.8.8.8:53\">8.8.8.8:53</a> -pw 密码 -l 用户名 -P SSH服务器端口 SSH服务器地址</p>\n<p>8.8.8.8的53端口就变成本机127.0.0.1的53端口了，如果本机开了DNS服务不能转发成本机53，<br /> 那就改成别的端口，然后加到本机DNS服务的上游DNS列表里。<br /> 比如改成8853端口</p>\n<p>plink -N -v -D <a href=\"http://127.0.0.1:5123\">127.0.0.1:5123</a> -L 8853:<a href=\"http://8.8.8.8:53\">8.8.8.8:53</a> -pw 密码 -l 用户名 -P SSH服务器端口 SSH服务器地址</p>\n<p>==================================================================================</p>\n<p>把命令写到批处理文件里就行了（bat或cmd后缀的txt文件），以后双击批处理运行就不用次次打一样的命令了。</p>\n<p>顺便说说plink从哪下，去putty主页下载plink新版, 在那堆文件列表里点plink.exe<br /> <a href=\"http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html\" rel=\"nofollow\">http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html</a></p>\n<p>之前的命令去掉端口转发就是一个纯粹连接ssh做socks5代理的命令。<br /> 例如连接SSH做个<a href=\"http://127.0.0.1:1080\">127.0.0.1:1080</a>的socks5代理</p>\n<p>plink -N -v -D <a href=\"http://127.0.0.1:1080\">127.0.0.1:1080</a> -pw 密码 -l 用户名 -P SSH服务器端口 SSH服务器地址</p>\n<p>注意：<br /> 那些参数 -N -v -D 之类的都是大小写敏感的，大写N或D之类的不能换成小写的。</p>\n<p>快可以写一个plink教程了…..</p>\n</blockquote>\n<p>有些内容可能要参考<a href=\"http://igfw.tk/archives/4300\">http://igfw.tk/archives/4300</a>路人甲提供的方法。</p>\n<p><strong>本文原始地址</strong>：<a href=\"http://igfw.tk/archives/4408\">http://igfw.tk/archives/4408</a></p>\n</div>\n</div>\n</div>\n</div>\n<h4>―――――――――――――――――――――――――――――――――――――――――</h4>\n<h4>需要翻墙利器? 请<a href=\"http://www.chinagfw.org/2011/04/wuala_18.html?utm_source=feedburner&#038;utm_medium=feed&#038;utm_campaign=Feed%3A+chinagfwblog+%28GFW+Blog%EF%BC%88%E5%8A%9F%E5%A4%AB%E7%BD%91%E4%B8%8E%E7%BF%BB%E5%A2%99%EF%BC%89%29\">安装Wuala</a>，查找和添加gfwblog为好友，就可高速下载翻墙软件，或访问<a href=\"http://tinyurl.com/gfwblog\"><b>http://tinyurl.com/gfwblog</b></a>直接下载。</p>\n<p>推特用户请点击<a href=\"http://qinzhigang.in/login.php\">这里</a>免翻墙上推特</h4>\n<p>请点击<a href=\"https://sesawe.net/-Tools-zh-.html\">这里</a>下载翻墙软件 </p>\n<p>更多翻墙方法请发电邮(最好用Gmail)到：<a href=\"mailto:fanqiang70ma@gmail.com\">fanqiang70ma@gmail.com</a>  </p>\n<p>请阅读和关注<a href=\"https://www.google.com/profiles/112915952962578336480\">中国数字时代</a>、<small>翻墙技术博客<a href=\"https://www.google.com/profiles/chinagfwblog\">GFW BLOG</a>（免翻墙） <br /> </small></p>\n<p>请使用<a href=\"https://www.google.com/reader/view/\">Google Reader</a><a href=\"https://www.google.com/reader/view/feed/http://chinadigitaltimes.net/chinese/feed\">订阅中国数字时代中文版</a>（<a href=\"http://chinadigitaltimes.net/chinese/feed\">http://chinadigitaltimes.net/chinese/feed</a>），阅读最有价值的中文信息；以及<a href=\"https://www.google.com/reader/view/feed/http://feeds2.feedburner.com/chinagfwblog\">GFW BLOG（功夫网与翻墙）</a><a href=\"http://feeds2.feedburner.com/chinagfwblog\">http://feeds2.feedburner.com/chinagfwblog</a>，获取最新翻墙工具和翻墙技巧信息。</p>\n<p> </p>\n<div>推特用户请点击<a href=\"http://edu20.in/login.php\">这里</a>免翻墙上推特<wbr><br />\n点击<a href=\"http://fanqiangsesawe.info\">这里</a>下载翻墙软件<br />\n更多翻墙方法请发电邮(最好用Gmail)到:gongminshehui1@gmail.com<br />\n翻墙技术博客<a href=\"https://www.google.com/profiles/chinagfwblog\">GFW BLOG</a>（免翻墙）<br />\n阅读<a href=\"http://www.google.com/profiles/112915952962578336480\">中国数字时代</a>（免翻墙）<img alt=\"\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-7214095379888019569?l=www.chinagfw.org\" width=\"1\" /></div>\n<div>\n<a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:yIl2AUoC8zA\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=yIl2AUoC8zA\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:-BTjWOF_DHI\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=DPOZTu5irIU:50IycE6R0ck:-BTjWOF_DHI\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:F7zBnMyn0Lo\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=DPOZTu5irIU:50IycE6R0ck:F7zBnMyn0Lo\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:V_sGLiPBpWU\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=DPOZTu5irIU:50IycE6R0ck:V_sGLiPBpWU\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:qj6IDK7rITs\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=qj6IDK7rITs\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:l6gmwiTKsz0\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=l6gmwiTKsz0\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:gIN9vFwOqvQ\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=DPOZTu5irIU:50IycE6R0ck:gIN9vFwOqvQ\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=DPOZTu5irIU:50IycE6R0ck:TzevzKxY174\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=TzevzKxY174\" /></a>\n</div>\n<p><img height=\"1\" src=\"http://feeds.feedburner.com/~r/chinagfwblog/~4/DPOZTu5irIU\" width=\"1\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=738338\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"738338\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":651,"categories":[15300],"tags":[8510,8795]}