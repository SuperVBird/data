{"id":144878,"link":"https://chinadigitaltimes.net/chinese/2011/04/opendns和google-dns并不是万能的/","date":"2011-04-16T04:30:40Z","modified":"2011-04-16T04:30:40Z","title":"OpenDNS和Google DNS并不是万能的","content":"<p>来源：<a href=\"http://f9y4ng.wordpress.com/2011/04/12/opendns%E5%92%8Cgoogle-dns%E5%B9%B6%E4%B8%8D%E6%98%AF%E4%B8%87%E8%83%BD%E7%9A%84/\">http://f9y4ng.wordpress.com/2011/04/12/opendns%E5%92%8Cgoogle-dns%E5%B9%B6%E4%B8%8D%E6%98%AF%E4%B8%87%E8%83%BD%E7%9A%84/</a></p>\n<p>说在开头，我并不建议用户OpenDNS或者Google DNS，为什么呢？因为使用OpenDNS 或 Google DNS并不能解决网络上N多文章所说的DNS劫持、回话污染、增加访问速度等问题，反而会带来一些让人哭笑不得的问题。 </p>\n<p><strong>首先，防DNS劫持、可翻墙神奇功能是不可能的：</strong></p>\n<p>DNS劫持是一种让访问用户由于得到虚假目标主机IP而不能与其通信的方法，是一种DNS缓存投毒攻击(DNS cache poisoning)。其工作方式为：在UDP端口53上的DNS查询进行入侵检测，一经发现与关键词相匹配的请求则立即伪装成目标域名的解析服务器 （NS，Name Server）给查询者返回虚假结果。由于通常的DNS查询没有任何认证机制，而且DNS查询通常基于的UDP是无连接不可靠的协议，查询者只能接受最先 到达的格式正确结果，并丢弃之后的结果。（这就是某墙或某流氓服务商的作用）</p>\n<p>所以只要是DNS的UDP包经过旁路设备，直接就会被篡改。对于一般互联网用户来说，由于系统默认使用的ISP提供的NS查询国外的权威服务器时被 劫持，其缓存受到污染，因而默认情况下查询ISP的服务器就会获得虚假IP；而用户直接查询境外NS（比如OpenDNS、GoolgeDNS）又可能被 劫持，从而在没有防范机制的情况下仍然不能获得正确IP。</p>\n<p>也曾经有人提到使用&#8221;远程解析DNS&#8221;来避免DNS劫持，比如在Firefox中，设置远程解析DNS很简单，只需要在地址栏输入 about:config ，将 network.proxy.socks_remote_dns 参数的值改为 true。但当你真正的修改后你会发现，域名解析的速度会让你忍无可忍，慢到累死牛。</p>\n<p>所以，就以上情况来说，利用OpenDNS和Google DNS来避免DNS劫持以及用来翻墙是不可行的，这也是你经常访问含某关键字的某网站时，直接返回 &#8220;载入页面时到服务器的连接被重置。&#8221; 或者 &#8220;连接超时&#8221; 的提示了。</p>\n<blockquote>\n<p><span>小贴士：要翻墙，想反劫持，好了，通过VPN或SSH跳墙而过吧。</span></p>\n</blockquote>\n<p><strong>其次，提高解析速度也是不可能的。</strong></p>\n<p>为什么这样说，在上一个问题里面已经提到了，我们大多数访问的网站解析都是有缓存的，那么，除了当你第一次访问或者清除DNS缓存后，会重新访问远程DNS服务器外，其他时间都是通过缓存进行的，那么提高解析速度的说法也就不攻自破了。</p>\n<p><strong>其三，预防HTTP会话劫持/污染更是不可能的。</strong></p>\n<p>我们先来看看HTTP会话劫持的过程：</p>\n<ol>\n<li>在某个骨干路由器的边上，有一台旁路的设备在装死的过程，监听所有流过的HTTP会话。这个设备按照某种规律（某时间段，某些关键字出现的几率），对于某些HTTP请求进行特殊处理。</li>\n<li>当一个不幸的HTTP请求流过，这个设备根据该请求的seq和ack，把早已准备好的数据作为回应包，发送给客户端。这个过程是非常快的，我们的HTTP请求发出之后，仅过了几毫秒，就收到了上面的回应。而任何正常的服务器都不可能在这么短的时间内做出回应。</li>\n<li>因为seq和ack已经被伪造的回应用掉了，所以，真正的服务器端数据过来的时候，会被当作错误的报文而不被接受。</li>\n<li>浏览器会根据重新定向的新页面的javascript代码，弹出广告窗口后，重新对你要访问的URL进行请求。如<a href=\"http://f9y4ng.wordpress.com/2011/03/19/%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A1%E8%BF%99%E4%B8%AA%E8%80%81%E6%B5%81%E6%B0%93%EF%BC%81/\">&#8220;忍无可忍呐～中国电信真是欺人太甚！&#8221;</a>所提到的。</li>\n</ol>\n<p>看到劫持过程，大家明白了吧？HTTP会话劫持跟DNS没半点干系，别说你用OpenDNS，你就是直接用本地HOSTS文件解析也一样会被会话劫持。我前些天所遇到的<a href=\"http://f9y4ng.wordpress.com/2011/03/19/%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A1%E8%BF%99%E4%B8%AA%E8%80%81%E6%B5%81%E6%B0%93%EF%BC%81/\">劫持问题1</a> <a href=\"http://f9y4ng.wordpress.com/2011/04/01/%E5%BF%8D%E6%97%A0%E5%8F%AF%E5%BF%8D%E5%91%90%EF%BD%9E%E4%B8%AD%E5%9B%BD%E7%94%B5%E4%BF%A1%E7%9C%9F%E6%98%AF%E6%AC%BA%E4%BA%BA%E5%A4%AA%E7%94%9A%EF%BC%81/\">2</a>，就属于这类了。</p>\n<blockquote>\n<p><span>小贴士：想从根本上解决此问题，好了，拿起你的电话，向电信客服MM发飙吧，顺带脚到宫刑部投诉一把，强制要求电信将你的ADSL账户拉入白名单，从此世界就安静了。</span></p>\n</blockquote>\n<p><strong>其四，使用OpenDNS和Google DNS反而会让近一半的网站访问速度变慢。</strong></p>\n<p>很多人会觉得这个很不可思议，我用国外DNS服务器怎么会造成访问速度变慢？</p>\n<p>先从国内的情况来说，南电信北网通，两家运营商先打到头破血流，世界上最远的距离就是电信跟网通的互访，超级大瓶颈。智能轮循DNS从一定程度上解 决了，南北线路互访的缓慢问题。但，从实际应用上来看，DNS智能轮循其实并不是太智能，它靠的预先分配好几个区域，然后根据用户请求的IP来判断用户属 于哪个区域，之后返回对应区域的服务器IP。正常情况 下，用户在国内上网，用的是ISP自动分配的DNS，用户域名解析请求发给ISP的DNS，ISP的DNS又发给万网、DNSPod、时代互联等等这样的 域名授权DNS。这时候类似 DNSPod的DNS服务器拿到的IP地址基本是ISP的DNS地址，所以很方便的就能判断出用户所在的区域，并把结果返回给用户。</p>\n<p>但如果这个时候，用户用的是OpenDNS、GoogleDNS或者国外的DNS服务器，由于这些服务器的IP地址是在国外，返回国外的服务器 IP。由于一般的DNS智能轮循规则设置为所有非电信的IP地址均默认为网通线路，那么这个时候，电信用户访问网站时所返回国外DNS IP的结果是，用户被指向网站在网通线路或者国外的服务器，造成访问网站巨慢。</p>\n<blockquote>\n<p><span>小贴士：解决智能解析问题，还是留给网站运营者来解决吧，IP Anycast＋BGP会让网站运营者&#8221;鲜血横流&#8221;的，哈哈。</span></p>\n</blockquote>\n<p>综上所述，OpenDNS和Google DNS并不是万能的。不但不万能，还会造成一些问题。比起使用本地ISP的DNS来说，用国外的DNS实在是让人爱恨难分。最近，某墙似乎频繁升 级，Google的多项应用都出现了中断的情况，OpenDNS也被XX过，所以，还是忍受吧，如果不能忍的话，VPN+SSH跳墙而过。正所谓：</p>\n<blockquote>\n<p><span>两岸猿声啼不住，一支红杏出墙来。</span></p>\n</blockquote>\n<p></p>\n<h4>―――――――――――――――――――――――――――――――――――――――――</h4>\n<h4>需要翻墙利器赛风? 请<a href=\"https://www.google.com/profiles/112915952962578336480\">阅读和关注中国数字时代</a>。</p>\n<p>推特用户请点击<a href=\"http://qinzhigang.in/login.php\">这里</a>免翻墙上推特</h4>\n<p>请点击<a href=\"https://sesawe.net/-Tools-zh-.html\">这里</a>下载翻墙软件 </p>\n<p>更多翻墙方法请发电邮(最好用Gmail)到：<a href=\"mailto:fanqiang70ma@gmail.com\">fanqiang70ma@gmail.com</a>  </p>\n<p>请阅读和关注<a href=\"https://www.google.com/profiles/112915952962578336480\">中国数字时代</a>、<small>翻墙技术博客<a href=\"https://www.google.com/profiles/chinagfwblog\">GFW BLOG</a>（免翻墙） <br /> </small></p>\n<p>请使用<a href=\"https://www.google.com/reader/view/\">Google Reader</a><a href=\"https://www.google.com/reader/view/feed/http://chinadigitaltimes.net/chinese/feed\">订阅中国数字时代中文版</a>（<a href=\"http://chinadigitaltimes.net/chinese/feed\">http://chinadigitaltimes.net/chinese/feed</a>），阅读最有价值的中文信息；以及<a href=\"https://www.google.com/reader/view/feed/http://feeds2.feedburner.com/chinagfwblog\">GFW BLOG（功夫网与翻墙）</a><a href=\"http://feeds2.feedburner.com/chinagfwblog\">http://feeds2.feedburner.com/chinagfwblog</a>，获取最新翻墙工具和翻墙技巧信息。</p>\n<p> </p>\n<div>要翻墙? <a href=\"http://ziyouxinxi.info/\">用赛风</a>.<br />\n推特用户请点击<a href=\"http://edu20.in/login.php\">这里</a>免翻墙上推特<wbr><br />\n点击<a href=\"http://fanqiangsesawe.info\">这里</a>下载翻墙软件<br />\n更多翻墙方法请发电邮(最好用Gmail)到:gongminshehui1@gmail.com<br />\n翻墙技术博客<a href=\"https://www.google.com/profiles/chinagfwblog\">GFW BLOG</a>（免翻墙）<br />\n阅读<a href=\"http://www.google.com/profiles/112915952962578336480\">中国数字时代</a>（免翻墙）<img alt=\"\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-8817338441990899629?l=www.chinagfw.org\" width=\"1\" /></div>\n<div>\n<a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:yIl2AUoC8zA\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=yIl2AUoC8zA\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:-BTjWOF_DHI\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=6Jmql08iX9M:ehNX_w_JVn0:-BTjWOF_DHI\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:F7zBnMyn0Lo\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=6Jmql08iX9M:ehNX_w_JVn0:F7zBnMyn0Lo\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:V_sGLiPBpWU\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=6Jmql08iX9M:ehNX_w_JVn0:V_sGLiPBpWU\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:qj6IDK7rITs\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=qj6IDK7rITs\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:l6gmwiTKsz0\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=l6gmwiTKsz0\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:gIN9vFwOqvQ\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?i=6Jmql08iX9M:ehNX_w_JVn0:gIN9vFwOqvQ\" /></a> <a href=\"http://feeds.feedburner.com/~ff/chinagfwblog?a=6Jmql08iX9M:ehNX_w_JVn0:TzevzKxY174\"><img border=\"0\" src=\"http://feeds.feedburner.com/~ff/chinagfwblog?d=TzevzKxY174\" /></a>\n</div>\n<p><img height=\"1\" src=\"http://feeds.feedburner.com/~r/chinagfwblog/~4/6Jmql08iX9M\" width=\"1\" /></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=752465\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"Subscribe me!\"><br />\n</form>\n","author":267,"categories":[15300],"tags":[8510,8795,8800]}