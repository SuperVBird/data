{"id":434292,"link":"https://chinadigitaltimes.net/chinese/2016/04/用树莓派打造无线中继科学上网路由器/","date":"2016-04-06T01:08:53Z","modified":"2016-04-06T01:08:53Z","title":"用树莓派打造无线中继科学上网路由器","content":"<p>&#20026;&#20160;&#20040;&#35201;&#20570;&#26080;&#32447;&#20013;&#32487;&#65311;&#22240;&#20026;&#20004;&#20010;&#22330;&#26223;&#65306;&#31532;&#19968;&#20010;&#26159;&#22312;&#25105;&#21496;&#65292;WIFI&#19978;&#32593;&#21516;&#19968;&#36134;&#25143;&#21482;&#33021;&#36830;&#25509;&#20004;&#20010;&#35774;&#22791;&#65292;&#29616;&#22312;&#20004;&#20010;&#35774;&#22791;&#21738;&#37324;&#22815;&#65311;&#31532;&#20108;&#20010;&#22330;&#26223;&#26159;&#22312;&#23486;&#39302;&#65292;&#25105;&#24076;&#26395;&#23601;&#20687;&#22312;&#23478;&#37324;&#19968;&#26679;&#65292;&#25152;&#26377;&#35774;&#22791;&#37117;&#26159;&#36830;&#19978;&#36335;&#30001;&#22120;&#23601;&#21487;&#20197;&#20813;&#35774;&#32622;&#31185;&#23398;&#19978;&#32593;&#65292;&#36825;&#23601;&#38656;&#35201;&#23545;&#23486;&#39302;&#21407;&#26469;&#30340;WIFI&#36827;&#34892;&#22788;&#29702;&#12290;</p>\n<p><a name=\"more\"></a>&#26469;&#28304;&#65306;</p>\n<div>&#35831;&#21508;&#20301;&#30475;&#23448;&#27880;&#24847;&#20004;&#20010;&#20851;&#38190;&#23383;&#65306;<code>&#26080;&#32447;&#20013;&#32487;</code> <code>&#31185;&#23398;&#19978;&#32593;</code>&#12290;</div>\n<ul>\n<li><span><em>&#20026;&#20160;&#20040;&#35201;&#20570;&#26080;&#32447;&#20013;&#32487;&#65311;</em></span>&#22240;&#20026;&#20004;&#20010;&#22330;&#26223;&#65306;&#31532;&#19968;&#20010;&#26159;&#22312;&#25105;&#21496;&#65292;WIFI&#19978;&#32593;&#21516;&#19968;&#36134;&#25143;&#21482;&#33021;&#36830;&#25509;&#20004;&#20010;&#35774;&#22791;&#65292;&#29616;&#22312;&#20004;&#20010;&#35774;&#22791;&#21738;&#37324;&#22815;&#65311;&#31532;&#20108;&#20010;&#22330;&#26223;&#26159;&#22312;&#23486;&#39302;&#65292;&#25105;&#24076;&#26395;&#23601;&#20687;&#22312;&#23478;&#37324;&#19968;&#26679;&#65292;&#25152;&#26377;&#35774;&#22791;&#37117;&#26159;&#36830;&#19978;&#36335;&#30001;&#22120;&#23601;&#21487;&#20197;&#20813;&#35774;&#32622;&#31185;&#23398;&#19978;&#32593;&#65292;&#36825;&#23601;&#38656;&#35201;&#23545;&#23486;&#39302;&#21407;&#26469;&#30340;WIFI&#36827;&#34892;&#22788;&#29702;</li>\n<li><span><em>&#20026;&#20160;&#20040;&#35201;&#38543;&#26102;&#31185;&#23398;&#19978;&#32593;&#65311;</em></span>&#25105;&#21482;&#33021;&#35828;&#65292;&#20026;&#20102;&#30693;&#35782;&#21644;&#30495;&#30456;</li>\n</ul>\n<div>&#26641;&#33683;&#27966;&#20351;&#29992;&#30340;&#31995;&#32479;&#65306;<code>RASPBIAN JESSIE</code></div>\n<div>&#21478;&#22806;&#65292;&#22240;&#20026;&#25163;&#22836;&#27809;&#26377;&#36335;&#30001;&#22120;&#65292;&#22240;&#27492;&#65292;&#26412;&#25991;&#20171;&#32461;&#21033;&#29992;&#30005;&#33041;&#30452;&#36830;&#26641;&#33683;&#27966;&#36827;&#34892;&#30456;&#20851;&#35774;&#32622;&#12290;&#19981;&#22810;&#35828;&#65292;&#24320;&#22987;&#20102;&#12290;</div>\n<h5>1.&#35774;&#32622;IP</h5>\n<div>&#25353;&#29031;&#26641;&#33683;&#27966;&#23448;&#26041;&#30340;&#20570;&#27861;&#65292;&#26641;&#33683;&#27966;&#38656;&#35201;&#19968;&#26681;&#32593;&#32447;&#30452;&#36830;&#36335;&#30001;&#22120;&#65292;&#36890;&#36807;&#36335;&#30001;&#22120;&#30340;DHCP&#20998;&#37197;&#21040;IP&#21518;&#65292;&#23601;&#21487;&#20197;&#36828;&#31243;&#30331;&#24405;&#20102;&#12290;&#20294;&#26159;&#21018;&#25165;&#24050;&#32463;&#25552;&#21040;&#65292;&#22240;&#20026;&#25163;&#22836;&#27809;&#26377;&#36335;&#30001;&#22120;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201;&#29992;&#30005;&#33041;&#30452;&#36830;&#26641;&#33683;&#27966;&#36827;&#34892;&#36828;&#31243;&#30331;&#24405;&#12290;&#23558;&#21046;&#20316;&#22909;&#30340;&#26641;&#33683;&#27966;SD&#21345;&#25554;&#20837;&#30005;&#33041;&#65292;&#20250;&#24377;&#20986;&#19968;&#20010;&#21517;&#20026;Boot&#30340;&#30913;&#30424;&#65292;&#20854;&#20013;&#26377;&#19968;&#20010;<code>cmdline.txt</code>&#25991;&#20214;&#65292;&#25171;&#24320;&#20043;&#21518;&#65292;&#22312;&#26368;&#21518;&#30340;&#20301;&#32622;&#36861;&#21152;&#19968;&#20010;IP&#22914;&#19979;&#65306;</div>\n<pre><code>dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait ip=192.168.3.1  <br></code></pre>\n<div>&#25554;&#22238;SD&#21345;&#33267;&#26641;&#33683;&#27966;&#65292;&#36890;&#30005;&#21518;&#65292;&#23558;&#25105;&#20204;&#30340;&#30005;&#33041;&#31471;IP&#35774;&#32622;&#20026;<code>192.168.3.100</code>&#65292;&#25513;&#30721;&#35774;&#32622;&#20026;<code>255.255.255.0</code>&#21363;&#21487;&#36830;&#25509;&#26641;&#33683;&#27966;&#20102;</div>\n<h5>2.&#26356;&#25913;&#30913;&#30424;&#22823;&#23567;&#21644;LOCALE</h5>\n<div>&#26641;&#33683;&#27966;&#40664;&#35748;&#24182;&#27809;&#26377;&#29992;&#36275;&#25152;&#26377;&#30340;SD&#21345;&#65292;&#20855;&#20307;&#21407;&#22240;&#26410;&#30693;&#12290;&#20294;&#26159;&#20063;&#24456;&#22909;&#35843;&#25972;&#12290;&#36816;&#34892;<code>sudo raspi-config</code>&#65292;&#21487;&#20197;&#25171;&#24320;&#26641;&#33683;&#27966;&#35774;&#32622;&#31383;&#21475;&#65306;<img alt=\"&#35774;&#32622;&#31383;&#21475;\" src=\"https://story.tonylee.name/content/images/2016/03/-----2016-03-30---9-56-39.png\">&#31532;&#19968;&#39033;&#65292;&#23601;&#26159;&#23558;&#25991;&#20214;&#31995;&#32479;&#25193;&#23637;&#21040;&#25972;&#20010;SD&#21345;&#12290;&#39034;&#20415;&#25226;&#31532;&#20116;&#39033;&#20013;&#30340;&#35821;&#35328;&#39033;&#20063;&#25913;&#20102;&#21543;&#65292;&#21542;&#21017;&#22312;&#23433;&#35013;&#36719;&#20214;&#26102;&#65292;&#24635;&#20250;&#25552;&#31034;language&#27809;&#26377;&#35774;&#32622;&#65292;&#25105;&#19968;&#33324;&#20250;&#36873;&#25321;&#29983;&#25104;<code>en_US.UTF-8</code>&#20197;&#21450;<code>zh_CN.UTF-8</code>&#65292;&#40664;&#35748;&#35821;&#35328;&#20351;&#29992;&#36213;&#23478;&#35821;&#35328;&#65288;&#36873;&#25321;&#26102;&#65292;&#20351;&#29992;&#31354;&#26684;&#38190;&#26469;&#20999;&#25442;&#36873;&#20013;&#65295;&#26410;&#36873;&#65289;&#12290;</div>\n<h5>3.&#26356;&#25913;WIFI&#22269;&#21035;</h5>\n<div>&#20026;&#20160;&#20040;&#35201;&#26356;&#25913;WIFI&#22269;&#21035;&#65311;&#22240;&#20026;&#25353;&#29031;&#35268;&#33539;&#65292;&#21508;&#22269;&#30340;&#39057;&#35889;&#19981;&#19968;&#26679;&#65292;<a href=\"https://zh.wikipedia.org/wiki/WLAN%E4%BF%A1%E9%81%93%E5%88%97%E8%A1%A8\">&#35814;&#35265;&#36825;&#37324;</a>&#65292;&#22914;&#26524;&#19981;&#26356;&#25913;&#65292;&#26641;&#33683;&#27966;&#40664;&#35748;&#20351;&#29992;&#22823;&#33521;&#24093;&#22269;&#65292;&#30452;&#25509;&#30340;&#24433;&#21709;&#23601;&#26159;&#65292;&#21487;&#33021;&#26576;&#20123;5G&#20449;&#36947;&#20250;&#25628;&#32034;&#19981;&#21040;&#12290;</div>\n<div>&#32534;&#36753;<code>/etc/wpa_supplicant/wpa_supplicant.conf</code>&#65292;&#26356;&#25913;<code>country</code>&#20026;<code>CN</code></div>\n<h5>4.&#23433;&#35013;&#31532;&#19968;&#22359;WIFI&#36866;&#37197;&#22120;</h5>\n<div>&#22240;&#20026;&#25105;&#21496;&#25152;&#22312;&#30340;WIFI&#29615;&#22659;&#25903;&#25345;5G&#20449;&#21495;&#65292;&#22240;&#27492;&#65292;&#22312;&#36873;&#25321;WIFI&#36866;&#37197;&#22120;&#26102;&#65292;&#25105;&#36873;&#25321;&#20102;<a href=\"http://www.tp-link.com.cn/product_253.html\">TP-LINK TL-WDN3321</a>&#65292;&#35813;&#35774;&#22791;&#25554;&#20837;&#21363;&#21487;&#20351;&#29992;&#65292;&#20813;&#39537;&#21160;&#12290;</div>\n<h5>5.&#37197;&#32622;&#22522;&#20110;WPA-EAP&#30340;WIFI&#35748;&#35777;</h5>\n<div>&#25105;&#21496;&#20351;&#29992;&#20102;&#22522;&#20110;PEAP&#21644;MSCHAPV2&#30340;WPA-EAP&#30340;WIFI&#35748;&#35777;&#65292;&#20294;&#26159;&#27809;&#26377;&#20351;&#29992;&#35777;&#20070;&#12290;</div>\n<div>&#37197;&#32622;&#26102;&#65292;&#21482;&#38656;&#35201;&#22312;<code>/etc/wpa_supplicant/wpa_supplicant.conf</code>&#22686;&#21152;&#22914;&#19979;&#27573;&#33853;&#21363;&#21487;</div>\n<pre><code>network=  <br>    ssid=\"ssid\"<br>    key_mgmt=WPA-EAP<br>    eap=PEAP<br>    identity=\"id\"<br>    password=\"password\"<br>    #ca_cert=\"/etc/cert/ca.pem\"<br>    #phase1=\"peaplabel=1\"<br>    phase2=\"auth=MSCHAPV2\"<br>    priority=10<br><br></code></pre>\n<div>&#26356;&#25913;&#20854;&#20013;&#30340;<code>ssid</code> <code>identity</code>&#21644;<code>password</code>&#20026;&#20320;&#25152;&#22312;&#29615;&#22659;&#30340;&#37197;&#32622;&#12290;</div>\n<blockquote>\n<div>&#37197;&#32622;&#25991;&#20214;&#20013;&#21487;&#20197;&#26377;&#22810;&#20010;network&#37197;&#32622;&#65292;&#31995;&#32479;&#20250;&#26681;&#25454;&#25628;&#32034;&#21040;&#30340;ssid&#26469;&#33258;&#21160;&#21305;&#37197;</div>\n</blockquote>\n<h5>6.&#36830;&#25509;WIFI</h5>\n<div>&#36830;&#25509;WIFI&#20854;&#23454;&#23601;&#26159;&#19968;&#20010;&#37325;&#26032;&#21152;&#36733;&#37197;&#32622;&#30340;&#36807;&#31243;&#65292;&#20808;&#25191;&#34892;<code>sudo ifdown wlan0</code>&#65292;&#20877;&#25191;&#34892;<code>sudo ifup wlan0</code>&#21363;&#21487;&#12290;&#20043;&#21518;&#65292;&#21487;&#20197;&#21033;&#29992;<code>iwconfig</code>&#21629;&#20196;&#26597;&#30475;wifi&#37197;&#32622;&#26159;&#21542;&#24050;&#32463;&#21152;&#36733;&#65292;&#29992;<code>ifconfig</code>&#26469;&#26597;&#30475;&#26159;&#21542;&#20998;&#37197;&#21040;IP&#65292;&#22914;&#26524;&#19968;&#20999;&#39034;&#21033;&#65292;&#23601;&#24212;&#35813;&#33021;&#22815;&#19978;&#32593;&#20102;&#12290;</div>\n<h5>7.&#26356;&#25913;&#20026;&#20013;&#31185;&#22823;&#30340;&#28304;</h5>\n<div>&#26641;&#33683;&#27966;&#30340;<code>apt-get</code>&#30340;&#28304;&#22312;&#33521;&#22269;&#65292;&#22240;&#27492;&#35775;&#38382;&#36215;&#26469;&#27604;&#36739;&#32531;&#24930;&#12290;&#24863;&#35874;<a href=\"https://lug.ustc.edu.cn/wiki/start\">&#20013;&#22269;&#31185;&#23398;&#25216;&#26415;&#22823;&#23398; Linux &#29992;&#25143;&#21327;&#20250;</a>&#20570;&#20102;&#38236;&#20687;&#65292;&#32534;&#36753;<code>/etc/apt/source.list</code>&#65292;&#21024;&#38500;&#20854;&#20013;&#30340;&#20869;&#23481;&#65292;&#20351;&#29992;&#19968;&#19979;&#20869;&#23481;&#20195;&#26367;</div>\n<pre><code>deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ jessie main non-free contrib  <br></code></pre>\n<div>&#20043;&#21518;&#36816;&#34892;<code>sudo apt-get update</code>&#26469;&#26356;&#26032;&#28304;</div>\n<h5>8.&#22266;&#23450;&#25509;&#21475;&#21517;&#31216;</h5>\n<div>&#20160;&#20040;&#21483;&#22266;&#23450;&#25509;&#21475;&#21517;&#31216;&#65311;&#24403;&#25105;&#20204;&#25554;&#20837;WIFI&#36866;&#37197;&#22120;&#26102;&#65292;&#23588;&#20854;&#26159;&#25105;&#20204;&#30340;&#25972;&#20010;&#26041;&#26696;&#20013;&#65292;&#20250;&#20351;&#29992;&#20004;&#20010;WIFI&#36866;&#37197;&#22120;&#26102;&#65292;&#31995;&#32479;&#20250;&#38543;&#26426;&#20998;&#37197;&#21738;&#20010;&#26159;wlan0&#65292;&#21738;&#20010;&#26159;wlan1&#12290;&#22240;&#20026;&#20004;&#20010;&#36866;&#37197;&#22120;&#19981;&#19968;&#26679;&#65292;&#20250;&#23548;&#33268;&#36816;&#34892;&#22312;&#19978;&#38754;&#30340;&#37197;&#32622;&#21487;&#33021;&#27809;&#21150;&#27861;&#29983;&#25928;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#24517;&#39035;&#35753;&#31995;&#32479;&#35760;&#20303;WIFI&#36866;&#37197;&#22120;&#20351;&#29992;&#30340;&#25509;&#21475;&#21517;&#31216;&#12290;</div>\n<div>&#32534;&#36753;&#26032;&#22686;&#25991;&#20214;<code>/etc/udev/rules.d/10-network.rules</code>&#65292;&#20854;&#20013;&#30340;&#20869;&#23481;&#22914;&#19979;&#65306;</div>\n<pre><code>SUBSYSTEM==\"net\", ACTION==\"add\", ATTRaddress==\"aa:bb:cc:dd:ee:ff\", NAME=\"wlan0\"  <br></code></pre>\n<div>&#27880;&#24847;&#20854;&#20013;&#30340;mac&#22320;&#22336;&#65292;&#35774;&#32622;&#20026;&#20320;&#30340;&#35774;&#22791;&#30340;mac&#22320;&#22336;&#12290;&#33719;&#24471;mac&#22320;&#22336;&#65292;&#21487;&#20197;&#20351;&#29992;&#21629;&#20196;<code>ip link</code></div>\n<div>&#37325;&#21551;&#31995;&#32479;&#21518;&#65292;&#20877;&#25554;&#20837;&#35774;&#22791;&#65292;&#23601;&#20250;&#32465;&#23450;&#25509;&#21475;&#21517;&#31216;</div>\n<h5>9.&#26356;&#25913;eth0&#30340;IP</h5>\n<div>&#21069;&#38754;&#30340;&#31532;&#19968;&#27493;&#20013;&#65292;&#25105;&#20204;&#20351;&#29992;&#20102;&#19968;&#20010;&#21464;&#30456;&#30340;&#25163;&#27861;&#20998;&#37197;&#20102;&#26641;&#33683;&#27966;&#30340;IP&#12290;&#20294;&#26159;&#25105;&#21457;&#29616;&#22312;&#35813;&#27169;&#24335;&#19968;&#19979;&#26377;&#19968;&#20010;&#38382;&#39064;&#65306;&#22914;&#26524;&#19981;&#25554;&#32593;&#32447;&#65292;&#26641;&#33683;&#27966;&#21551;&#21160;&#26102;&#20250;&#24456;&#38271;&#19968;&#27573;&#26102;&#38388;&#37117;&#22312;&#31561;&#24453;&#25554;&#20837;&#32593;&#32447;&#12290;</div>\n<div>&#26082;&#28982;&#24050;&#32463;&#36827;&#20837;&#20102;&#31995;&#32479;&#65292;&#25105;&#20204;&#33258;&#28982;&#36824;&#21407;&#20026;&#26631;&#20934;&#30340;&#37197;&#32622;&#12290;&#32534;&#36753;&#25991;&#20214;<code>/etc/network/interfaces</code>&#65292;&#23558;eth0&#30340;&#37197;&#32622;&#25913;&#20026;&#22914;&#19979;</div>\n<pre><code>auto eth0  <br>iface eth0 inet static  <br>    address 192.168.3.1<br>    netmask 255.255.255.0<br></code></pre>\n<div>&#28982;&#21518;&#32534;&#36753;<code>/boot/cmdline.txt</code>,&#21435;&#25481;&#31532;&#19968;&#27493;&#20013;&#22686;&#21152;&#30340;IP&#37197;&#32622;</div>\n<h5>10.&#23433;&#35013;dnsmasq&#26469;&#35774;&#32622;DHCP&#26381;&#21153;</h5>\n<blockquote>\n<div>&#20808;&#26469;&#35828;&#26126;&#19968;&#19979;&#25105;&#30340;&#32593;&#27573;&#35774;&#32622;&#65292;&#26377;&#32447;&#32593;&#32476;&#20351;&#29992;192.168.3&#36825;&#20010;&#32593;&#27573;&#65292;&#32780;&#26080;&#32447;AP&#31471;&#65292;&#20351;&#29992;192.168.4&#36825;&#20010;&#32593;&#27573;&#12290;</div>\n</blockquote>\n<div>&#24456;&#22810;&#21338;&#25991;&#20351;&#29992;udhcpd&#26469;&#20570;&#20316;DHCP&#26381;&#21153;&#22120;&#65292;&#20294;&#26159;&#32771;&#34385;&#21040;&#23558;&#26469;&#35201;&#31185;&#23398;&#19978;&#32593;&#65292;&#26082;&#28982;dnsmasq&#23601;&#21487;&#20197;&#20570;&#36825;&#20010;&#20107;&#65292;&#37027;&#23601;&#21482;&#29992;&#23427;&#22909;&#20102;&#12290;</div>\n<div>&#20351;&#29992;&#21629;&#20196;<code>sudo apt-get install dnsmasq</code>&#65292;&#32534;&#36753;<code>/etc/dnsmasq.conf</code>&#65292;&#27880;&#24847;&#26356;&#25913;&#22914;&#19979;&#20960;&#27573;&#65306;</div>\n<pre><code>#&#37197;&#32622;&#30417;&#21548;&#22320;&#22336;<br>listen-address=127.0.0.1,192.168.3.1,192.168.4.1  <br>#&#37197;&#32622;DHCP&#20998;&#37197;&#27573;<br>dhcp-range=192.168.3.50,192.168.3.150,12h  <br>dhcp-range=192.168.4.50,192.168.4.150,12h  <br></code></pre>\n<div>&#36816;&#34892;&#21629;&#20196;<code>sudo service dnsmasq restart</code>&#26469;&#21551;&#29992;</div>\n<h5>11.&#24320;&#21551;&#21253;&#36716;&#21457;</h5>\n<div>Linux&#31995;&#32479;&#40664;&#35748;&#20851;&#38381;&#20102;IP&#21253;&#36716;&#21457;&#65292;&#22240;&#27492;&#19981;&#33021;&#20570;&#36335;&#30001;&#22120;&#12290;&#25152;&#20197;&#38656;&#35201;&#20808;&#25171;&#24320;&#21253;&#36716;&#21457;</div>\n<div>&#32534;&#36753;<code>/etc/sysctl.conf</code>&#65292;&#21435;&#25481;&#20197;&#19979;&#23646;&#24615;&#21069;&#30340;&#27880;&#37322;:</div>\n<pre><code># Uncomment the next line to enable packet forwarding for IPv4<br>net.ipv4.ip_forward=1  <br></code></pre>\n<div>&#36816;&#34892;<code>sudo sysctl -p</code>&#26469;&#21551;&#29992;</div>\n<div>&#20043;&#21518;&#36816;&#34892;</div>\n<pre><code>sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE  <br></code></pre>\n<div>&#26469;&#21551;&#29992;wlan0&#31471;&#21475;&#30340;NAT</div>\n<h5>12.&#23433;&#35013;iptables-persistent</h5>\n<div>&#19978;&#19968;&#27493;&#20013;&#65292;&#25105;&#20204;&#21551;&#29992;&#20102;&#19968;&#26465;&#38450;&#28779;&#22681;&#35268;&#21017;&#65292;&#20294;&#26159;&#38450;&#28779;&#22681;&#35268;&#21017;&#37325;&#21551;&#21518;&#23601;&#20002;&#22833;&#20102;&#65292;&#20026;&#20102;&#33021;&#22815;&#35268;&#21017;&#24320;&#26426;&#33258;&#21160;&#21152;&#36733;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;iptables-persistent&#12290;&#29992;&#21629;&#20196;<code>sudo apt-get install iptables-persistent</code>&#26469;&#23433;&#35013;&#35813;&#32452;&#20214;&#65292;&#26681;&#25454;&#20854;&#25552;&#31034;&#36827;&#34892;&#21021;&#27425;&#35774;&#32622;&#65288;&#19968;&#36335;&#30830;&#35748;&#65289;&#12290;&#35813;&#32452;&#20214;&#40664;&#35748;&#20250;&#23558;&#38450;&#28779;&#22681;&#35268;&#21017;&#20445;&#23384;&#21040;<code>/etc/iptables/rules.v4</code>&#20013;&#12290;&#20320;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#21629;&#20196;&#20445;&#23384;&#21644;&#35835;&#20837;&#35268;&#21017;:</div>\n<pre><code>#&#20445;&#23384;&#29616;&#26377;&#35268;&#21017;<br>sudo service netfilter-persistent save  <br>#&#35835;&#21462;&#24182;&#24212;&#29992;&#20808;&#26377;&#35268;&#21017;<br>sudo service netfilter-persistent reload  <br></code></pre>\n<blockquote>\n<div>&#20026;&#20160;&#20040;&#26381;&#21153;&#21517;&#31216;&#21464;&#25104;&#20102;netfilter-persistent&#65292;&#36825;&#37324;&#38754;&#22909;&#20687;&#26377;&#25925;&#20107;&#65292;&#30041;&#24453;&#20197;&#21518;&#20877;digg</div>\n</blockquote>\n<h5>13.&#23433;&#35013;&#31532;&#20108;&#22359;WIFI&#36866;&#37197;&#22120;</h5>\n<div>&#31532;&#19968;&#22359;WIFI&#36866;&#37197;&#22120;&#26159;&#20026;&#20102;&#36830;&#25509;&#29616;&#26377;&#32593;&#32476;&#65292;&#31532;&#20108;&#22359;&#21017;&#26159;&#20026;&#20102;&#24314;&#31435;WIFI&#28909;&#28857;&#12290;&#20026;&#20102;&#24314;&#31435;WIFI&#28909;&#28857;&#65292;&#36866;&#37197;&#22120;&#24517;&#39035;&#20855;&#26377;AP&#30340;mode&#12290;&#21487;&#20197;&#20351;&#29992;&#21629;&#20196;<code>iw list|grep -A10 'Supported interface modes'</code>&#26597;&#30475;&#12290;&#27604;&#22914;&#65292;&#25105;&#36873;&#29992;&#30340;&#35774;&#22791;&#26159;<a href=\"https://wikidevi.com/wiki/Widemac_SL-1506N\">widemac SL-1506N</a>&#65292;&#20854;&#21442;&#25968;&#22914;&#19979;&#65306;</div>\n<pre><code>Supported interface modes:  <br>         * IBSS<br>         * managed<br>         * AP<br>         * AP/VLAN<br>         * WDS<br>         * monitor<br>         * mesh point<br></code></pre>\n<div>&#35813;&#35774;&#22791;&#20381;&#28982;&#26159;&#25554;&#20837;&#21363;&#21487;&#65292;&#19981;&#38656;&#35201;&#39537;&#21160;&#12290;</div>\n<h5>14.&#35774;&#32622;&#31532;&#20108;&#22359;Adapter&#30340;IP</h5>\n<div>&#20381;&#28982;&#26159;&#32534;&#36753;<code>/etc/network/interfaces</code>,&#26356;&#25913;wlan1&#30340;&#37197;&#32622;&#22914;&#19979;</div>\n<pre><code>auto wlan1  <br>iface wlan1 inet static  <br>    address 192.168.4.1<br>        netmask 255.255.255.0<br></code></pre>\n<h5>15.&#22266;&#23450;&#31532;&#20108;&#22359;WIFI&#36866;&#37197;&#22120;&#30340;&#25509;&#21475;&#21517;&#31216;</h5>\n<div>&#20570;&#27861;&#31867;&#20284;&#20110;&#31532;&#19968;&#22359;&#65292;&#21482;&#19981;&#36807;&#20877;&#21152;&#20837;&#19968;&#34892;&#32780;&#24050;&#65292;&#25509;&#21475;&#21517;&#31216;&#20026;wlan1,&#36825;&#37324;&#23601;&#19981;&#35828;&#20102;&#65292;&#35760;&#24471;&#37325;&#21551;&#35753;&#20854;&#29983;&#25928;&#12290;</div>\n<h5>16.&#23433;&#35013;&#24182;&#24320;&#21551;hostapd</h5>\n<div>Linux&#21551;&#29992;WIFI&#28909;&#28857;&#65292;&#20351;&#29992;&#30340;&#26159;hostapd&#12290;&#39318;&#20808;&#65292;&#29992;&#21629;&#20196;<code>sudo apt-get install hostapd</code>&#23433;&#35013;&#23427;&#65292;&#28982;&#21518;&#22686;&#21152;&#37197;&#32622;&#25991;&#20214;<code>/etc/hostapd/hostapd.conf</code>&#22914;&#19979;&#65306;</div>\n<pre><code>interface=wlan1  <br>driver=nl80211  <br>ssid=ssid  <br>hw_mode=g  <br>channel=13  <br>macaddr_acl=0  <br>auth_algs=1  <br>ignore_broadcast_ssid=0  <br>wpa=2  <br>wpa_passphrase=passwd  <br>wpa_key_mgmt=WPA-PSK  <br>wpa_pairwise=TKIP  <br>rsn_pairwise=CCMP  <br></code></pre>\n<div>&#21482;&#38656;&#35201;&#26356;&#25913;&#20854;&#20013;&#30340;<code>ssid</code>&#21644;<code>wpa_passphrase</code>&#23646;&#24615;&#12290;</div>\n<div>&#20043;&#21518;&#36816;&#34892;&#21629;&#20196;<code>sudo hostpad -d /etc/hostapd/hostapd.conf</code>&#26469;&#35266;&#23519;&#27979;&#35797;&#65292;&#27809;&#26377;&#38169;&#35823;&#21487;&#20197;&#36830;&#25509;&#65292;&#23601;OK&#20102;&#12290; CTRL&#65291;C&#21518;&#65292;&#32534;&#36753;<code>/etc/default/hostapd</code>&#65292;&#25913;&#21464;DAEMON_CONF&#30340;&#37197;&#32622;&#22914;&#19979;</div>\n<pre><code>DAEMON_CONF=\"/etc/hostapd/hostapd.conf\"  <br></code></pre>\n<div>&#20043;&#21518;&#23601;&#21487;&#20197;&#20351;&#29992;<code>sudo service hostapd start</code>&#27491;&#24335;&#21551;&#21160;WIFI&#28909;&#28857;&#20102;</div>\n<blockquote>\n<h3>&#33267;&#27492;&#65292;&#36890;&#24120;&#19968;&#20010;WIFI&#20013;&#32487;&#36335;&#30001;&#22120;&#23601;&#22909;&#20102;&#65292;&#20197;&#19979;&#20171;&#32461;&#36879;&#26126;&#31185;&#23398;&#19978;&#32593;&#37096;&#20998;</h3>\n</blockquote>\n<h5>17.&#24314;&#31435;&#26080;&#27745;&#26579;DNS</h5>\n<div>&#20197;&#21069;&#37117;&#38656;&#35201;&#20351;&#29992;chinadns&#31561;&#39033;&#30446;&#65292;&#29616;&#22312;&#22522;&#26412;&#19978;&#37117;&#30452;&#25509;&#20351;&#29992;&#20013;&#31185;&#22823;&#30340;DNS&#65292;&#30452;&#25509;&#26080;&#27745;&#26579;&#12290;&#22312;<mark>/etc/dnsmasq.conf</mark>&#65292;&#21152;&#20837;&#22914;&#19979;&#35268;&#21017;</div>\n<div>no-resolv<br />server=202.38.93.153<br />server=202.141.162.123</div>\n<div>&#37325;&#21551;dnsmasq&#65292;&#21487;&#20197;&#29992;<code>dig t.co</code>&#27979;&#35797;&#19968;&#19979;</div>\n<h5>18.&#23433;&#35013;shadowsocks</h5>\n<div>&#36825;&#37324;&#39318;&#20808;&#35201;&#35828;&#26126;&#19968;&#19979;&#65292;&#25105;&#25214;&#20102;&#24456;&#20037;&#65292;&#20063;&#27809;&#26377;&#25214;&#21040;&#36866;&#21512;&#26641;&#33683;&#27966;&#30340;shadowsocks-libev&#65292;&#22240;&#27492;&#65292;&#25105;&#20204;&#20351;&#29992;&#20102;redsocks+shadowsocks&#30340;&#32452;&#21512;&#26469;&#26367;&#20195;&#12290;</div>\n<div>&#26641;&#33683;&#27966;&#28304;&#20013;&#30340;shadowsocks&#30340;&#29256;&#26412;&#24456;&#20302;&#65292;&#36830;<mark>rc4-md5</mark>&#37117;&#19981;&#25903;&#25345;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#20351;&#29992;pip&#23433;&#35013;&#65292;&#38190;&#20837;<code>sudo pip install shadowsocks</code>&#21363;&#21487;&#23433;&#35013;&#65292;&#20043;&#21518;&#26032;&#24314;&#37197;&#32622;&#25991;&#20214;<code>/etc/shadowsocks.conf</code>&#22914;&#19979;</div>\n<pre><code>&#65371;<br>    \"server\":\"xxx.xxx.xxx.xxx\",<br>    \"server_port\":8964,<br>    \"local_address\":\"0.0.0.0\",<br>    \"local_port\":1080,<br>    \"password\":\"password\",<br>    \"timeout\":600,<br>    \"method\":\"rc4-md5\"<br>}<br></code></pre>\n<div>&#28982;&#21518;&#29992;&#21629;&#20196;<code>sudo sslocal -c /etc/shadowsocks.conf -d start</code>&#26469;&#21551;&#21160;</div>\n<div>&#27809;&#26377;&#38382;&#39064;&#65292;&#23601;&#23558;<code>sslocal -c /etc/shadowsocks.conf -d start</code>&#21152;&#20837;<code>/etc/rc.local</code>&#26469;&#35753;&#20854;&#24320;&#26426;&#21551;&#21160;</div>\n<h5>19.&#23433;&#35013;redsocks</h5>\n<div>&#25191;&#34892;<code>sudo apt-get install redsocks</code>&#26469;&#23433;&#35013;&#36719;&#20214;&#65292;&#20043;&#21518;&#32534;&#36753;<code>/etc/redsocks.conf</code>,&#26356;&#25913;&#20854;&#20013;&#30340;<mark>redsocks</mark>&#37096;&#20998;&#22914;&#19979;</div>\n<pre><code>redsocks   <br>    local_ip = 0.0.0.0;<br>    local_port = 12345; <br>    ip = 127.0.0.1;<br>    port = 1080;<br><br></code></pre>\n<div>&#20351;&#29992;&#21629;&#20196;<code>sudo service redsocks start</code>&#26469;&#21551;&#21160;&#36719;&#20214;</div>\n<blockquote>\n<div>&#21487;&#20197;&#20351;&#29992;<code>netstat -an|grep 1080</code>&#21644;<code>netstat -an|grep 12345</code>&#26469;&#30830;&#35748;&#19968;&#19979;shadowsocks&#21644;redsocks&#37117;&#21551;&#21160;&#20102;</div>\n</blockquote>\n<h5>20.&#23433;&#35013;ipset&#24182;&#23548;&#20837;chnroute</h5>\n<div>&#25105;&#20204;&#31185;&#23398;&#32763;&#22681;&#30340;&#35268;&#21017;&#65306;<span><em>&#20961;&#26159;&#22269;&#22806;&#30340;&#32593;&#31449;&#37117;&#29992;shadowsocks&#21152;&#36895;</em></span>&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#20511;&#21161;&#20110;ipset&#20445;&#23384;&#22269;&#20869;ip&#27573;&#12290;&#20808;&#29992;<code>sudo apt-get install ipset</code>&#23433;&#35013;&#36719;&#20214;</div>\n<div>&#25191;&#34892;&#21629;&#20196;</div>\n<pre><code>curl 'http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest' | grep ipv4 | grep CN | awk -F| ' printf(\"%s/%dn\", $4, 32-log($5)/log(2)) ' &gt; chnroute.txt  <br></code></pre>\n<div>&#26469;&#23548;&#20986;&#22269;&#20869;ip&#27573;</div>\n<div>&#28982;&#21518;&#29992;&#22914;&#19979;&#21629;&#20196;&#23548;&#20837;&#21040;ipset</div>\n<pre><code>sudo ipset create chnroute hash:net  <br>cat chnroute.txt | sudo xargs -I ip ipset add chnroute ip  <br></code></pre>\n<h5>21.&#22791;&#20221;ipset&#24182;&#24320;&#26426;&#36733;&#20837;</h5>\n<div>&#21508;&#20301;&#30475;&#23448;&#21487;&#33021;&#24050;&#32463;&#21457;&#29616;&#65292;&#23548;&#20837;ipset&#30340;&#36807;&#31243;&#38750;&#24120;&#32531;&#24930;&#65292;&#19981;&#36866;&#21512;&#27599;&#27425;&#24320;&#26426;&#37117;&#25191;&#34892;&#12290;&#25105;&#20204;&#21487;&#20197;&#23558;ipset&#30340;&#32467;&#26524;&#20445;&#23384;&#65292;&#27599;&#27425;&#24320;&#26426;&#23548;&#20837;&#12290;&#25191;&#34892;&#22914;&#19979;&#21629;&#20196;</div>\n<pre><code>sudo ipset chnroute save &gt; /etc/chnroute.ipset  <br></code></pre>\n<div>&#28982;&#21518;&#22312;<mark>/etc/rc.local</mark>&#20013;&#21152;&#20837;&#22914;&#19979;&#35821;&#21477;</div>\n<pre><code>ipset restore &lt; /etc/chnroute.ipset  <br></code></pre>\n<div>&#21363;&#21487;&#24320;&#26426;&#25191;&#34892;</div>\n<h5>22.&#23548;&#20837;&#38450;&#28779;&#22681;&#35268;&#21017;</h5>\n<pre><code>sudo iptables -t nat -N SHADOWSOCKS<br><br>sudo iptables -t nat -A SHADOWSOCKS -d $server_IP -j RETURN<br><br>sudo iptables -t nat -A SHADOWSOCKS -d 0.0.0.0/8 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 10.0.0.0/8 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 127.0.0.0/8 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 169.254.0.0/16 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 172.16.0.0/12 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 192.168.0.0/16 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 224.0.0.0/4 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -d 240.0.0.0/4 -j RETURN  <br>sudo iptables -t nat -A SHADOWSOCKS -m set --match-set chnroute dst -j RETURN<br><br>sudo iptables -t nat -A SHADOWSOCKS -p tcp -j REDIRECT --to-ports 12345<br><br>sudo iptables -t nat -A OUTPUT -p tcp -j SHADOWSOCKS  <br>sudo iptables -t nat -A PREROUTING -p tcp -j SHADOWSOCKS  <br></code></pre>\n<div>&#20854;&#20013;<mark>server_IP</mark>&#26159;&#20320;&#30340;VPS&#30340;&#22320;&#22336;</div>\n<div>&#28982;&#21518;&#20445;&#23384;&#35268;&#21017;</div>\n<pre><code>sudo service netfilter-persistent save  <br></code></pre>\n<h5>23.&#24320;&#26426;&#37325;&#26032;&#29983;&#25928;&#38450;&#28779;&#22681;&#35268;&#21017;</h5>\n<div>&#26082;&#28982;iptables-persistent&#21487;&#20197;&#24320;&#26426;&#21152;&#36733;&#38450;&#28779;&#22681;&#35268;&#21017;&#65292;&#20026;&#20160;&#20040;&#36824;&#35201;&#35848;&#36825;&#20010;&#65311;&#22240;&#20026;&#38450;&#28779;&#22681;&#35268;&#21017;&#20013;&#65292;&#26377;&#20351;&#29992;&#21040;redsocks&#30340;&#31471;&#21475;12345&#65292;&#20294;&#26159;&#22240;&#20026;&#21551;&#21160;&#39034;&#24207;&#38382;&#39064;&#65292;&#24456;&#21487;&#33021;redsocks&#36824;&#27809;&#26377;&#21551;&#21160;&#65292;&#38450;&#28779;&#22681;&#35268;&#21017;&#20808;&#21152;&#36733;&#20102;&#65292;&#25152;&#20197;&#20250;&#23548;&#33268;&#38450;&#28779;&#22681;&#35268;&#21017;&#21152;&#36733;&#22833;&#36133;&#12290;&#22240;&#27492;&#65292;&#25105;&#20204;&#38656;&#35201;&#25226;&#35268;&#21017;&#21152;&#36733;&#25918;&#20837;<mark>/etc/rc.local</mark>&#20013;:</div>\n<pre><code>iptables-restore &lt; /etc/iptables/rules.v4  <br></code></pre>\n<blockquote>\n<h3>&#33267;&#27492;&#65292;&#25972;&#20010;&#25945;&#31243;&#23601;&#20889;&#23436;&#20102;&#12290;&#36825;&#20123;&#27493;&#39588;&#26159;&#25105;&#23454;&#39564;&#20102;&#19977;&#22235;&#36941;&#20043;&#21518;&#30340;&#32463;&#39564;&#25152;&#24471;&#65292;&#35831;&#22312;&#36716;&#36733;&#26102;&#65292;&#27880;&#26126;&#20986;&#22788;&#65292;&#38750;&#24120;&#24863;&#35874;&#12290;</h3>\n</blockquote>\n<div>&#32763;&#22681;&#25216;&#26415;&#21338;&#23458;<a href=\"http://www.chinagfw.org/2013/09/blog-post.html\">&#35746;&#38405;&#22320;&#22336;&#21450;&#31038;&#20132;&#24080;&#21495;</a></div>\n</p>\n<p>请在<a href=\"https://github.com/yinghuocho/download/blob/master/firefly-proxy-win-latest.zip?raw=true\">这里</a>下载最新翻墙利器萤火虫代理。</p>\n","author":1005,"categories":[18270,18269,10466,15300],"tags":[7775,30739,8795,11030]}