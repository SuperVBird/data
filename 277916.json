{"id":277916,"link":"https://chinadigitaltimes.net/chinese/2013/02/翻墙-使用dd-wrt自动翻墙autoddvpn去广告adblock并开启端口转发/","date":"2013-02-05T07:15:13Z","modified":"2013-02-05T07:15:13Z","title":"翻墙 | 使用DD-WRT自动翻墙(Autoddvpn)去广告(Adblock)并开启端口转发","content":"<p><span><span>最近在鼓捣DD-WRT，把自家用的TP941N v5刷成了DD-WRT并且用脚本实现了自动翻墙。</span></p>\n<h2>脚本：</h2>\n<pre>#!/bin/sh  #开启iptables的net转发功能，在默认的dd-wrt中端口失效，添加这一句就正常  iptables -t nat -A POSTROUTING -j MASQUERADE    #本地ISP劫持HTTP协议，首次HTTP访问会转到本地电信广告，直接过滤  cd /tmp;wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.naic.cc/0.txt\">http://www.naic.cc/0.txt</a>  rm /tmp/0.txt    #下载并自动配置autoddvpn内容  cd /tmp;wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://autoddvpn.googlecode.com/svn/trunk/pptp/wget/run.sh\">http://autoddvpn.googlecode.com/svn/trunk/pptp/wget/run.sh</a>  && /bin/sh run.sh || touch failed    #下载并自动配置adblock的chinalist lazy规则，提取当中的广告域名指向127.0.0.1  rm /tmp/dnsmasq.ads  wget -O - <a rel=\"nofollow\" target=\"_blank\" href=\"http://adblock-chinalist.googlecode.com/svn/trunk/adblock-lazy.txt\">http://adblock-chinalist.googlecode.com/svn/trunk/adblock-lazy.txt</a> |  grep ^||[^*]*^$ |  sed -e 's:||:address=/:' -e 's:^:/127.0.0.1:' > /tmp/dnsmasq.ads  killall dnsmasq  dnsmasq --conf-file=/tmp/dnsmasq.conf</pre>\n<p></p>\n<h2>以上的脚本添加到【管理】→【命令】，保存为【自定义指令】</h2>\n<p><span>然后添加</span></p>\n<pre>/tmp/custom.sh</pre>\n<p></p>\n<h2>保存为【防火墙指令】</h2>\n<p><span>这样，每次链接网络成功之后，就会执行这个脚本。</span></p>\n<h2>当然，以上只是第一步，下面设置VPN链接。</h2>\n<p><span>PPTP主机请用IP设置， 不要设置FQDN，否则之后会断线</span><br /><span>【MPPE加密】里面输入 mppe required,no40,no56,stateless</p>\n","author":1005,"categories":[18269,15300],"tags":[7775,8817]}