{"id":544185,"link":"https://chinadigitaltimes.net/chinese/2016/11/gfw-blog-我的科学上网技巧/","date":"2016-11-08T10:42:23Z","modified":"2016-11-08T10:42:23Z","title":"GFW Blog | 我的科学上网技巧","content":"<div><a href=\"https://3.bp.blogspot.com/-XJAO6H7450U/WCANX4Lzd_I/AAAAAAAADYw/8DSXYHpsRfUmJNCO8Vh3q77Jo-iu-KTKQCLcB/s1600/DPtDl78.png\"><img src=\"https://3.bp.blogspot.com/-XJAO6H7450U/WCANX4Lzd_I/AAAAAAAADYw/8DSXYHpsRfUmJNCO8Vh3q77Jo-iu-KTKQCLcB/s1600/DPtDl78.png\" border=\"0\" /></a></div>\n<p>科学上网技巧分享。</p>\n<p><a name=\"more\"></a><br />\n来源：<a href=\"https://g2ex.github.io/2016/05/20/Tips-on-Chinternet/\">https://g2ex.github.io/2016/05/20/Tips-on-Chinternet/</a></p>\n<div>尽管也称互联网，但在国内，如若有以下一个或多个需求，你就不得不学习一下科学上网了：</div>\n<ol>\n<li>访问的网站或服务被（GFW）墙；</li>\n<li>网络提供商（ISP）劫持了网络流量；</li>\n<li>需要匿名（隐藏真实 IP）的情况，如渗透测试；</li>\n<li>躲避网络监控；</li>\n<li>其他情况。</li>\n</ol>\n<div>这里分享一下我的科学上网技巧，使用到的工具软件可能有 <code>Shadowsocks</code>、<code>Lantern</code>、<code>Privoxy</code>、<code>Tor</code>。根据不同的目的选择不同的工具。</div>\n<h2>一、绕过 GFW 和 ISP 劫持</h2>\n<div>最简单和不折腾的方法是购买 VPN，次之是购买一台海外 VPS，自己安装 VPN 或 Shadowsocks 服务端。VPN 的优点是可以全局翻墙，Shadowsocks 虽然可以设置全局模式，但是对于不支持代理的本地应用是没有办法的，当然这种情况下可以试试 <code>ProxifierPE</code> 强制所有连接通过代理上网。</div>\n<div>使用 Shadowsocks 可能遇到的另一个问题是，因为 Shadowsocks 使用的是 SOCKS5 类型的代理，当本地应用只支持 HTTP/HTTPS 类型代理时，就需要自己解决 HTTP 转换为 SOCKS5 的问题。当然，这个问题使用 <code>Privoxy</code> 就能很好地解决。</div>\n<div>本节主要介绍如何组合使用 Shadowsocks 和 Privoxy，并假设你已经安装并配置好了 Shadowsocks（Linux 中可以安装 shadowsocks-qt5 或 命令行版本的 Shadowsocks）。</div>\n<div>Shadowsocks 与 Privoxy 组合使用的示意图如下所示：</div>\n<div><a title=\"Shadowsocks Privoxy 组合使用示意图\" href=\"https://i.imgur.com/sAKKSVj.png\" rel=\"group\"><img title=\"Shadowsocks Privoxy 组合使用示意图\" src=\"https://i.imgur.com/sAKKSVj.png\" alt=\"Shadowsocks_Privoxy\" /></a></div>\n<div><a title=\"Shadowsocks Privoxy 组合使用示意图\" href=\"https://i.imgur.com/sAKKSVj.png\" rel=\"group\">Shadowsocks Privoxy 组合使用示意图</a></div>\n<p>&nbsp;</p>\n<div>假设你已经配置好了 Shadowsocks，接下来配置 Privoxy。<br />\n<strong>Windows</strong> 系统中右键点击 Privoxy 托盘图标，依次点击 <code>Edit</code> &#8211; <code>Main Configuration</code> 打开配置文件；<strong>Linux</strong> 系统中 Privoxy 的配置文件位于<code>/etc/privoxy/config</code>。<br />\n配置文件修改为：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</p>\n<div>\n3</div>\n<p>&nbsp;</p>\n<div>\n4</div>\n<p>&nbsp;</p>\n<div>\n5</div>\n<p>&nbsp;</p>\n<div>\n6</div>\n<p>&nbsp;</td>\n<td>\n<div>\n# 把 HTTP 流量转发到本机 127.0.0.1:1080 的 Shadowsocks</div>\n<p>&nbsp;</p>\n<div>\nforward-socks5 / 127.0.0.1:1080 .</div>\n<p>&nbsp;</p>\n<div></div>\n<p>&nbsp;</p>\n<div>\n# 可选，默认只监听本地连接 127.0.0.1:8118</div>\n<p>&nbsp;</p>\n<div>\n# 可以允许局域网中的连接</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 0.0.0.0:8118</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>启动 Shadowsocks 和 Privoxy 后，把本地应用的代理设置为 HTTP/HTTPS 类型的 <code>127.0.0.1:8118</code>，就可以绕过 GFW 和 ISP 了。如果局域网中的其他 PC 或手机也希望使用该电脑上网（假设该电脑 IP 地址为 <code>192.168.1.10</code>），把它们的代理设置为 <code>19.168.1.10:8118</code> 即可。</div>\n<div><strong>Tips</strong></div>\n<div>目前，有一个讨巧的的办法替代这两者的组合：使用 <a title=\"Lantern\" href=\"https://www.getlantern.org/\" target=\"_blank\" rel=\"external\">Lantern</a> —— 一款<a title=\"Lantern Github 主页\" href=\"https://github.com/getlantern/lantern\" target=\"_blank\" rel=\"external\">开源</a>的安全上网工具。它使用的是 HTTP 类型代理，本地端口为 <code>8787</code>，也就是说，把本地应用的代理设置为 <code>127.0.0.1:8787</code> 就可以使用 HTTP 类型的代理了。而且使用它，也无需自己购买 VPS。</div>\n<div>Lantern 默认非全局代理，可以在设置中改为全局模式。</div>\n<div>另一方面，Lantern 只监听本机 <code>127.0.0.1:8787</code> 的连接，如果局域网中的电脑或手机也想通过这台电脑翻墙（假设该电脑 IP 地址为 192.168.1.10），那么也需要配合 Privoxy 使用。这时，Privoxy 的配置应该如下：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</p>\n<div>\n3</div>\n<p>&nbsp;</td>\n<td>\n<div>\n# 监听局域网中连接到本地 8118 端口的连接，转发给 8787 端口的 Lantern</div>\n<p>&nbsp;</p>\n<div>\nforward / 127.0.0.1:8787</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 127.0.0.1:8118 # 可改为 0.0.0.0:8118 允许局域网的连接</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<h2>二、匿名上网</h2>\n<div>网络中保持匿名的办法是使用 <a title=\"Tor 官网\" href=\"https://www.torproject.org/\" target=\"_blank\" rel=\"external\">Tor</a>，匿名的意思是隐藏你当前的 IP 地址。Internet 上有很多志愿者运行着 Tor 中继节点，Tor 能保证从出发点的流量至少经过三个不同的中继节点到达目的地址，而且这三个不同的中继不会每次都相同。</div>\n<div>形象地说，你想把一封匿名信交给小明，在大街上随便找了一陌生人 A 让 A 帮忙转交，A 走了一段路程后随便找了一个陌生人 B 让 B 帮忙转交，B 走了一段路程后随便找了一个陌生人 C 让 C 帮忙转交，最终 C 按照信封上的地址找到了小明并把信交给了他。小明只知道是 C 转交了这封信，至于是谁写的这封信，他就无从得知了。A、B、C 分别对应着 Tor 网络的中继节点，这种投递匿名信的方式就起到了隐藏 IP 地址的效果。</div>\n<div>如下图所示，使用 Tor 从本机经过三跳访问了 Google。</div>\n<div><a title=\"Tor Browser\" href=\"https://i.imgur.com/DPtDl78.png\" rel=\"group\"><img title=\"Tor Browser\" src=\"https://i.imgur.com/DPtDl78.png\" alt=\"Tor_Browser\" /></a></div>\n<div><a title=\"Tor Browser\" href=\"https://i.imgur.com/DPtDl78.png\" rel=\"group\">Tor Browser</a></div>\n<p>&nbsp;</p>\n<h3>Tor 浏览器</h3>\n<div>为了方便使用 Tor，Tor 开发者把 Tor 集成到了定制版的 Firefox 中，简单设置一下就能正常使用。</div>\n<div>Tor 浏览器专为大陆等网络环境加入了流量混淆的选项。首次打开浏览器时会弹出 Tor 状态检查，点击<code>设置</code>配置 Tor 网桥，勾选<code>互联网提供商（ISP）是否对 Tor 网络连接进行了封锁或审查</code>中的<code>是</code>，把下一步中的网桥类型选择<code>meek-amazon</code>或<code>meek-azure</code>。这两者在大陆没被完全封锁，因此可以用来做跳板网桥。</div>\n<div>不过随着网络环境的恶化，Tor 提供的网桥类型都不可用时，就需要使用自己的 Shadowsocks 或 Lantern 代理了。</div>\n<div>首次打开 Tor 浏览器，在 Tor 设置中勾选<code>互联网提供商（ISP）是否对 Tor 网络连接进行了封锁或审查</code>中的<code>否</code>，在下一步<code>是否需要本地代理访问互联网？</code>中选择<code>是</code>，下一步中设置你的代理：</div>\n<ul>\n<li>使用 Shadowsocks 则设置为 SOCKS5 类型的 <code>127.0.0.1:1080</code>；</li>\n<li>使用 Lantern 则设置为 HTTP/HTTPS 类型的 <code>127.0.0.1:8787</code>；</li>\n</ul>\n<div>如果通过局域网中其他计算机的配置联网，把 <code>127.0.0.1</code> 改为那台计算机的 IP 地址。</div>\n<div>使用了代理的 Tor 浏览器原理示意图如下（以 Tor + Shadowsocks 组合为例）：</div>\n<div><a title=\"Tor 浏览器 + Shadowsocks 组合使用示意图\" href=\"https://i.imgur.com/w8B4bWe.png\" rel=\"group\"><img title=\"Tor 浏览器 + Shadowsocks 组合使用示意图\" src=\"https://i.imgur.com/w8B4bWe.png\" alt=\"Tor_Shadowsocks\" /></a></div>\n<div><a title=\"Tor 浏览器 + Shadowsocks 组合使用示意图\" href=\"https://i.imgur.com/w8B4bWe.png\" rel=\"group\">Tor 浏览器 + Shadowsocks 组合使用示意图</a></div>\n<p>&nbsp;</p>\n<h3>Tor Expert Bundle</h3>\n<div>Tor 浏览器适用于使用浏览器匿名上网的场景，如果打算让本地应用（如其他浏览器、Linux 中的 Terminal 等）也使用 Tor 隐藏 IP 地址，那么就需要自己手动配置 Tor 了。从 <a title=\"Tor 下载\" href=\"https://www.torproject.org/download/\" target=\"_blank\" rel=\"external\">Tor 官网下载</a> 操作系统对应的 <code>Expert Bundle</code>，它只包含 Tor 工具，不含浏览器。</div>\n<div>假设你已经配置好了 Shadowsocks，接下来，为 Tor 配置 Shadowsocks 代理。</div>\n<div><strong>Windows</strong> 系统中，打开 <code>%AppData%/tor</code> 目录（如果不存在则创建该目录），新建 <code>torrc</code> 文件，内容如下：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</p>\n<div>\n3</div>\n<p>&nbsp;</p>\n<div>\n4</div>\n<p>&nbsp;</p>\n<div>\n5</div>\n<p>&nbsp;</p>\n<div>\n6</div>\n<p>&nbsp;</p>\n<div>\n7</div>\n<p>&nbsp;</p>\n<div>\n8</div>\n<p>&nbsp;</td>\n<td>\n<div>\n## 通过 SOCKS5 代理</div>\n<p>&nbsp;</p>\n<div>\nSOCKS5Proxy 127.0.0.1:1080</div>\n<p>&nbsp;</p>\n<div>\n## 如果使用 HTTP/HTTPS 代理</div>\n<p>&nbsp;</p>\n<div>\n# HTTPSProxy 127.0.0.1:8118</div>\n<p>&nbsp;</p>\n<div></div>\n<p>&nbsp;</p>\n<div>\n## 如果只允许特定端口的网络连接，如 80 和 443</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses *:80,*:443</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses reject *:*</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div><strong>Linux</strong> 系统中，Tor 的配置文件位于 <code>/etc/tor/torrc</code>，配置内容同上。</div>\n<div>启动 Shadowsocks 和 Tor，因为 Tor 监听的是 SOCKS5 类型的本地 <code>9050</code> 端口，把需要匿名的本地应用代理设置为 SOCKS5 类型，代理地址设置为 <code>127.0.0.1:9050</code>，实现匿名上网。</div>\n<div>还是老问题，如果本地应用只支持 HTTP/HTTPS 代理类型，那么仍需要使用 Privoxy，修改其配置文件为：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</td>\n<td>\n<div>\nforward-socks5 / 127.0.0.1:9050 .</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 127.0.0.1:8118 # 可改为 0.0.0.0:8118 允许局域网的连接</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>这样一来，本地应用的代理设置为 HTTP/HTTPS 类型的 <code>127.0.0.1:8118</code> 就可以实现匿名上网了。</div>\n<div>Privoxy + Tor + Shadowsocks 组合使用示意图如下所示：</div>\n<div><a title=\"Privoxy + Tor + Shadowsocks 组合使用示意图\" href=\"https://i.imgur.com/oRaHkuq.png\" rel=\"group\"><img title=\"Privoxy + Tor + Shadowsocks 组合使用示意图\" src=\"https://i.imgur.com/oRaHkuq.png\" alt=\"此处输入图片的描述\" /></a></div>\n<div><a title=\"Privoxy + Tor + Shadowsocks 组合使用示意图\" href=\"https://i.imgur.com/oRaHkuq.png\" rel=\"group\">Privoxy + Tor + Shadowsocks 组合使用示意图</a></div>\n<p>&nbsp;</p>\n<h3>One More Tip</h3>\n<div>使用 Tor 匿名访问网络除了应用于渗透测试，另一个应用场景是编写爬虫变换 IP 地址爬取站点，减小被网站屏蔽的可能性。</div>\n<div>在 Linux Terminal 中，使用 export 命令设置代理，可以只在当前 Terminal 中生效，</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</td>\n<td>\n<div>\nexport http_proxy=http://127.0.0.1:8118</div>\n<p>&nbsp;</p>\n<div>\nexport https_proxy=https://127.0.0.1:8118</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<h2>三、总结</h2>\n<div>接下来简要归纳上述内容，给出每种组合的配置内容。</div>\n<h3>Privoxy + Shadowsocks 组合 —— 翻墙</h3>\n<div>配置 Privoxy，Linux 系统中位于 <code>/etc/privoxy/config</code>：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</td>\n<td>\n<div>\nforward-socks5 / 127.0.0.1:1080 .</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 127.0.0.1:8118 # 可改为 0.0.0.0:8118 允许局域网的连接</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>本地代理需设置为 <code>HTTP/HTTPS</code> 类型的 <code>127.0.0.1:8118</code>。<br />\n如果不使用 Privoxy，本地代理需设置为 <code>SOCKS5</code> 类型的 <code>127.0.0.1:1080</code>。</div>\n<h3>Privoxy + Tor + Shadowsocks 组合 —— 匿名上网</h3>\n<div>配置 Privoxy，Linux 系统中位于 <code>/etc/privoxy/config</code>：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</td>\n<td>\n<div>\nforward-socks5 / 127.0.0.1:9050 .</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 0.0.0.0:8118 # 可改为 0.0.0.0:8118 允许局域网的连接</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>配置 Tor，Windows 系统中位于 <code>%AppData%/tor/torrc</code>，Linux 系统中位于 <code>/etc/tor/torrc</code>：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</p>\n<div>\n3</div>\n<p>&nbsp;</td>\n<td>\n<div>\nSOCKS5Proxy 127.0.0.1:1080 # Shadowsocks 代理地址</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses *:80,*:443</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses reject *:*</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div>本地代理需设置为 <code>HTTP/HTTPS</code> 类型的 <code>127.0.0.1:8118</code>。<br />\n如果不使用 Privoxy，本地代理需设置为 <code>SOCKS5</code> 类型的 <code>127.0.0.1:9050</code>。</div>\n<h3>Privoxy + Tor + Lantern 组合 —— 匿名上网</h3>\n<div>配置 Privoxy，Linux 系统中位于 <code>/etc/privoxy/config</code>：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</td>\n<td>\n<div>\nforward-socks5 / 127.0.0.1:9050 .</div>\n<p>&nbsp;</p>\n<div>\nlisten-address 0.0.0.0:8118 # 可改为 0.0.0.0:8118 允许局域网的连接</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>配置 Tor，Windows 系统中位于 <code>%AppData%/tor/torrc</code>，Linux 系统中位于 <code>/etc/tor/torrc</code>：</div>\n<p>&nbsp;</p>\n<figure>\n<table>\n<tbody>\n<tr>\n<td>\n<div>\n1</div>\n<p>&nbsp;</p>\n<div>\n2</div>\n<p>&nbsp;</p>\n<div>\n3</div>\n<p>&nbsp;</td>\n<td>\n<div>\nHTTPSProxy 127.0.0.1:8787 # Lantern 代理地址</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses *:80,*:443</div>\n<p>&nbsp;</p>\n<div>\nReachableAddresses reject *:*</div>\n<p>&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</figure>\n<p>&nbsp;</p>\n<div></div>\n<div>本地代理需设置为 <code>HTTP/HTTPS</code> 类型的 <code>127.0.0.1:8118</code>。<br />\n如果不使用 Privoxy，本地代理需设置为 <code>SOCKS5</code> 类型的 <code>127.0.0.1:9050</code>。</div>\n<div>翻墙技术博客<a href=\"http://www.chinagfw.org/2013/09/blog-post.html\">订阅地址及社交帐号</a></div>\n<p>请点击<a href=\"https://github.com/cdtmirrors/cdt.unblocked\">这里</a>下载火狐或者Chome浏览器扩展，穿墙阅读中国数字时代网站。</p>\n","author":1005,"categories":[18270,18269,10466,15300],"tags":[7775,18544,8795]}