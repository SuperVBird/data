{"id":277877,"link":"https://chinadigitaltimes.net/chinese/2013/02/翻墙-人为网络故障的新方式/","date":"2013-02-05T03:15:20Z","modified":"2013-02-05T03:15:20Z","title":"翻墙 | 人为网络故障的新方式","content":"<p><span></p>\n<p>笔者在《<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.williamlong.info/archives/2195.html\">如何区分国内上网环境中不同的人为网络故障</a>》中曾经介绍过人为网络故障的多种方式，但近阶段又发现出现了新型的人为网络故障，此文将为大家进行介绍这种新型的人为网络故障。</p>\n<p>　 　事情的起因是在前几天公司在海外的服务器工作不正常，国内用户访问该服务器上的网站要么只显示一个标题，然后一直处于加载之中，要么就是无法连接到服务 器。经过自己的试验，发现一旦访问了服务器的网站（或者连接了服务器的SSH），五分钟之内便无法和服务器进行通讯，五分钟之内PING全部超时，过了五 分钟后恢复。而且经常是网页传输到一半就无法和服务器进行通讯了，所以出现了有时候网站要么只显示一个标题，然后一直处于加载之中，有时候无法连接到服务 器的情况。如果五分钟后再次访问服务器上的网站，则此现象就再次重复出现。</p>\n<p>为此，为了诊断故障原因，在无法访问服务器的五分钟内，关闭了服务器的iptables并使用了路由跟踪工具，结果如下：</p>\n<p><img alt=\"人为网络故障的新方式\" src=\"http://www.williamlong.info/upload/3342_1.jpg\" border=\"0\" /></p>\n<p>从路由跟踪的结果发现，最后一跳是74.117.63.66，查询IP所在的地理位置显示此IP所在地为美国，经过《如何区分国内上网环境中不同的人为网络故障》文中介绍的方式判断，似乎问题出在美国的网络部分。为此，和美国服务器提供商进行了联系，同时提供了路由跟踪结果。不过，提供商那里经过检查并没有设置过任何屏蔽IP的机制（包括根据访问后屏蔽五分钟的机制），需要排查国内自己本地网络的问题。</p>\n<p>经过思考，猜想是否有可能是防火墙进行了反向屏蔽：如果网络数据包中的源IP为国内，目标IP在国外，则放行；如果网络数据包中的源IP为国外五分钟内 临时被屏蔽的IP，目标IP为国内，防火墙则丢弃该数据包。如果是这样，也就能解释通为什么最后一跳是在美国，但却是防火墙的屏蔽。因为国内发往国外的数 据包永远被放行，所以海外服务器可以收到数据包，而在前13跳中返回数据包的IP地址都不在防火墙的黑名单之内，所以TTL超时的数据包仍旧可以发回国内 的IP地址（路由跟踪工具的原理就是每次TTL加一，每次经过路由器则TTL减一，如果减到零那么路由器会发送TTL超时的数据包给源IP）。最后一跳之 后由于海外的IP地址被屏蔽，则数据包无法送达国内的IP地址。这么解释就可以解释得通为什么最后一跳在美国，但却是防火墙的屏蔽了。</p>\n<p>但猜测归猜测，证据在哪里呢？</p>\n<p>为此，使用了其他代理工具连接上服务器的SSH，在被临时屏蔽的五分钟内反向路由追踪国内无法访问网站的IP地址，结果如下：</p>\n<p><img alt=\"人为网络故障的新方式\" src=\"http://www.williamlong.info/upload/3342_2.jpg\" border=\"0\" /></p>\n<p>从反向路由追踪结果看，最后一跳是202.97.33.101，地理位置查询该IP属于&#8221;上海市 电信骨干网&#8221;，从而验证了猜测。而反向追踪的第一跳74.117.63.66又正好是正向路由追踪中的最后一跳，又再次验证了猜想中的正向路由追踪中的最 后一跳之后的IP地址（也就是服务器的IP地址）被屏蔽的情况。至此，问题已经明确。</p>\n<p>之后，又再次在五分钟临时被屏蔽的时间内反向追踪了上海的其他IP地址，显示可以正常访问，并不影响服务器访问国内的网站，只有国内的IP地址首先对国外被屏蔽的IP地址发起通讯才能触发被五分钟临时屏蔽：</p>\n<p><img alt=\"人为网络故障的新方式\" src=\"http://www.williamlong.info/upload/3342_3.jpg\" border=\"0\" /></p>\n<p>而《如何区分国内上网环境中不同的人为网络故障》中介绍的通过国内IP路由跟踪国外IP进行判断是国内人为的网络故障还是海外的网络故障在一些情况中将不再适用。</p>\n<p>来源：投稿，作者：DavidSky，作者E-mail：lehui99 (at ) gmail.com</p>\n<p><strong>来源</strong>：<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.williamlong.info/archives/3342.html\">http://www.williamlong.info/archives/3342.html</a></p>\n<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://igfw.net/archives/12871\">http://igfw.net/archives/12871</a></span></p>\n<div>获取最新穿墙软件？请发电邮（最好用gmail）到：cdtcaonima@gmail.com。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n<a href=\"http://eepurl.com/mstlf\">墙外新闻实时更新 欢迎订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[7775,8795]}