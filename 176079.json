{"id":176079,"link":"https://chinadigitaltimes.net/chinese/2011/08/阮一峰-贝叶斯推断及其互联网应用（二）/","date":"2011-08-31T23:14:46Z","modified":"2011-08-31T23:14:46Z","title":"阮一峰 | 贝叶斯推断及其互联网应用（二）","content":"<p><p>上一次，我介绍了贝叶斯推断的<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_one.html\">原理</a>，今天讲如何将它用于垃圾邮件过滤。</p>\n<p>========================================</p>\n<p><strong>贝叶斯推断及其互联网应用</strong></p>\n<p>作者：阮一峰</p>\n<p><img src=\"http://image.beekka.com/blog/201108/bg2011082703.jpg\" /></p>\n<p>（接上文）</p>\n<p><strong>七、什么是贝叶斯过滤器？</strong></p>\n<p>垃圾邮件是一种令人头痛的顽症，困扰着所有的互联网用户。</p>\n<p>正确识别垃圾邮件的技术难度非常大。传统的垃圾邮件过滤方法，主要有&#8221;关键词法&#8221;和&#8221;校验码法&#8221;等。前者的过滤依据是特定的词语；后者则是计算邮件文本的校验码，再与已知的垃圾邮件进行对比。它们的识别效果都不理想，而且很容易规避。</p>\n<p>2002年，<a rel=\"nofollow\" href=\"http://www.paulgraham.com/spam.html\">Paul Graham</a>提出使用&#8221;贝叶斯推断&#8221;过滤垃圾邮件。他说，这样做的效果，好得不可思议。1000封垃圾邮件可以过滤掉995封，且没有一个误判。</p>\n<p>另外，这种过滤器还具有自我学习的功能，会根据新收到的邮件，不断调整。收到的垃圾邮件越多，它的准确率就越高。</p>\n<p><strong>八、建立历史资料库</strong></p>\n<p>贝叶斯过滤器是一种统计学过滤器，建立在已有的统计结果之上。所以，我们必须预先提供两组已经识别好的邮件，一组是正常邮件，另一组是垃圾邮件。</p>\n<p>我们用这两组邮件，对过滤器进行&#8221;训练&#8221;。这两组邮件的规模越大，训练效果就越好。Paul Graham使用的邮件规模，是正常邮件和垃圾邮件各4000封。</p>\n<p>&#8220;训练&#8221;过程很简单。首先，解析所有邮件，提取每一个词。然后，计算每个词语在正常邮件和垃圾邮件中的出现频率。比如，我们假定&#8221;sex&#8221;这个词，在4000封垃圾邮件中，有200封包含这个词，那么它的出现频率就是5%；而在4000封正常邮件中，只有2封包含这个词，那么出现频率就是0.05%。（【注释】如果某个词只出现在垃圾邮件中，Paul Graham就假定，它在正常邮件的出现频率是1%，反之亦然。随着邮件数量的增加，计算结果会自动调整。）</p>\n<p>有了这个初步的统计结果，过滤器就可以投入使用了。</p>\n<p><strong>九、贝叶斯过滤器的使用过程</strong></p>\n<p>现在，我们收到了一封新邮件。在未经统计分析之前，我们假定它是垃圾邮件的概率为50%。（【注释】有研究表明，用户收到的电子邮件中，80%是垃圾邮件。但是，这里仍然假定垃圾邮件的&#8221;先验概率&#8221;为50%。）</p>\n<p>我们用S表示垃圾邮件（spam），H表示正常邮件（healthy）。因此，P(S)和P(H)的先验概率，都是50%。</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P(S)%3DP(H)%3D50%25&#038;chs=40\" /></p>\n<p>然后，对这封邮件进行解析，发现其中包含了sex这个词，请问这封邮件属于垃圾邮件的概率有多高？</p>\n<p>我们用W表示&#8221;sex&#8221;这个词，那么问题就变成了如何计算P(S|W)的值，即在某个词语（W）已经存在的条件下，垃圾邮件（S）的概率有多大。</p>\n<p>根据条件概率公式，马上可以写出</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P(S%7CW)%3D%5Cfrac%7BP(W%7CS)P(S)%7D%7BP(W%7CS)P(S)%2BP(W%7CH)P(H)%7D&#038;chs=70\" /></p>\n<p>公式中，P(W|S)和P(W|H)的含义是，这个词语在垃圾邮件和正常邮件中，分别出现的概率。这两个值可以从历史资料库中得到，对sex这个词来说，上文假定它们分别等于5%和0.05%。另外，P(S)和P(H)的值，前面说过都等于50%。所以，马上可以计算P(S|W)的值：</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P(S%7CW)%3D%5Cfrac%7B5%25%5Ctimes%2050%25%7D%7B5%25%5Ctimes%2050%25%2B0.05%25%5Ctimes%2050%25%7D%3D99.0%25&#038;chs=70\" /></p>\n<p>因此，这封新邮件是垃圾邮件的概率等于99%。这说明，sex这个词的推断能力很强，将50%的&#8221;先验概率&#8221;一下子提高到了99%的&#8221;后验概率&#8221;。</p>\n<p><strong>十、联合概率的计算</strong></p>\n<p>做完上面一步，请问我们能否得出结论，这封新邮件就是垃圾邮件？</p>\n<p>回答是不能。因为一封邮件包含很多词语，一些词语（比如sex）说这是垃圾邮件，另一些说这不是。你怎么知道以哪个词为准？</p>\n<p>Paul Graham的做法是，选出这封信中P(S|W)最高的15个词，计算它们的联合概率。（【注释】如果有的词是第一次出现，无法计算P(S|W)，Paul Graham就假定这个值等于0.4。因为垃圾邮件用的往往都是某些固定的词语，所以如果你从来没见过某个词，它多半是一个正常的词。）</p>\n<p>所谓联合概率，就是指在多个事件发生的情况下，另一个事件发生概率有多大。比如，已知W1和W2是两个不同的词语，它们都出现在某封电子邮件之中，那么这封邮件是垃圾邮件的概率，就是联合概率。</p>\n<p>在已知W1和W2的情况下，无非就是两种结果：垃圾邮件（事件E1）或正常邮件（事件E2）。</p>\n<p><img src=\"http://image.beekka.com/blog/201108/bg2011082701.png\" /></p>\n<p>其中，W1、W2和垃圾邮件的概率分别如下：</p>\n<p><img src=\"http://image.beekka.com/blog/201108/bg2011082702.png\" /></p>\n<p>如果假定所有事件都是独立事件（【注释】严格地说，这个假定不成立，但是这里可以忽略），那么就可以计算P(E1)和P(E2)：</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P(E_%7B1%7D)%3DP(S%7CW_%7B1%7D)P(S%7CW_%7B2%7D)P(S)&#038;chs=40\" /></p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P(E_%7B2%7D)%3D(1-P(S%7CW_%7B1%7D))(1-P(S%7CW_%7B2%7D))(1-P(S))&#038;chs=40\" /></p>\n<p>又由于在W1和W2已经发生的情况下，垃圾邮件的概率等于下面的式子：</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P%3D%5Cfrac%7BP(E_%7B1%7D)%7D%7BP(E_%7B1%7D)%2BP(E_%7B2%7D)%7D&#038;chs=70\" /></p>\n<p>即</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P%3D%5Cfrac%7BP(S%7CW_%7B1%7D)P(S%7CW_%7B2%7D)P(S)%7D%7BP(S%7CW_%7B1%7D)P(S%7CW_%7B2%7D)P(S)%2B(1-P(S%7CW_%7B1%7D))(1-P(S%7CW_%7B2%7D))(1-P(S))%7D&#038;chs=70\" /></p>\n<p>将P(S)等于0.5代入，得到</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P%3D%5Cfrac%7BP(S%7CW_%7B1%7D)P(S%7CW_%7B2%7D)%7D%7BP(S%7CW_%7B1%7D)P(S%7CW_%7B2%7D)%2B(1-P(S%7CW_%7B1%7D))(1-P(S%7CW_%7B2%7D))%7D&#038;chs=70\" /></p>\n<p>将P(S|W1)记为P1，P(S|W1)记为P2，公式就变成</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P%3D%5Cfrac%7BP_%7B1%7DP_%7B2%7D%7D%7BP_%7B1%7DP_%7B2%7D%2B(1-P_%7B1%7D)(1-P_%7B2%7D)%7D&#038;chs=70\" /></p>\n<p>这就是联合概率的计算公式。</p>\n<p><strong>十一、最终的计算公式</strong></p>\n<p>将上面的公式扩展到15个词的情况，就得到了最终的概率计算公式：</p>\n<p><img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=P%3D%5Cfrac%7BP_%7B1%7DP_%7B2%7D%5Ccdot%20%5Ccdot%20%5Ccdot%20P_%7B15%7D%7D%7BP_%7B1%7DP_%7B2%7D%5Ccdot%20%5Ccdot%20%5Ccdot%20P_%7B15%7D%2B(1-P_%7B1%7D)(1-P_%7B2%7D)%5Ccdot%20%5Ccdot%20%5Ccdot%20(1-P_%7B15%7D)%7D&#038;chs=70\" /></p>\n<p>一封邮件是不是垃圾邮件，就用这个式子进行计算。这时我们还需要一个用于比较的门槛值。Paul Graham的门槛值是0.9，概率大于0.9，表示15个词联合认定，这封邮件有90%以上的可能属于垃圾邮件；概率小于0.9，就表示是正常邮件。</p>\n<p>有了这个公式以后，一封正常的信件即使出现sex这个词，也不会被认定为垃圾邮件了。</p>\n<p>（完）\n</p>\n<div>\n<h3>文档信息</h3>\n<ul>\n<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a rel=\"nofollow\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">Creative Commons BY-NC-ND 3.0</a></li>\n<li>原文网址：<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_two.html\">http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_two.html</a></li>\n<li>最后修改时间：2011年8月27日 16:21</li>\n<li>付费支持（<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/05/my_google_adsense_is_disabled.html\">说明</a>）：<a rel=\"nofollow\" href=\"https://lab.alipay.com/p.htm?id=2011081500435188\"><img alt=\"支付宝担保交易\" src=\"http://chinadigitaltimes.net/chinese/files/2011/08/3a976ef2rmb_32.png.png\" /></a> | <a rel=\"nofollow\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&#038;business=yifeng.ruan@gmail.com&#038;currency_code=USD&#038;amount=0.3&#038;return=http://www.ruanyifeng.com/thank.html&#038;item_name=Ruan%20YiFeng's%20Blog&#038;undefined_quantity=1&#038;no_note=0\"><img alt=\"paypal\" src=\"http://chinadigitaltimes.net/chinese/files/2011/08/5ca83e43dollar_32.png.png\" /></a> </li>\n</ul>\n</div>\n<div>\n<p><a rel=\"nofollow\" href=\"http://www.nanrenwa.com/click/go/ruanyifeng.banner.feed.yfblogfeed/gift\"><img src=\"http://nanrenwa.com/_img/a/2011/yfblog_feed.png\" /></a></p>\n</div>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2011/08/4cea5aa9g2011082703.jpg-150x150.jpg\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":991,"categories":[9203],"tags":[9400]}