{"id":247713,"link":"https://chinadigitaltimes.net/chinese/2012/08/翻墙-在-linux-下使用你的网站主机作为加密代理服务器/","date":"2012-08-18T10:30:18Z","modified":"2012-08-18T10:30:18Z","title":"翻墙 | 在 Linux 下使用你的网站主机作为加密代理服务器","content":"<p><p>本文是由英国留学生Jonathan用中文写的教学文章。</p>\n<p></p>\n<p> Jonathan是英国人，在北京已经待了两年，然而他运用中文的能力却已经如此娴熟。另外，他还是一个铁杆Linux粉丝，他希望认识更多的中国Linux粉丝。一起相互学习和交流。</p>\n<p></p>\n<p> 下文属全文转载，未改动一个字。大家来为Jonathan欢呼吧！</p>\n<p></p>\n<p> </p>\n<p>―�</p>\n<p></p>\n<p> 我曾经介绍过如何使用 Amazon EC2 建立自己的代理服务器来&#8221;翻墙&#8221;。用这个方法翻墙虽然网速很快，但还是有些缺点。Amazon EC2 是收费的，而且按小时算，所以不能随时都开着我的代理服务器。另外，每次想用代理的时候还得先等一两分钟，让服务器启动。</p>\n<p> </p>\n<p>然而我今天看到了这个贴子，这才发现还可以使用一个普 通的网站主机作为我的代理服务器。与 Amazon EC2 不同，普通的网站主机是 24/7 运行的，而且你本来就要用它做你的网站，不用额外花钱。以上帖子是专门写给使用 Dreamhost 的 Windows 用户。不过，凡是有支持 SSH 服务网站主机的 Linux 用户也可以享受翻墙的自由感。我为 Linux 用户编了一个小的 BASH 脚本，其主要功能为:</p>\n<p></p>\n</p>\n<p>与网站主机创建一个 SSH 隧道连接<br />SSH 隧道用完之后，安全地关闭 SSH 隧道连接</p>\n<p> 用这个脚本，我试了一下上平时被 GFW 封杀的 <a rel=\"nofollow\" target=\"_blank\" href=\"http://youtube.com\">youtube.com</a>… 结果 Firefox 差点让我晕倒了! 用这个代理，网速快极了… 感觉好像我还在英国上网似的 (那边一般都用 8M 以上的宽带) � 你可以看一下视频:</p>\n<p> </p>\n<p>介绍一下脚本的内容<br /><code>export SSH_HOST=<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:admin@yoursite.com\">admin@yoursite.com</a> # username@host</code><br /> 这个需要你自己改一下… 就是你的 webhost 给你的 SSH 用户名和主机地址。 格式为 用户名@地址 （凡是用过 SSH 的人都应该知道写什么）<br /><code>if [ ! -f /tmp/.tunnel ]</code><br />看看是否已经有 SSH 隧道开着。有的话就将其关闭。没有就创建新的 SSH 隧道。<br /><code>ssh -f -D 9999 $SSH_HOST \"if [ -f ~/.tunnel ]; then rm ~/.tunnel; fi; while [ ! -f ~/.tunnel ]; do echo > /dev/null; done\" &</code><br /> 创建新的 SSH 隧道，设定本地 SOCKS 端口为 9999。隧道将会开着直到远程目录 &#8220;~/&#8221; 里有人创建 .tunnel 此文件为止。<br /><code>touch /tmp/.tunnel</code><br />在你的电脑上创建 .tunnel 这个文件。这样脚本就知道正开着一个 SSH 隧道。<br /><code>ssh $SSH_HOST \"touch ~/.tunnel\"</code><br /> 在远程目录 &#8220;~/&#8221; 里创建 .tunnel 此文件，这将会断开你电脑与代理服务器的连接<br /><code>rm /tmp/.tunnel</code><br />删除 .tunnel 这个文件。这样脚本就知道 SSH 隧道已关闭。</p>\n<p> </p>\n<p>下载并执行脚本<br />可以在此下载脚本</p>\n<p></p>\n<p> 下载后放在你的首目录，比如在 ~/bin/。用一个文字编辑器修改脚本里的 ssh 变量并用 chmod 改一下文件权限<br /><code>chmod u+x tunnel.sh</code><br />创建连接<br />在终端中执行脚本，执行后可以关闭终端。</p>\n<p> </p>\n<p align=\"center\"><img></p>\n<p></p>\n<p> 关闭连接<br />再次在终端中执行脚本并关闭 Firefox (如果 Firefox 还在用隧道的话，连接暂时无法关闭)</p>\n<p></p>\n<p align=\"center\"> <img></p>\n<p></p>\n<p>用 SSH 密钥进行授权<br />你或许注意到了… 以上脚本里没有任何地方可以写下你的 SSH 密码。这就是因为我在用 SSH 密钥来进行电脑与服务器的授权工作，这样更自动化而且比将密码直接写入文本的文件里要安全多了。先打开一个终端，根据一下步骤进行密钥配置:<br /> <code>[jonolumb@jonoxps .ssh]# ssh-keygen -t rsa<br />Generating public/private rsa key pair.<br />Enter file in which to save the key (/home/jonolumb/.ssh/id_rsa):<br />Enter passphrase (empty for no passphrase):<br /> Enter same passphrase again:<br />Your identification has been saved in /home/jonolumb/.ssh/id_rsa<br />Your public key has been saved in /home/jonolumb/.ssh/id_rsa.pub<br />The key fingerprint is:<br />h7:10:49:46:ab:2t:3b:a3:36:2z:15:56:d4:f2:b7:3d jonolumb@jonoxps</code><br /> 请注意，配置时密码要留为空白。</p>\n<p></p>\n<p>将生成的 /home/jonolumb/.ssh/id_rsa.pub 的内容复制到远程服务器目录下，具体位置是:<br /> ~/.ssh/authorized_keys<br />要保证远程的 authorized_keys 和 本地的 id_rsa 文件的权限均为 700。<br />这样就可以自动登录到远程服务器了。</p>\n<p></p>\n<p> 配置 Firefox 使用代理<br />创建了 SSH 隧道之后，就进入 Firefox 并打开:<br /><code>首选项 �> 高级 �> 连接设置</code><br />选择&#8221;手动配置代理&#8221;并将其设定为:<br />HTTP 代理: localhost 端口: 9999</p>\n<p> </p>\n<p align=\"center\"><img></p>\n<p></p>\n<p> 如果你用这个脚本遇到什么问题，请跟我取得联系。我很想听你们的意见。谢谢！</p>\n<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://18904.com/archives/6874.html\">http://18904.com/archives/6874.html</a></p>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\" https://mycdt0.info\"> https://mycdt0.info</a>，穿墙访问《中国数字时代》（当看到“此网站的安全证书有问题”的提示时，请选择“继续浏览此网站(不推荐)”，忽略证书警告并继续访问网站）。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-3170976949597811495?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=2ea93c5b7b\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/msuvD\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[7775,8795]}