{"id":250884,"link":"https://chinadigitaltimes.net/chinese/2012/09/翻墙-vps建立只能tcp转发的ssh账号只有代理权限/","date":"2012-09-09T14:30:10Z","modified":"2012-09-09T14:30:10Z","title":"翻墙 | VPS建立只能TCP转发的SSH账号(只有代理权限)","content":"<p><p>为了满足“翻墙”的需要，在国外的Linux主机上（比如 DreamHost ）上建个可 ssh登录的用户，使用 ssh 的 Tunnel 来作代理是十分常见的方法。</p>\n<p> 但是主人往往又想最小化用户权限，以避免对系统造成影响。最简单的办法就是，禁止用户登录。</p>\n<p>其实 ssh 可以连接到 sshd 但是不执行远程命令（默认是启动用户设定的 shell ），使用 -N 参数即可。</p>\n<p> 在服务器上建一个 username ：<br />添加用户：useradd -s /bin/false username，将用户的shell设置成/bin/false。这样用户就无法与系统进行交互。<br />设置密码：passwd username</p>\n<p>当然对已有的用户也可以更改用户权限为只能tcp转发：<br /> usermod -s /bin/false USERNAME</p>\n<p>也可以使用 /usr/bin/passwd 作为用户的 shell ，这样用户就可以通过登录而来自主修改密码。需要注意的是，需要将 /usr/bin/passwd 这一行写进 /etc/shells文件。<br /> sshd 认证通后之后，会检查设定的 shell 是否登记在 /etc/shells 文件中，若已经登记，则fork自己，然后fork出来的子进程再exec 设定的 shell 。而 ssh 的 -N 参数，则是告诉 sshd 不需要执行 shell。</p>\n<p>建立Tunnel：</p>\n<p>ssh -D 1080 -qfnN username@hostname</p>\n<p>输入密码即可使用（也可以用key认证）。</p>\n<p>Windows的话，可以使用plink.exe或者MyEnTunnel（MyEnTunnel 本质上也是使用plink.exe来建立Tunnel）。</p>\n<p> 此时账号username 可以通过sshd的认证使用 TcpForwarding ，但是不能运行 shell，不能与系统交互。刚好可以用来为朋友提供国外的代理翻墙。</p>\n<p>参数详解：<br />-D 1080 建立动态Tunnel，监听在本地1080端口。<br />-q 安静模式。<br /> -f ssh在后台运行，即认证之后，ssh退居后台。<br />-n 将 stdio 重定向到 /dev/null，与-f配合使用。<br />-N 不运行远程程序。即通知 sshd 不运行设定的 shell。</p>\n<p><span>声明:</span> 本文采用 <a rel=\"nofollow\" target=\"_blank\" href=\"http://creativecommons.org/licenses/by-nc-sa/3.0/\" title=\"署名-非商业性使用-相同方式共享\">BY-NC-SA</a> 协议进行授权 | <a rel=\"nofollow\" target=\"_blank\" href=\"http://52hp.info/\">hiccap的领地</a><br /> 转载请注明转自《<a rel=\"nofollow\" title=\"VPS建立只能TCP转发的SSH账号(只有代理权限)\" target=\"_blank\" href=\"http://52hp.info/net/140.html\">VPS建立只能TCP转发的SSH账号(只有代理权限)</a>》</p>\n<p> 原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://52hp.info/net/140.html\">http://52hp.info/net/140.html</a></p>\n<div>获取最新穿墙软件？请发电邮（最好用gmail）到：cdtcaonima@gmail.com。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-7226977593271739149?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n<a href=\"http://eepurl.com/mstlf\">墙外新闻实时更新 欢迎订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[8795,8817]}