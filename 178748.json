{"id":178748,"link":"https://chinadigitaltimes.net/chinese/2011/09/翻墙-一个用来把gfwlist里网址转换成ip的脚本/","date":"2011-09-12T09:30:39Z","modified":"2011-09-12T09:30:39Z","title":"翻墙 | 一个用来把gfwList里网址转换成IP的脚本","content":"<p><p>来源：<a rel=\"nofollow\" target=\"_blank\" href=\"http://blog.csdn.net/lzsdc/article/details/6765767\">http://blog.csdn.net/lzsdc/article/details/6765767</a> </p>\n<div>\n<div>\n<div>\n<div>\n<p>欢迎访问墙外站：<a rel=\"nofollow\" target=\"_blank\" href=\"http://lzsblog.appspot.com/?p=291001\">http://lzsblog.appspot.com/?p=291001</a></p>\n<p>ZZJ于8月17日提出用gfwList的网址通过可信的DNS转换成IP，写入hosts文件进而实现翻墙的方法。鄙人通过Python脚本进行了实现。代码丑陋望大牛指教。</p>\n</p>\n<pre>import sys,DNS,base64  def splitList(txt): \tarr = txt.split(\"n\") \t \tl = [] \tfor line in arr: \t\tif (not len(line)): #empty line \t\t\tcontinue \t\tif (line[0] == \"!\"): #Comment line \t\t\tcontinue \t\telif(line[0:2] ==\"@@\"):#Forbidding line \t\t\tcontinue \t\telif(line.find(\"/\")!=-1 or line.find(\"*\")!=-1): #URL is ignored, only domains left \t\t\tcontinue \t\t \t\t#In this case, domain name is irrelevant to protocol(http or https) \t\telif(line[0:2] ==\"||\"): \t\t\tl.append(line[2:]) \t\telif(line[0] == \".\"): \t\t\tl.append(line[1:]) \t\telse: \t\t\tl.append(line) \t \treturn l \t \t  #Decode and decorate the input string f = open(\"gfwlist.txt\",\"r\") txt = f.read().replace(\"n\",\"\") txt = base64.decodestring(txt)  domains = splitList(txt)  #Set default DNS server DNSServer=[&#39;8.8.8.8&#39;] DNS.defaults[&#39;server&#39;]=DNSServer  DNS.DiscoverNameServers()  #These two varible are used to track the percentage of parsing process. l = 0 a = len(domains)  for line in domains: \trequest=DNS.Request() \ttry: \t\tresult=request.req(name=line,qtype=\"A\") \texcept DNS.Base.DNSError: \t\tmsg=line+\"tTime Outn\" \telse: \t\tif not len(result.answers): \t\t\tmsg=line+\"tNo recordn\" \t\telse: \t\t\tmsg=line+ \"tBingon\" \t\t\tprint line + \" \" + result.answers[0][\"data\"] \tprint >> sys.stderr, line + msg, l*1.0/a, \"%\"</pre>\n</p>\n<p>代码文件:<a rel=\"nofollow\" target=\"_blank\" href=\"http://lzsblog.appspot.com/media/agdsenNibG9ncg0LEgVNZWRpYRjy-BEM/makeIP.py\">makeIP.py</a>（墙外）</p>\n<p>文中使用了模块pyDNS,这一非标准模块需要到<a rel=\"nofollow\" target=\"_blank\" href=\"http://pydns.sourceforge.net/\">http://pydns.sourceforge.net/</a>下载。</p>\n<p>解压后安装，python setup.py install。</p>\n<p>然后运行程序，只需要将标准输出重定向到指定文件即可。python makeIP.py > hosts</p>\n<p>接一句Fvck GFW</p>\n<p>PS:21:51更新，增加了过滤CNAME记录的功能，解决有跳转网站的解析问题，请下载最新的代码文件</p>\n</p>\n<div>作者：lzsdc 发表于2011-9-10 13:25:19 <a rel=\"nofollow\" target=\"_blank\" href=\"http://blog.csdn.net/lzsdc/article/details/6765767\">原文链接</a> </div>\n</div>\n</div>\n</div>\n</div>\n<p>  <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gocomments/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/godelicious/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/delicious/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gofacebook/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/facebook/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gotwitter/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/twitter/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/gostumble/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/stumble/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/godigg/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/digg/xijie.wordpress.com/5064/\" /></a> <a rel=\"nofollow\" target=\"_blank\" href=\"http://feeds.wordpress.com/1.0/goreddit/xijie.wordpress.com/5064/\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/reddit/xijie.wordpress.com/5064/\" /></a> <img alt=\"\" border=\"0\" height=\"1\" src=\"http://stats.wordpress.com/b.gif?host=xijie.wordpress.com&#038;blog=10068099&#038;post=5064&#038;subd=xijie&#038;ref=&#038;feed=1\" width=\"1\" /></p>\n<p><img src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/5064/\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=738338\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"738338\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":983,"categories":[15300],"tags":[7775,8795]}