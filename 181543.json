{"id":181543,"link":"https://chinadigitaltimes.net/chinese/2011/09/阮一峰-curl网站开发指南/","date":"2011-09-26T03:30:41Z","modified":"2011-09-26T03:30:41Z","title":"阮一峰 | curl网站开发指南","content":"<p><p>我一向以为，<a rel=\"nofollow\" href=\"http://curl.haxx.se/\">curl</a>只是一个编程用的函数库。</p>\n<p>最近才发现，这个命令本身，就是一个无比有用的网站开发工具，请看我整理的它的用法。</p>\n<p>===================================</p>\n<p><strong>curl网站开发指南</strong></p>\n<p>阮一峰 整理</p>\n<p><img src=\"http://image.beekka.com/blog/201109/bg2011090401.png\" /></p>\n<p><a rel=\"nofollow\" href=\"http://curl.haxx.se/\">curl</a>是一种命令行工具，作用是发出网络请求，然后得到和提取数据，显示在&#8221;标准输出&#8221;（stdout）上面。</p>\n<p>它支持多种协议，下面举例讲解如何将它用于网站开发。</p>\n<p><strong>一、查看网页源码</strong></p>\n<p>直接在curl命令后加上网址，就可以看到网页源码。我们以网址www.sina.com为例（选择该网址，主要因为它的网页代码较短）：</p>\n<blockquote>\n<p>　　curl www.sina.com</p>\n</blockquote>\n<blockquote>\n<p>　　<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"><br />\n　　<html><head><br />\n　　<title>301 Moved Permanently</title><br />\n　　</head><body><br />\n　　</p>\n<h1>Moved Permanently</h1>\n<p>\n　　</p>\n<p>The document has moved <a href=\"http://www.sina.com.cn/\">here</a>.</p>\n<p>\n　　</body></html></p>\n</blockquote>\n<p>如果要把这个网页保存下来，可以使用-o参数，这就相当于使用wget命令了。</p>\n<blockquote>\n<p>　　curl -o [文件名] www.sina.com</p>\n</blockquote>\n<p><strong>二、自动跳转</strong></p>\n<p>有的网址是自动跳转的。使用-L参数，curl就会跳转到新的网址。</p>\n<blockquote>\n<p>　　curl -L www.sina.com</p>\n</blockquote>\n<p>键入上面的命令，结果就自动跳转为www.sina.com.cn。</p>\n<p><strong>三、显示头信息</strong></p>\n<p>-i参数可以显示http response的头信息，连同网页代码一起。</p>\n<blockquote>\n<p>　　curl -i www.sina.com</p>\n</blockquote>\n<blockquote>\n<p>　　HTTP/1.0 301 Moved Permanently<br />\n　　Date: Sat, 03 Sep 2011 23:44:10 GMT<br />\n　　Server: Apache/2.0.54 (Unix)<br />\n　　Location: http://www.sina.com.cn/<br />\n　　Cache-Control: max-age=3600<br />\n　　Expires: Sun, 04 Sep 2011 00:44:10 GMT<br />\n　　Vary: Accept-Encoding<br />\n　　Content-Length: 231<br />\n　　Content-Type: text/html; charset=iso-8859-1<br />\n　　Age: 3239<br />\n　　X-Cache: HIT from sh201-9.sina.com.cn<br />\n　　Connection: close</p>\n<p>　　<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"><br />\n　　<html><head><br />\n　　<title>301 Moved Permanently</title><br />\n　　</head><body><br />\n　　</p>\n<h1>Moved Permanently</h1>\n<p>\n　　</p>\n<p>The document has moved <a href=\"http://www.sina.com.cn/\">here</a>.</p>\n<p>\n　　</body></html></p>\n</blockquote>\n<p>-I参数则是只显示http response的头信息。</p>\n<p><strong>四、显示通信过程</strong></p>\n<p>-v参数可以显示一次http通信的整个过程，包括端口连接和http request头信息。</p>\n<blockquote>\n<p>　　curl -v www.sina.com</p>\n</blockquote>\n<blockquote>\n<p>　　* About to connect() to www.sina.com port 80 (#0)<br />\n　　*   Trying 61.172.201.195&#8230; connected<br />\n　　* Connected to www.sina.com (61.172.201.195) port 80 (#0)<br />\n　　> GET / HTTP/1.1<br />\n　　> User-Agent: curl/7.21.3 (i686-pc-linux-gnu) libcurl/7.21.3 OpenSSL/0.9.8o zlib/1.2.3.4 libidn/1.18<br />\n　　> Host: www.sina.com<br />\n　　> Accept: */*<br />\n　　> <br />\n　　* HTTP 1.0, assume close after body<br />\n　　< HTTP/1.0 301 Moved Permanently<br />\n　　< Date: Sun, 04 Sep 2011 00:42:39 GMT<br />\n　　< Server: Apache/2.0.54 (Unix)<br />\n　　< Location: http://www.sina.com.cn/<br />\n　　< Cache-Control: max-age=3600<br />\n　　< Expires: Sun, 04 Sep 2011 01:42:39 GMT<br />\n　　< Vary: Accept-Encoding<br />\n　　< Content-Length: 231<br />\n　　< Content-Type: text/html; charset=iso-8859-1<br />\n　　< X-Cache: MISS from sh201-19.sina.com.cn<br />\n　　< Connection: close<br />\n　　< <br />\n　　<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"><br />\n　　<html><head><br />\n　　<title>301 Moved Permanently</title><br />\n　　</head><body><br />\n　　</p>\n<h1>Moved Permanently</h1>\n<p>\n　　</p>\n<p>The document has moved <a href=\"http://www.sina.com.cn/\">here</a>.</p>\n<p>\n　　</body></html><br />\n　　* Closing connection #0</p>\n</blockquote>\n<p>如果你觉得上面的信息还不够，那么下面的命令可以查看更详细的通信过程。</p>\n<blockquote>\n<p>　　curl &#8211;trace output.txt www.sina.com</p>\n</blockquote>\n<p>或者</p>\n<blockquote>\n<p>　　curl &#8211;trace-ascii output.txt www.sina.com</p>\n</blockquote>\n<p>运行后，请打开output.txt文件查看。</p>\n<p><strong>五、发送表单信息</strong></p>\n<p>发送表单信息有GET和POST两种方法。GET方法相对简单，只要把数据附在网址后面就行。</p>\n<blockquote>\n<p>　　curl example.com/form.cgi?data=xxx</p>\n</blockquote>\n<p>POST方法必须把数据和网址分开，curl就要用到&#8211;data参数。</p>\n<blockquote>\n<p>　　curl &#8211;data &#8220;data=xxx&#8221; example.com/form.cgi</p>\n</blockquote>\n<p>如果你的数据没有经过表单编码，还可以让curl为你编码，参数是&#8211;data-urlencode。</p>\n<blockquote>\n<p>　　curl &#8211;data-urlencode &#8220;date=April 1&#8221; example.com/form.cgi</p>\n</blockquote>\n<p><strong>六、文件上传</strong></p>\n<p>假定文件上传的表单是下面这样：</p>\n<blockquote>\n<p>　　</p>\n<form method=\"POST\" enctype=&#39;multipart/form-data&#39; action=\"upload.cgi\">\n　　　　<input type=file name=upload><br />\n　　　　<input type=submit name=press value=\"OK\"><br />\n　　</form>\n</p>\n</blockquote>\n<p>你可以用curl这样上传文件：</p>\n<blockquote>\n<p>　　curl &#8211;form upload=@localfilename &#8211;form press=OK [URL]</p>\n</blockquote>\n<p><strong>七、Referer字段</strong></p>\n<p>有时你需要在http request头信息中，提供一个referer字段，表示你是从哪里跳转过来的。</p>\n<blockquote>\n<p>　　curl &#8211;referer http://www.example.com http://www.example.com</p>\n</blockquote>\n<p><strong>八、User Agent字段</strong></p>\n<p>这个字段是用来表示客户端的设备信息。服务器有时会根据这个字段，针对不同设备，返回不同格式的网页，比如手机版和桌面版。</p>\n<p>iPhone4的User Agent是</p>\n<blockquote>\n<p>　　Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A293 Safari/6531.22.7</p>\n</blockquote>\n<p>curl可以这样模拟：</p>\n<blockquote>\n<p>　　curl &#8211;user-agent &#8220;[User Agent]&#8221; [URL]</p>\n</blockquote>\n<p><strong>九、cookie</strong></p>\n<p>使用&#8211;cookie参数，可以让curl发送cookie。</p>\n<blockquote>\n<p>　　curl &#8211;cookie &#8220;name=xxx&#8221; www.example.com</p>\n</blockquote>\n<p>至于具体的cookie的值，可以从http response头信息的Set-Cookie字段中得到。</p>\n<p><strong>十、增加头信息</strong></p>\n<p>有时需要在http request之中，自行增加一个头信息。&#8211;header参数就可以起到这个作用。</p>\n<blockquote>\n<p>　　curl &#8211;header &#8220;xxx: xxxxxx&#8221; http://example.com</p>\n</blockquote>\n<p><strong>十一、HTTP认证</strong></p>\n<p>有些网域需要HTTP认证，这时curl需要用到&#8211;user参数。</p>\n<blockquote>\n<p>　　curl &#8211;user name:password example.com</p>\n</blockquote>\n<p><strong>【参考资料】</strong></p>\n<p>　　* <a rel=\"nofollow\" href=\"http://curl.haxx.se/docs/httpscripting.html\">Using cURL to automate HTTP jobs</a></p>\n<p>　　* <a rel=\"nofollow\" href=\"http://bbs.et8.net/bbs/showthread.php?t=568472\">教你学用CURL</a></p>\n<p>（完）\n </p>\n<div>\n<h3>文档信息</h3>\n<ul>\n<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a rel=\"nofollow\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">Creative Commons BY-NC-ND 3.0</a></li>\n<li>原文网址：<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/09/curl.html\">http://www.ruanyifeng.com/blog/2011/09/curl.html</a></li>\n<li>最后修改时间：2011年9月 4日 11:37</li>\n<li>付费支持（<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/05/my_google_adsense_is_disabled.html\">说明</a>）：<a rel=\"nofollow\" href=\"https://lab.alipay.com/p.htm?id=2011081500435188\"><img alt=\"支付宝担保交易\" src=\"http://chinadigitaltimes.net/chinese/files/2011/09/3a976ef2rmb_32.png.png\" /></a> | <a rel=\"nofollow\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&#038;business=yifeng.ruan@gmail.com&#038;currency_code=USD&#038;amount=0.3&#038;return=http://www.ruanyifeng.com/thank.html&#038;item_name=Ruan%20YiFeng's%20Blog&#038;undefined_quantity=1&#038;no_note=0\"><img alt=\"paypal\" src=\"http://chinadigitaltimes.net/chinese/files/2011/09/5ca83e43dollar_32.png.png\" /></a> </li>\n</ul>\n</div>\n<div>\n<p><a rel=\"nofollow\" href=\"http://www.nanrenwa.com/click/go/ruanyifeng.banner.feed.yfblogfeed/gift\"><img src=\"http://nanrenwa.com/_img/a/2011/yfblog_feed.png\" /></a></p>\n</div>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2011/09/7320ea40g2011090401.png-150x97.png\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=738338\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"738338\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":991,"categories":[9203],"tags":[9400]}