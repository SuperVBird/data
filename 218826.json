{"id":218826,"link":"https://chinadigitaltimes.net/chinese/2012/04/阮一峰-基于用户投票的排名算法（六）：贝叶斯/","date":"2012-04-01T19:19:32Z","modified":"2012-04-01T19:19:32Z","title":"阮一峰 | 基于用户投票的排名算法（六）：贝叶斯平均","content":"<p><p>（这个系列实在拖得太久，今天是最后一篇。）</p>\n<p>上一篇介绍了<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_wilson_score_interval.html\">&#8220;威尔逊区间&#8221;</a>，它解决了投票人数过少、导致结果不可信的问题。</p>\n<p>举例来说，如果只有2个人投票，&#8221;威尔逊区间&#8221;的下限值会将赞成票的比例大幅拉低。这样做固然保证了排名的可信性，但也带来了另一个问题：排行榜前列总是那些票数最多的项目，新项目或者冷门的项目，很难有出头机会，排名可能会长期靠后。</p>\n<p>以<a rel=\"nofollow\" href=\"http://www.imdb.com/\">IMDB</a>为例，它是世界最大的电影数据库，观众可以对每部电影投票，最低为1分，最高为10分。</p>\n<p><a rel=\"nofollow\" href=\"http://www.imdb.com/\"><img src=\"http://image.beekka.com/blog/201203/bg2012032801.jpg\" /></a></p>\n<p>系统根据投票结果，计算出每部电影的平均得分。然后，再根据平均得分，排出最受欢迎的<a rel=\"nofollow\" href=\"http://www.imdb.com/chart/top\">前250名</a>的电影。</p>\n<p><a rel=\"nofollow\" href=\"http://www.imdb.com/chart/top\"><img src=\"http://image.beekka.com/blog/201203/bg2012032802.png\" /></a></p>\n<p>这里就有一个问题：热门电影与冷门电影的平均得分，是否真的可比？举例来说，一部好莱坞大片有10000个观众投票，一部小成本的文艺片只有100个观众投票。这两者的投票结果，怎么比较？如果使用&#8221;威尔逊区间&#8221;，后者的得分将被大幅拉低，这样处理是否公平，能不能反映它们真正的质量？</p>\n<p>一个合理的思路是，如果要比较两部电影的好坏，至少应该请同样多的观众观看和评分。既然文艺片的观众人数偏少，那么应该设法为它增加一些观众。</p>\n<p>在<a rel=\"nofollow\" href=\"http://www.imdb.com/chart/top\">排名页面</a>的底部，IMDB给出了它的计算方法。</p>\n<blockquote>\n<p>　　<img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=WR%3D%5Cfrac%7Bv%7D%7Bv%2Bm%7DR%2B%5Cfrac%7Bm%7D%7Bv%2Bm%7DC&#038;chs=60\" /></p>\n<p>　　- WR， 加权得分（weighted rating）。<br />　　- R，该电影的用户投票的平均得分（Rating）。<br />　　- v，该电影的投票人数（votes）。<br />　　- m，排名前250名的电影的最低投票数（现在为3000）。<br />　　- C， 所有电影的平均得分（现在为6.9）。 </p>\n</blockquote>\n<p>仔细研究这个公式，你会发现，IMDB为每部电影增加了3000张选票，并且这些选票的评分都为6.9。这样做的原因是，假设所有电影都至少有3000张选票，那么就都具备了进入前250名的评选条件；然后假设这3000张选票的评分是所有电影的平均得分（即假设这部电影具有平均水准）；最后，用现有的观众投票进行修正，长期来看，v/(v+m)这部分的权重将越来越大，得分将慢慢接近真实情况。</p>\n<p>这样做拉近了不同电影之间投票人数的差异，使得投票人数较少的电影也有可能排名前列。</p>\n<p>把这个公式写成更一般的形式：</p>\n<blockquote>\n<p>　　<img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=%5Cbar%7Bx%7D%3D%5Cfrac%7BC%5Ctimes%20m%2B%5CSigma%20%5E%7Bn%7D_%7Bi%3D1%7Dx_%7Bi%7D%7D%7Bn%2BC%7D&#038;chs=80\" /></p>\n<p>　　- C，投票人数扩展的规模，是一个自行设定的常数，与整个网站的总体用户人数有关，可以等于每个项目的平均投票数。<br />　　- n，该项目的现有投票人数。<br />　　- x，该项目的每张选票的值。<br />　　- m，总体平均分，即整个网站所有选票的算术平均值。 </p>\n</blockquote>\n<p>这种算法被称为<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Bayesian_average\">&#8220;贝叶斯平均&#8221;</a>（Bayesian average）。因为某种程度上，它借鉴了<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_one.html\">&#8220;贝叶斯推断&#8221;</a>（Bayesian inference）的思想：既然不知道投票结果，那就先估计一个值，然后不断用新的信息修正，使得它越来越接近正确的值。</p>\n<p>在这个公式中，m（总体平均分）是&#8221;先验概率&#8221;，每一次新的投票都是一个调整因子，使总体平均分不断向该项目的真实投票结果靠近。投票人数越多，该项目的&#8221;贝叶斯平均&#8221;就越接近算术平均，对排名的影响就越小。</p>\n<p>因此，这种方法可以给一些投票人数较少的项目，以相对公平的排名。</p>\n<p>=================================================</p>\n<p>&#8220;贝叶斯平均&#8221;也有缺点，主要问题是它假设用户的投票是正态分布。比如，电影A有10个观众评分，5个为五星，5个为一星；电影B也有10个观众评分，都给了三星。这两部电影的平均得分（无论是算术平均，还是贝叶斯平均）都是三星，但是电影A可能比电影B更值得看。</p>\n<p>解决这个问题的思路是，假定每个用户的投票都是独立事件，每次投票只有n个选项可以选择，那么这就服从<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Multinomial_distribution\">&#8220;多项分布&#8221;</a>（Multinomial distribution），就可以结合贝叶斯定理，计算该分布的期望值。由于这涉及复杂的统计学知识，这里就不深入了，感兴趣的朋友可以继续阅读William Morgan的<em><a rel=\"nofollow\" href=\"http://masanjin.net/blog/how-to-rank-products-based-on-user-input\">How to rank products based on user input</a></em>。</p>\n<p>（完）</p>\n<div>\n<h3>文档信息</h3>\n<ul>\n<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a rel=\"nofollow\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">Creative Commons BY-NC-ND 3.0</a></li>\n<li>原文网址：<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_bayesian_average.html\">http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_bayesian_average.html</a></li>\n<li>最后修改时间：2012年3月28日 19:48</li>\n<li>付费支持：<a rel=\"nofollow\" href=\"https://mai.alipay.com/p.htm?id=2012010602227616\"><img alt=\"支付宝担保交易\" src=\"http://www.ruanyifeng.com/blog/images/rmb_32.png\" /></a> | <a rel=\"nofollow\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&#038;business=yifeng.ruan@gmail.com&#038;currency_code=USD&#038;amount=2.99&#038;return=http://www.ruanyifeng.com/thank.html&#038;item_name=Ruan%20YiFeng's%20Blog&#038;undefined_quantity=1&#038;no_note=0\"><img alt=\"paypal\" src=\"http://www.ruanyifeng.com/blog/images/dollar_32.png\" /></a> </li>\n</ul>\n</div>\n<div>\n<p><a rel=\"nofollow\" href=\"http://yipinzao.com/\"><img src=\"http://www.ruanyifeng.com/blog/images/ad_yipinzao.jpg\" /></a></p>\n</div>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2012/04/feacbb28g2012032801.jpg-150x150.jpg\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"450\" height=\"309\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":1004,"categories":[9203],"tags":[9400]}