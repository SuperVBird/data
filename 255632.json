{"id":255632,"link":"https://chinadigitaltimes.net/chinese/2012/10/编程随想-博客的评论功能升级，顺便分享一下实/","date":"2012-10-09T00:30:22Z","modified":"2012-10-09T22:34:53Z","title":"编程随想 | 博客的评论功能升级，顺便分享一下实现方法","content":"<p><h2>★广而告之</h2>\n<p>　　最近一年来，翻墙到俺博客留言的读者日渐增多。留言多了之后， Blogger / BlogSpot 平台的评论功能就越发显得老土了。这个周末，俺痛下决心，把默认的评论功能彻底改造一下。这番改造，主要增加了如下功能：<br /><b>1. 增加嵌套评论的功能</b><br />通过嵌套评论，直接回复前几楼的留言就方便了。<br />由于 Blogger / BlogSpot 平台在功能上仅支持两层嵌套。所以，目前俺还搞不出多层嵌套。</p>\n<p><b>2. 增加楼层数的显示</b><br />类似 BBS 论坛的效果（目前不支持 IE 8 之前的版本）。</p>\n<p><b>3. 增加评论者的头像</b><br />如果登录过 Gmail 或 OpenID，会显示用户的头像。对于匿名用户，显示默认头像。</p>\n<p><b>4. 评论支持 BBCode 语法</b><br />可以在评论中使用常见的几种 BBCode 语法，目前支持如下几种：</p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\n<tr>\n<td>超链接</td>\n<td>url网址/url</td>\n</tr>\n<tr>\n<td>带标题的超链接</td>\n<td>url=网址标题/url</td>\n</tr>\n<tr>\n<td>图片</td>\n<td>img图片的网址/img</td>\n</tr>\n<tr>\n<td>粗体文字</td>\n<td>b加粗的文字/b</td>\n</tr>\n</table>\n<p>关于 BBCode 的更多介绍，请看&#8221;<a rel=\"nofollow\" href=\"http://zh.wikipedia.org/wiki/BBCode\">这里</a>&#8220;。</p>\n<p><b>5. 调整了背景颜色和边框</b><br />主要是为了看起来爽一点。</p>\n<p>　　针对上述新功能，欢迎大伙儿多提意见和建议，便于俺改进（点&#8221;<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2012/09/custom-blogger-comment.html#comments\">这里</a>&#8220;发表你的高见）。<br />　　下面是改造后的评论功能截图，如果你的浏览器看到的效果有差异，敬请告知你的浏览器版本。</p>\n<p><img src=\"http://lh5.googleusercontent.com/jAtB5-K0PTdgslIj6TsdaGTKYSHAuHmNvvQfW0v_X4VHs6wXfZULjnV6ccLyk5k3yc6XfUHtXLoYEW5_Zxwh7AkZVGTxqZ8RTMWAs6l1vAU7BStzPQ\" alt=\"不见图 请翻墙\" border=\"1\" /></p>\n<p>　　接下来，俺分享一下具体的实现方式，希望对其他 Blogger / BlogSpot 上的博主有帮助。如果你没有在 Blogger / BlogSpot 上开博客，那后面的内容就无需再看了。</p>\n<p>================华丽的分割线================</p>\n<h2>★如何实现&#8221;嵌套评论&#8221;？</h2>\n<p>简介：<br />嵌套评论功能由于涉及到后端，需要 Blogger / BlogSpot 平台的支持才有可能实现。幸运的是，Blogger / BlogSpot 平台在今年开始提供&#8221;嵌套评论&#8221;的功能。<br />由于平台提供支持，只需要简单修改一下模板即可实现。</p>\n<p>步骤：<br />首先，进入 Blogger 的后台管理界面，点左边菜单上的 &#8220;模板&#8221; 按钮。<br />出现模板管理界面后，再点 &#8220;修改HTML&#8221; 按钮。<br />出现一个对话框，点 &#8220;继续&#8221; 按钮。<br />然后勾选 &#8220;扩展窗口小部件模板 &#8220;。<br />此时，你就可以看到模板的编辑界面了。<br /><b>为了保险起见，在编辑之前先备份一下模板。</b></p>\n<p>在模板中找到如下代码：</p>\n<blockquote><p><b:if cond=&#39;data:blog.pageType == &quot;item&quot;&#39;><br />  <b:include data=&#39;post&#39; name=&#39;comments&#39;/><br /></b:if></p></blockquote>\n<p>修改为如下：</p>\n<blockquote><p><b:if cond=&#39;data:blog.pageType == &quot;item&quot;&#39;><br />  <b:if cond=&#39;data:post.showThreadedComments&#39;><br />    <b:include data=&#39;post&#39; name=&#39;threaded_comments&#39;/><br />  <b:else/><br />    <b:include data=&#39;post&#39; name=&#39;comments&#39;/><br />  </b:if><br /></b:if></p></blockquote>\n<p>最后点 &#8220;保存&#8221; 按钮。<br />如果不出意外，你的博客就有嵌套评论功能了。</p>\n<h2>★如何添加楼层数？</h2>\n<p>添加评论的楼层数，有很多种方法。比较简单的有如下两种。</p>\n<h3>◇使用 JavaScript 显示楼层号</h3>\n<p>简介：<br />直接在模板中嵌入 JS 代码。利用模板中的 loop 循环，递增楼层号并显示。</p>\n<p>优点：<br />支持各种浏览器</p>\n<p>缺点，<br />适合用于传统的评论界面。对于新的嵌套评论界面，需要对模板进行大改，比较难搞。</p>\n<p>步骤：<br />根据刚才介绍过的步骤，进入模板编辑界面。<br /><b>为了保险起见，在编辑之前先备份一下模板。</b></p>\n<p>在模板中找到如下代码：</p>\n<blockquote><p><b:loop values=&#39;data:post.comments&#39; var=&#39;comment&#39;></p></blockquote>\n<p>修改为如下：</p>\n<blockquote><p><script type=&#39;text/javascript&#39;>nCommentIndex = 1;</script><br /><b:loop values=&#39;data:post.comments&#39; var=&#39;comment&#39;><br />  <span class=&#39;comment-index&#39;><br />    <script type=&#39;text/javascript&#39;>document.write(&#39;第&#39;+nCommentIndex+&#39;楼&#39;); nCommentIndex+=1;</script><br />  </span></p></blockquote>\n<p>最后点 &#8220;保存&#8221; 按钮。<br />如果你想调整楼层号的显示样式，可以在模板的 CSS 代码尾部追加如下代码：<br />（请根据自己的喜好修改下划线部分）</p>\n<blockquote><p>.comment-index <br />  float: <u>浮动靠左还是靠右</u>;<br />  font: <u>用啥字体</u>;<br />  font-size: <u>字体大小</u>;<br />  color: <u>用啥颜色</u>;</p>\n</blockquote>\n<p>全部修改完之后，点 &#8220;保存&#8221; 按钮。</p>\n<h3>◇使用 CSS 显示楼层号</h3>\n<p>简介：<br />利用 CSS 的计数器功能，实现楼层号的递增及显示。</p>\n<p>优点：<br />支持嵌套评论的界面</p>\n<p>缺点：<br />浏览器兼容性不够好（比如 IE6 不支持 CSS 的 content 属性）</p>\n<p>步骤：<br />根据刚才介绍过的步骤，进入模板编辑界面。<br /><b>为了保险起见，在编辑之前先备份一下模板。</b></p>\n<p>在模板代码中，找到 CSS 的那段代码，然后在 CSS 代码的尾部追加如下代码：<br />（以下这2段代码就是俺博客用的，欢迎剽窃）</p>\n<p>这一段用来显示楼层号</p>\n<blockquote><p>.comment-thread ol <br />  counter-reset: comment_counter;</p>\n<p>.comment-thread li:before <br />  content: counter(comment_counter,decimal) &#8220;楼&#8221;;<br />  counter-increment: comment_counter;<br />  float: right;<br />  position: relative;<br />  z-index: 1;<br />  text-align: center;<br />  font-size: 120%;<br />  color: $mainLinkColor;<br />  border: none;<br />  margin-top: 10px;<br />  margin-right: 10px;</p></blockquote>\n<p>这一段用来显示嵌套在某楼层之下的单元号</p>\n<blockquote><p>.comment-thread ol ol <br />  counter-reset: child_comment_counter;</p>\n<p>.comment-thread li li:before <br />  content: counter(comment_counter,decimal) &#8220;楼 &#8221; counter(child_comment_counter,decimal) &#8220;单元&#8221;;<br />  counter-increment: child_comment_counter;<br />  font-size: 100%;</p></blockquote>\n<p>修改完之后，点 &#8220;保存&#8221; 按钮。</p>\n<h2>★如何添加头像？</h2>\n<p>根据刚才介绍过的步骤，进入模板编辑界面。<br /><b>为了保险起见，在编辑之前先备份一下模板。</b></p>\n<p>在模板中找到如下代码：</p>\n<blockquote>\n<dl id=&#39;comments-block&#39;></p></blockquote>\n<p>修改为如下：</p>\n<blockquote>\n<dl expr:class=&#39;data:post.avatarIndentClass&#39; id=&#39;comments-block&#39;></p></blockquote>\n<p>还没完，就在这行代码下方2-3行的地方有如下代码：</p>\n<blockquote><p><a expr:name=&#39;data:comment.anchorName&#39;/></p></blockquote>\n<p>修改为如下：</p>\n<blockquote><p><a expr:name=&#39;data:comment.anchorName&#39;/><br /><b:if cond=&#39;data:blog.enabledCommentProfileImages&#39;><br />  </p>\n<div expr:class=&#39;data:comment.avatarContainerClass&#39;>    <data:comment.authorAvatarImage/><br />  </div>\n<p></b:if></p></blockquote>\n<p>如果你想调整头像的显示尺寸，可以在模板的 CSS 代码尾部追加如下代码：<br />（请根据自己的喜好修改下划线部分）</p>\n<blockquote><p>.comments .avatar-image-container img <br />  width: <u>图像宽度</u>;<br />  height: <u>图像高度</u>;<br />  border: <u>图像边界</u>;</p>\n</blockquote>\n<p>修改完之后，点 &#8220;保存&#8221; 按钮。</p>\n<h2>★结尾</h2>\n<p>　　今天就先介绍到这里。以后如果有空，俺还会继续改进本博客的评论功能。相关的代码也会继续补充到本文中。欢迎其它博主<a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2012/09/custom-blogger-comment.html#comments\">到本文留言</a>，交流经验。</p>\n<p><b>俺博客上，和本文相关的帖子（需翻墙）</b>：<br /><a rel=\"nofollow\" href=\"http://program-think.blogspot.com/2011/11/greasemonkey-scripts-for-google-reader.html\">如何用GreaseMonkey扩展Google Reader</a><img src=\"http://feeds.feedburner.com/~r/programthink/~4/nOaXVHjXW8o\" height=\"1\" width=\"1\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n<a href=\"http://eepurl.com/mstlf\">墙外新闻实时更新 欢迎订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1004,"categories":[18270,18269,20534],"tags":[19192]}