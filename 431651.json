{"id":431651,"link":"https://chinadigitaltimes.net/chinese/2016/03/squidstunnel-翻墙看世界/","date":"2016-03-14T07:38:52Z","modified":"2016-03-14T07:38:52Z","title":"Squid+Stunnel 翻墙看世界","content":"<p><div dir=\"ltr\" trbidi=\"on\">&#26469;&#28304;&#65306;<a href=\"https://staugur.gitbooks.io/saintic/content/blog/28.html\">https://staugur.gitbooks.io/saintic/content/blog/28.html</a></p>\n<p></p>\n<div><a href=\"https://1.bp.blogspot.com/-FqqwSaHO_yE/VuZskaXdXHI/AAAAAAAACp0/CK5clTuVYc4aMm18aDMVhiks98j4E2EVA/s1600/Sticker.png\" imageanchor=\"1\"><img border=\"0\" height=\"364\" src=\"https://1.bp.blogspot.com/-FqqwSaHO_yE/VuZskaXdXHI/AAAAAAAACp0/CK5clTuVYc4aMm18aDMVhiks98j4E2EVA/s640/Sticker.png\" width=\"640\"></a></div>\n<div></div>\n<p></p>\n<div>&#21152;&#23494;&#20195;&#29702;&#21151;&#33021;&#30340;&#23454;&#29616;&#65292;&#36234;&#36807;&#23553;&#38145;&#38480;&#21046;&#65292;&#35775;&#38382;&#34987;&#22681;&#30340;&#22269;&#22806;&#31449;&#28857;&#65292;&#27604;&#22914;Google&#12289;FaceBook&#12290;</div>\n<div>&#19968;&#12289;&#39318;&#20808;&#26159;&#22269;&#22806;&#30340;&#26381;&#21153;&#22120;&#23433;&#35013;squid&#21644;stunnel</div>\n<div>1.&#23433;&#35013;Squid</div>\n<div><code>yum -y install squid</code></div>\n<div>&#20063;&#19981;&#29992;&#20462;&#25913;&#37197;&#32622;&#65292;&#22240;&#20026;&#21333;&#21333;squid&#20195;&#29702;&#26681;&#26412;&#32763;&#19981;&#20102;&#22681;&#65292;&#25152;&#20197;&#38656;&#35201;&#19968;&#20010;&#21152;&#23494;&#30340;&#36890;&#36947;&#65292;stunnel&#65292;&#32780;stunnel&#21482;&#38656;&#35201;&#36830;&#25509;localhost&#30340;squid&#31471;&#21475;&#21363;&#21487;&#12290;</div>\n<div>2.&#23433;&#35013;Stunnel</div>\n<div><code>yum -y install stunnel openssl openssl-devel</code></div>\n<div>&#29983;&#25104;pem&#35777;&#20070;&#65306;</div>\n<pre><code>cd /etc/stunnel/<br>openssl req -new -x509 -days 365 -nodes -out stunnel.pem -keyout stunnel.pem<br>openssl gendh 512&gt;&gt; stunnel.pem #&#35686;&#21578;&#65306;&#36825;&#34892;&#19981;&#26159;&#24517;&#39035;&#30340;<br>useradd -s /sbin/nologin -M stunnel<br></code></pre>\n<div>&#20462;&#25913;/etc/stunnel/stunnel.conf(stunnel&#40664;&#35748;&#30340;&#37197;&#32622;&#25991;&#20214;)&#65292;&#22797;&#21046;&#20197;&#19979;&#20869;&#23481;&#65306;</div>\n<pre><code>cert = /etc/stunnel/stunnel.pem<br>CAfile = /etc/stunnel/stunnel.pem<br>socket = l:TCP_NODELAY=1<br>socket = r:TCP_NODELAY=1<br><br>;;;chroot = /var/run/stunnel<br>pid = /tmp/stunnel.pid<br>verify = 3<br><br>;;; CApath = certs<br>;;; CRLpath = crls<br>;;; CRLfile = crls.pem<br><br>setuid = stunnel<br>setgid = stunnel<br><br>;;; client=yes<br>compression = zlib<br>;;; taskbar = no<br>delay = no<br>;;; failover = rr<br>;;; failover = prio<br>sslVersion = TLSv1<br>;;; fips=no<br><br>debug = 7<br>syslog = no<br>output = stunnel.log<br><br>sproxy<br>accept = 34567<br>connect = 127.0.0.1:3128<br></code></pre>\n<div><span>accept = 34567 &#26159; stunned&#35201;&#30417;&#21548;&#30340;&#31471;&#21475;&#21495;</span></div>\n<div><span>connect = 127.0.0.1:3128 &#26159;Squid&#30340;&#30417;&#21548;&#22320;&#22336;&#21644;&#31471;&#21475;</span></div>\n<div>&#22312;&#21442;&#32771;&#30340;&#21407;&#25991;&#20013; fips=no &#26159;&#26410;&#34987;&#27880;&#37322;&#30340;&#65292;&#20294;&#22312;&#25105;&#26426;&#22120;&#19978;&#27492;&#21442;&#25968;&#23548;&#33268;&#19981;&#33021;&#21551;&#21160;&#65292;&#25152;&#20197;&#25105;&#25165;&#27880;&#37322;&#25481;&#65292;&#22914;&#36935;&#21040;&#26080;&#27861;&#21551;&#21160;&#65292;&#21487;&#21435;&#25481;&#27880;&#37322;&#12290;</div>\n<div>3.&#21551;&#21160;squid&#21644;stunnel</div>\n<pre><code>service squid start<br>stunnel<br></code></pre>\n<div>&#22914;&#26524;&#27809;&#26377;&#38169;&#35823;&#36755;&#20986;&#34920;&#31034;&#37197;&#32622;&#25104;&#21151;&#65292;&#24182;&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#21629;&#20196;&#26597;&#30475;&#26159;&#21542;&#21551;&#21160;&#25104;&#21151;&#12290;</div>\n<pre><code>ps aux | grep -E \"squid|stunnel\"<br>netstat -an | grep &ldquo;LISTEN&rdquo; | grep -E \"squid|stunnel\"<br></code></pre>\n<div>&#20108;&#12289;&#22269;&#20869;&#26381;&#21153;&#22120;&#65306;</div>\n<div>&#21482;&#38656;&#35201;&#23433;&#35013;stunnel(yum -y install stunnel openssl-devel)&#65292;&#23558;&#22269;&#22806;&#26381;&#21153;&#22120;&#29983;&#25104;&#30340;stunnel.pem&#22797;&#21046;&#36807;&#26469;&#65292;&#21807;&#19968;&#30340;&#19981;&#21516;&#22312;&#20110;&#37197;&#32622;&#25991;&#20214;&#20013; sproxy&#37027;&#27573;&#65292;&#32534;&#36753;stunnel.conf&#65306;</div>\n<pre><code>cert = /etc/stunnel/stunnel.pem<br>socket = l:TCP_NODELAY=1<br>socket = r:TCP_NODELAY=1<br>verify = 2<br>CAfile = /etc/stunnel/stunnel.pem<br>client=yes<br>compression = zlib<br>ciphers = AES256-SHA<br>delay = no<br>failover = prio<br>sslVersion = TLSv1<br>;; fips = no<br>sproxy<br>accept  = 0.0.0.0:7071<br>connect = &#22269;&#22806;&#26381;&#21153;&#22120;IP:34567<br></code></pre>\n<div>&#35299;&#37322;&#35828;&#26126;&#65306; accept = 0.0.0.0:7071 &#21363;&#26159;&#29992;&#25143;&#35201;&#35774;&#32622;&#30340;&#31471;&#21475;&#65292; connect = &#22269;&#22806;&#26381;&#21153;&#22120;IP:34567 &#65292;&#21363;&#22269;&#22806;&#26381;&#21153;&#22120;IP&#21644;Stunnel&#30417;&#21548;&#30340;&#31471;&#21475;&#21495;</div>\n<div>&#21551;&#21160;stunnel</div>\n<div><code>stunnel</code></div>\n<div>&#27492;&#26102;&#29992;&#25143;&#36830;&#25509;&#21040;&#22269;&#20869;&#26381;&#21153;&#22120;7071&#20316;&#20026;&#20195;&#29702;&#23601;&#21487;&#20197;&#35775;&#38382;&#19968;&#20123;&#34987;&#22681;&#30340;&#32593;&#31449;&#12290;</div>\n<div>&#22312;&#22269;&#20869;&#27809;&#26377;&#26381;&#21153;&#22120;&#65292;&#21487;&#20197;&#25105;&#22312;&#26412;&#22320;&#23433;&#35013;&#30340;&#19968;&#20010;Stunnel&#65292;&#29992;&#26469;&#21152;&#35299;&#23494;&#65292;&#25152;&#20197;&#27809;&#26377;&#22269;&#20869;&#26381;&#21153;&#20063;&#19981;&#35201;&#32039;&#12290;</div>\n<div>&#21435;stunnel&#23448;&#32593;&#19979;&#36733;&#19968;&#20010;windows&#29256;&#30340;&#23458;&#25143;&#31471;&#65292;&#23558;&#19978;&#38754;&#22269;&#20869;&#26381;&#21153;&#22120;&#30340;stunnel.conf&#37197;&#32622;&#25991;&#20214;&#21644;&#22269;&#22806;&#26381;&#21153;&#22120;stunnel.pem&#35777;&#20070;&#25918;&#21040;stunnel&#23433;&#35013;&#30446;&#24405;/config/&#19979;&#21551;&#21160;&#21363;&#21487;&#12290;</div>\n</div>\n<div>&#32763;&#22681;&#25216;&#26415;&#21338;&#23458;<a href=\"http://www.chinagfw.org/2013/09/blog-post.html\">&#35746;&#38405;&#22320;&#22336;&#21450;&#31038;&#20132;&#24080;&#21495;</a></div>\n</p>\n<p>请点击<a href=\"https://www.evernote.com/pub/cdtchinese/cdt#st=p&#038;n=929d9b6d-42c7-4573-a841-83334e63af45\">这里</a>，穿墙阅读数字时代。</p>\n","author":1005,"categories":[18270,18269,10466,15300],"tags":[7775,30532,30533]}