{"id":161219,"link":"https://chinadigitaltimes.net/chinese/2011/06/如何在vps上开通vpn服务，实现代理翻墙/","date":"2011-06-15T02:30:39Z","modified":"2011-06-15T02:30:39Z","title":"如何在VPS上开通VPN服务，实现代理翻墙","content":"<p><p>来源：<a href=\"http://www.souhosting.com/html/267.html\">http://www.souhosting.com/html/267.html</a></p>\n<p><strong>VPS主机</strong>（”Virtual Private Server”，或简称 “VPS”）是利用虚拟服务器软件在一台物理服务器上创建多个相互隔离的小服务器，每个VPS都有自己独立的操作系统、独立的空间、独立的内存、独立的 CPU资源，能够独立执行程序和独立系统配置，它的运行和管理与独立服务器完全相同。目前网络上比较流行，也是使用范围最广的虚拟化技术主要有两 种：Openvz和Xen。今天主要针对基于这两种虚拟技术的VPS如何开通VPN服务进行介绍。</p>\n<p><strong>一、在基于Xen虚拟技术的VPS上安装PPTPD VPN：</strong></p>\n<p>我们这里介绍给大家一个已经编译好的一键安装包：（已经成功在 <strong><a href=\"http://cp.emsvps.com/page.aspx?c=referral&#038;u=12463\">EmsVps</a> 、<a href=\"http://es.so.cm/page.aspx?c=referral&#038;u=12350\">思悦创新</a>、<a href=\"http://cp.28vps.com/page.aspx?c=referral&#038;u=12469\">28Vps </a></strong>上成功编译，并通过）</p>\n<p><strong>适用系统：</strong>CentOS 5 32bits/64bits</p>\n<p><strong>适用主机类型：</strong>基于Xen虚拟技术的VPS或者Linux服务器</p>\n<p><strong>一键安装包：（直接复制下面的命令，运行）</strong></p>\n<p>安装命令：   wget <a href=\"http://down.vpsma.com/vpn/pptpd.sh;sh\">http://down.vpsma.com/vpn/pptpd.sh;sh</a> ./pptpd.sh;</p>\n<p><strong>安装成功后，</strong><strong>会自动生成vpn账号和密码，如下：</strong></p>\n<p>VPN service is installed, your VPN username is vpn, VPN password is xssww2w</p>\n<p>复制好vpn和密码就可以在电脑上开启vpn上网了！</p>\n<p><strong>如何修改vpn密码或者添加vpn账号：</strong></p>\n<p><strong></strong>编辑文件/etc/ppp/chap-secrets，按照格式改成你自己的就行了：</p>\n<p>编辑命令：vi /etc/ppp/chap-secrets    输入字母 i  ， 按照格式修改用户名和密码。如需添加用户只需按照格式在下一行添加用户名、密码即可。</p>\n<p>保存设置：输入Ctrl+c，退出编辑状态，连续输出两次 C（注意大写），保存设置。</p>\n<p><strong>二、在基于Openvz虚拟技术的VPS上安装PPTPD VPN：</strong></p>\n<p><strong>适用系统：</strong>CentOS 5 32bits/64bits</p>\n<p><strong>适用主机类型：</strong>基于Openvz虚拟技术的VPS或者Linux服务器</p>\n<p>基于Openvz虚拟技术的VPS由于不存在sit0网卡，开通PPTPD VPN上和基于Xen虚拟技术的VPS稍有不同。</p>\n<p>本方法已经在著名的砖头机 <strong><a href=\"https://hostrail.com/aff.php?aff=1322\">HostRail </a></strong>上成功编译通过，<strong><a href=\"https://hostrail.com/aff.php?aff=1322\">HostRail</a></strong>的VPS默认是不开通TUN-TAP的，需要发ticket要求开通，下面有相应介绍。</p>\n<p><strong>安装方法：</strong></p>\n<p><strong>1.首先检查你的vps主机的 TUN-TAP/PPP 有没有启用</strong></p>\n<blockquote>\n<p>cat /dev/net/tun           #直接输出命令</p>\n</blockquote>\n<p>启用的话输出可能5花八门，反正不止一种，比如下面算正常</p>\n<blockquote>\n<p>cat: /dev/net/tun: File descriptor in bad state</p>\n</blockquote>\n<p>没启用的话显示权限不够，被拒绝，没启用显示如下</p>\n<blockquote>\n<p>cat: /dev/net/tun: Permission denied</p>\n</blockquote>\n<p>ppp用下面命令看</p>\n<blockquote>\n<p>cat /dev/ppp    #直接输出命令</p>\n</blockquote>\n<p>有下面输出就是可以！</p>\n<blockquote>\n<p>cat: /dev/ppp: No such device or address</p>\n</blockquote>\n<p>如果没有启用请向你的主机商提交一个ticket要求开通这两个服务，如下：</p>\n<blockquote>\n<p>Hello</p>\n<p>Could you enabled TUN-TAP and PPP for me? I want run pptp-vpn on my VPS.</p>\n<p>Thank you.</p>\n</blockquote>\n<p>开启后确认下可以开始正式安装</p>\n<p><strong>2.升级系统包</strong></p>\n<blockquote>\n<p>yum update -y    #直接输出命令</p>\n</blockquote>\n<p><strong>3.检查是否安装ppp iptables，没有的话进行安装（CentOS是默认安装并开启防火墙的，第2行大可不必执行！）</strong></p>\n<blockquote>\n<p>yum install -y ppp     <br />yum install -y iptables</p>\n<p>在hostrail上安装ppp时，经常会因为内存不足，而出现安装错误，这时我们就可以采用下面的命令进行安装</p>\n<p>yum –disableplugin=fastestmirror install ppp</p>\n</blockquote>\n<p><strong>4.安装pptpd</strong></p>\n<p>推荐下面的安装包，安装请直接复制、运行</p>\n<blockquote>\n<p>rpm -ivh <a href=\"http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.i386.rpm\">http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-2.rhel5.i386.rpm</a></p>\n</blockquote>\n<p><strong>5.配置pptp</strong></p>\n<p>首先我们要编辑/etc/pptpd.conf文件：</p>\n<blockquote>\n<p>vim /etc/pptpd.conf</p>\n</blockquote>\n<p>把下面字段前面的#去掉即可：</p>\n<blockquote>\n<p>localip 192.168.0.1     <br />remoteip 192.168.0.234-238,192.168.0.245</p>\n</blockquote>\n<p>接下来再编辑/etc/ppp/options.pptpd：</p>\n<blockquote>\n<p>vim /etc/ppp/options.pptpd</p>\n</blockquote>\n<p>去掉ms-dns前面的#，并修改成如下字段：</p>\n<blockquote>\n<p>ms-dns 8.8.8.8     <br />ms-dns 8.8.4.4</p>\n</blockquote>\n<p>找到require-mppe-128这行在前面加#，这点很重要。</p>\n<p><strong>6.设置VPN帐号</strong></p>\n<p>编辑/etc/ppp/chap-secrets这个文件：</p>\n<blockquote>\n<p>vim /etc/ppp/chap-secrets</p>\n</blockquote>\n<p>直接输入如下字段,username,password可以换成其他字段：   <br />username pptpd password *</p>\n<p><strong>7.修改内核设置，支持转发</strong></p>\n<p><strong></strong>编辑/etc/sysctl.conf文件：</p>\n<blockquote>\n<p>vim /etc/sysctl.conf</p>\n</blockquote>\n<p>将”net.ipv4.ip_forward”改为1：</p>\n<blockquote>\n<p>net.ipv4.ip_forward=1</p>\n</blockquote>\n<p>同时在”net.ipv4.tcp_syncookies = 1″前面加# ：</p>\n<blockquote>\n<p># net.ipv4.tcp_syncookies = 1</p>\n</blockquote>\n<p>保存退出，并执行下面的命令来生效它：</p>\n<blockquote>\n<p>sysctl -p</p>\n</blockquote>\n<p><strong>8.添加iptables防火墙转发（to-source前面的是两个半角减号！）</strong></p>\n<blockquote>\n<p>iptables -t nat -A POSTROUTING -s <a href=\"http://10.8.0.0/16\">192.168.0.0/16</a> -j SNAT –to-source 你的VPS主机ip</p>\n</blockquote>\n<p>保存iptables转发规则：</p>\n<blockquote>\n<p>/etc/init.d/iptables save</p>\n</blockquote>\n<p>重启iptables：</p>\n<blockquote>\n<p>/etc/init.d/iptables restart</p>\n</blockquote>\n<p><strong>9.重启pptp并设置自启动</strong></p>\n<blockquote>\n<p>/etc/init.d/pptpd start     <br />chkconfig pptpd on      <br />chkconfig iptables on</p>\n</blockquote>\n<p><strong>10.客户端数据加密选择无/可选加密，请两种都试一下。</strong></p>\n<p><strong>11.发现619错误，解决如下</strong></p>\n<p>（1）如果执行cat /dev/ppp没有不存在，就执行下面，否则不执行</p>\n<blockquote>\n<p>rm -r /dev/ppp</p>\n</blockquote>\n<p>（2）执行</p>\n<blockquote>\n<p>mknod /dev/ppp c 108 0</p>\n</blockquote>\n<p><strong>修改用户名、密码或者添加用户的方法同上。 </strong></p>\n<p>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godelicious/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/delicious/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gofacebook/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/facebook/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gotwitter/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/twitter/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/gostumble/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/stumble/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/godigg/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/digg/xijie.wordpress.com/4638/\" /></a> <a href=\"http://feeds.wordpress.com/1.0/goreddit/xijie.wordpress.com/4638/\" rel=\"nofollow\"><img alt=\"\" border=\"0\" src=\"http://feeds.wordpress.com/1.0/reddit/xijie.wordpress.com/4638/\" /></a> <img alt=\"\" border=\"0\" height=\"1\" src=\"http://stats.wordpress.com/b.gif?host=xijie.wordpress.com&#038;blog=10068099&#038;post=4638&#038;subd=xijie&#038;ref=&#038;feed=1\" width=\"1\" /></p>\n<p><img src=\"http://feeds.wordpress.com/1.0/comments/xijie.wordpress.com/4638/\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":549,"categories":[15300],"tags":[8510,8795]}