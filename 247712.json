{"id":247712,"link":"https://chinadigitaltimes.net/chinese/2012/08/翻墙-ubuntu-搭建-vpn-服务/","date":"2012-08-18T10:30:15Z","modified":"2012-08-18T10:30:15Z","title":"翻墙 | Ubuntu 搭建 Vpn 服务","content":"<p><p>最近通过优惠券买了一个美国的VPS，虽然配置低了点，但是用来做平时网站的备份，或者临时当作离线下载服务器都是很不错的主意！因为国内周知的原因，访问一些国外的网站很受限制，所以想起了用自己的VPS来搭建一个VPN的想法。具体实现如下：</p>\n<p>  1. 安装pptpd，这是个VPN服务器端软件</p>\n<div>\n<div>\n<pre><span>sudo</span> <span>apt-get</span> <span>install</span> pptpd</pre>\n</p></div>\n</div>\n<p>2. 修改文件 /etc/pptpd.conf</p>\n<div>\n<div>\n<pre><span>sudo</span> <span>vi</span> <span>/</span>etc<span>/</span>pptpd.conf</pre>\n</p></div>\n</div>\n<p>找到# TAG: localip一行，在后面添加以下2行：<br />localip 192.168.0.1<br />remoteip 192.168.0.234-238,192.168.0.245<br />3. 修改文件 /etc/ppp/pptpd-options</p>\n<div>\n<div>\n<pre><span>sudo</span> <span>vi</span> <span>/</span>etc<span>/</span>ppp<span>/</span>pptpd-options</pre>\n</p></div>\n</div>\n<p>找到 #ms-dns这行，去掉前面的#号，修改成google提供的DNS server或其他DNS：<br />ms-dns 8.8.8.8<br />ms-dns 8.8.4.4<br />4. 修改文件 /etc/ppp/chap-secrets，按一行四列添加账号、服务器名、密码和IP限制。服务器名（默认 写pptpd 即可，务必与 pptpd-options 文件的name一行一样）。如创建一个名为user，密码为userpasswd，不限制登录IP的VPN账号：<br />  user pptpd userpasswd *<br />5. 修改文件 /etc/sysctl.conf，去掉这一行 #net.ipv4.ip_forward=1 的#号，开启ipv4 forward，然后运行命令：</p>\n<div>\n<div>\n<pre><span>sudo</span> sysctl �p</pre>\n</div>\n</div>\n<p>运行后会显示 net.ipv4.ip_forward = 1，就表示修改生效了。<br />  6. 使用iptables建立一个NAT</p>\n<div>\n<div>\n<pre><span>sudo</span> <span>apt-get</span> <span>install</span> iptables  iptables <span>-t</span> nat <span>-A</span> POSTROUTING <span>-s</span> 192.168.0.0<span>/</span>24 <span>-o</span> eth0 <span>-j</span> MASQUERADE</pre>\n</p></div>\n</div>\n<p>上面的24表示子网掩码，代表24个1.<br />eth0是网卡名字，可以通过命令 ifconfig 查看</p>\n<p>  为防止重启服务器后iptables丢失，先运行</p>\n<div>\n<div>\n<pre>iptables-save <span>&</span>gt; <span>/</span>etc<span>/</span>iptables-rules</pre>\n</p></div>\n</div>\n<p>然后修改文件 /etc/network/interfaces ，在eth0/eth1.. 下面加入<br />pre-up iptables-restore < /etc/iptables-rules<br />7. 现在应该就搞定了,最后重启 pptpd</p>\n<div>\n<div>\n<pre><span>sudo</span> <span>/</span>etc<span>/</span>init.d<span>/</span>pptpd restart</pre>\n</p></div>\n</div>\n<p>8. 在client端设置连接VPN进行测试，client是Ubuntu的话请看这里<br />测试是否可以连接到VPN server：</p>\n<div>\n<div>\n<pre><span>ping</span> server_IP</pre>\n</div>\n</div>\n<p>  不能的话，问题应该出在前4步。<br />测试是否可以连接到外网：（任何其他外网IP都行）</p>\n<div>\n<div>\n<pre><span>ping</span> 8.8.8.8</pre>\n</p></div>\n</div>\n<p>不能的话，问题应该出在第5-6步，看看是否正确设置了 ipv4 forward<br />测试是否可以解析DNS：</p>\n<div>\n<div>\n<pre>nslookup <a rel=\"nofollow\" target=\"_blank\" href=\"http://google.com\">google.com</a></pre>\n<pre>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://wangheng.org/setup-vpn-server.html\">http://wangheng.org/setup-vpn-server.html</a></pre>\n</p></div>\n</div>\n<div>请点击<a rel=\"nofollow\" target=\"_blank\" href=\" https://mycdt0.info\"> https://mycdt0.info</a>，穿墙访问《中国数字时代》（当看到“此网站的安全证书有问题”的提示时，请选择“继续浏览此网站(不推荐)”，忽略证书警告并继续访问网站）。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a><img width=\"1\" height=\"1\" src=\"https://blogger.googleusercontent.com/tracker/5500297126185736776-602909383758531366?l=www.chinagfw.org\" alt=\"\" /></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=b4fd4ae247\">\n定期获得翻墙信息？<a href=\"http://eepurl.com/mstlf\">请电邮订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[8510,8795,8817]}