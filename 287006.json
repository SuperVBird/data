{"id":287006,"link":"https://chinadigitaltimes.net/chinese/2013/03/翻墙-免费vpn教程之l2tp-ipsec-vpn搭建/","date":"2013-04-01T00:00:35Z","modified":"2013-04-01T00:00:35Z","title":"翻墙 | 免费vpn教程之L2TP ipsec vpn搭建","content":"<p><span></p>\n<p>前面一篇本博客已经提到&#8211;<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.seevpn.com/article-4.html\"><span>OpenVZ VPS怎样搭建PPTP VPN</span></a></p>\n<p>今天在这里给大家介绍下l2tp ipsec vpn的搭建教程。下面说下我们需要的一些载体：</p>\n<p>运行环境:centos 5.7 32bit【redhat系都可以用】</p>\n<p>1、首先安装必要的包。</p>\n</p>\n<pre>yum install -y ppp iptables make gcc gmp-devel xmlto bison flex xmlto libpcap-devel lsof vim-enhanced</pre>\n<p><span>2、下载安装openswan.</span></p>\n</p>\n<pre>wget <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.openswan.org/download/openswan-2.6.24.tar.gztar\">http://www.openswan.org/download/openswan-2.6.24.tar.gztar</a> zxvf openswan-2.6.24.tar.gz  cd openswan-2.6.24  make programs install</pre>\n<p><span>3、安装xl2tpd。[这里可能有的筒子们用的编译的，不过安装扩展源之后直接安装岂不是更方便]</span></p>\n</p>\n<pre>rpm -ivh <a rel=\"nofollow\" target=\"_blank\" href=\"http://dl.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm\">http://dl.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm</a>   [centos 5x]  rpm -ivh <a rel=\"nofollow\" target=\"_blank\" href=\"http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-7.noarch.rpm\">http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-7.noarch.rpm</a>   [centos 6x]  </pre>\n<pre>yum install xl2tpd</pre>\n<p><span>4、各种修改配置文件了。编辑 /etc/ipsec.conf 注意$vpsip替换成你机器的ip，贴出配置文件，大家修改就好了。</span></p>\n</p>\n<pre>config setup      nat_traversal=yes      virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12      oe=off      protostack=netkey     conn L2TP-PSK-NAT      rightsubnet=vhost:%priv      also=L2TP-PSK-noNAT     conn L2TP-PSK-noNAT      authby=secret      pfs=no      auto=add      keyingtries=3      rekey=no      ikelifetime=8h      keylife=1h      type=transport      left=$vpsip      leftprotoport=17/1701      right=%any      rightprotoport=17/%any</pre>\n<p><span>5、编辑 /etc/ipsec.secrets注意$vpsip替换成你机器的ip, $psk缓存你想设置的密钥</span></p>\n</p>\n<pre>$vpsip %any: PSK \"$psk\"</pre>\n<p><span>6、修改/etc/sysctl.conf，添加转发补丁等功能。注意这里的你参照你文件内容的改，没有的添加。</span></p>\n</p>\n<pre>net.ipv4.ip_forward = 1  net.ipv4.conf.default.rp_filter = 0  net.ipv4.conf.all.send_redirects = 0  net.ipv4.conf.default.send_redirects = 0  net.ipv4.conf.all.log_martians = 0  net.ipv4.conf.default.log_martians = 0  net.ipv4.conf.default.accept_source_route = 0  net.ipv4.conf.all.accept_redirects = 0  net.ipv4.conf.default.accept_redirects = 0  net.ipv4.icmp_ignore_bogus_error_responses = 1</pre>\n<p><span>7、修改完成后，运行如下命令使之生效。</span></p>\n</p>\n<pre>sysctl -p</pre>\n<p><span>8、验证ipsec运行。</span></p>\n</p>\n<pre>ipsec setup restart  ipsec verify</pre>\n<p><span>输出以下内容就表示配置成功了</span></p>\n</p>\n<pre>Checking your system to see if IPsec got installed and started correctly:  Version check and ipsec on-path                             \t[OK]  Linux Openswan U2.6.24/K2.6.32.16-linode28 (netkey)  Checking for IPsec support in kernel                        \t[OK]  NETKEY detected, testing for disabled ICMP send_redirects   \t[OK]  NETKEY detected, testing for disabled ICMP accept_redirects \t[OK]  Checking for RSA private key (/etc/ipsec.secrets)           \t[OK]  Checking that pluto is running                              \t[OK]  Pluto listening for IKE on udp 500                          \t[OK]  Pluto listening for NAT-T on udp 4500                       \t[OK]  Two or more interfaces found, checking IP forwarding        \t[OK]  Checking NAT and MASQUERADEing  Checking for 'ip' command                                   \t[OK]  Checking for 'iptables' command                             \t[OK]  Opportunistic Encryption Support                            \t[DISABLED]</pre>\n<p><span>9、编辑 /etc/xl2tpd/xl2tpd.conf</span></p>\n</p>\n<pre>[global]  ipsec saref = yes  listen-addr = $vpsip  [lns default]  ip range = 10.1.88.2-10.1.88.254      local ip = 10.1.88.1       refuse chap = yes  refuse pap = yes  require authentication = yes  ppp debug = yes  pppoptfile = /etc/ppp/options.xl2tpd  length bit = yes</pre>\n<p><span>10、编辑 /etc/ppp/options.xl2tpd</span></p>\n</p>\n<pre>require-mschap-v2  ms-dns 208.67.222.222  ms-dns 208.67.220.220  asyncmap 0  auth  crtscts  lock  hide-password  modem  debug  name l2tpd  proxyarp  lcp-echo-interval 30  lcp-echo-failure 4</pre>\n<p><span>11、设置用户名,密码:编辑 /etc/ppp/chap-secrets</span></p>\n</p>\n<pre># user server password ip  username * userpass * #改成你的用户名 密码</pre>\n<p><span>12、重启xl2tpd</span></p>\n</p>\n<pre>service xl2tpd restart</pre>\n<p><span>13、设置iptables。</span></p>\n</p>\n<pre>iptables --table nat --append POSTROUTING --jump MASQUERADE</pre>\n<pre>service iptables save  service iptables restart</pre>\n<pre>chkconfig xl2tpd on  chkconfig iptables on  chkconfig ipsec on</pre>\n<p><span>好吧，搭建完成，现在测试一下吧，有条件的筒子们可以把有限的资源提供给无尽的网络，提供免费vpn哦，如果有任何配置上的问题，可以联系我，我们共同研究！</span></p>\n<p>原文：<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.seevpn.com/article-127.html\">http://www.seevpn.com/article-127.html</a></span></p>\n<div>获取最新穿墙软件？请发电邮（最好用gmail）到：cdtcaonima@gmail.com。《中国数字时代》开通IPv6，欢迎穿墙阅读。翻越防火长城，你可以到达世界上的每一个角落。（Across the Great Firewall, you can reach every corner in the world.）翻墙利器赛风3下载地址：<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima326\n\n\"> http://dld.bz/caonima326</p>\n<p></a>，<a rel=\"nofollow\" target=\"_blank\" href=\"http://dld.bz/caonima745\">http://dld.bz/caonima745</a></div>\n</p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?hl=zh-CN&#038;formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"510\" height=\"328\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://chinadigitaltimes.us4.list-manage.com/subscribe/post?u=17daa75df533f6c6ff72e51ab&#038;id=2ea93c5b7b\">\n<a href=\"http://eepurl.com/msuvD\">墙外新闻实时更新 欢迎订阅数字时代</a><br />\n <br /><input type=\"email\" value=\"\" name=\"EMAIL\" id=\"mce-EMAIL_in_post\" size=\"25\" style=\"display:block;\" placeholder=\"请输入您的邮件地址\" required><br />\n\t<input type=\"submit\" value=\"点击订阅\" name=\"subscribe\" style=\"height: 20px;\" id=\"in_post_subscribe\"><br />\n</form>\n","author":1005,"categories":[18269,15300],"tags":[8795,8817]}