{"id":216556,"link":"https://chinadigitaltimes.net/chinese/2012/03/阮一峰-基于用户投票的排名算法（五）：威尔逊/","date":"2012-03-21T00:42:54Z","modified":"2012-03-21T00:42:54Z","title":"阮一峰 | 基于用户投票的排名算法（五）：威尔逊区间","content":"<p><p>迄今为止，这个系列都在讨论，如何给出<strong>&#8220;某个时段&#8221;</strong>的排名，比如&#8221;过去24小时最热门的文章&#8221;。</p>\n<p>但是，很多场合需要的是<strong>&#8220;所有时段&#8221;</strong>的排名，比如&#8221;最受用户好评的产品&#8221;。</p>\n<p>这时，时间因素就不需要考虑了。这个系列的最后两篇，就研究不考虑时间因素的情况下，如何给出排名。</p>\n<p>一种常见的错误算法是：</p>\n<blockquote>\n<p>　　得分 = 赞成票 &#8211; 反对票</p>\n</blockquote>\n<p>假定有两个项目，项目A是60张赞成票，40张反对票，项目B是550张赞成票，450张反对票。请问，谁应该排在前面？按照上面的公式，B会排在前面，因为它的得分（550 &#8211; 450 = 100）高于A（60 &#8211; 40 = 20）。但是实际上，B的好评率只有55%（550 / 1000），而A为60%（60 / 100），所以正确的结果应该是A排在前面。</p>\n<p>Urban Dictionary就是这种错误算法的实例。</p>\n<p>　　<img src=\"http://image.beekka.com/blog/201203/bg2012032001.png\" /></p>\n<p>另一种常见的错误算法是</p>\n<blockquote>\n<p>　　得分 =  赞成票 / 总票数</p>\n</blockquote>\n<p>如果&#8221;总票数&#8221;很大，这种算法其实是对的。问题出在如果&#8221;总票数&#8221;很少，这时就会出错。假定A有2张赞成票、0张反对票，B有100张赞成票、1张反对票。这种算法会使得A排在B前面。这显然错误。</p>\n<p>Amazon就是这种错误算法的实例。</p>\n<p>　　<img src=\"http://image.beekka.com/blog/201203/bg2012032002.png\" /></p>\n<p>那么，正确的算法是什么呢？</p>\n<p>我们先做如下设定：</p>\n<blockquote>\n<p>　　（1）每个用户的投票都是独立事件。</p>\n<p>　　（2）用户只有两个选择，要么投赞成票，要么投反对票。</p>\n<p>　　（3）如果投票总人数为n，其中赞成票为k，那么赞成票的比例p就等于k/n。</p>\n</blockquote>\n<p>如果你熟悉统计学，可能已经看出来了，p服从一种统计分布，叫做<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Binomial_distribution\">&#8220;两项分布&#8221;</a>（binomial distribution）。这很重要，下面马上要用到。</p>\n<p>我们的思路是，p越大，就代表这个项目的好评比例越高，越应该排在前面。但是，p的可信性，取决于有多少人投票，如果样本太小，p就不可信。好在我们已经知道，p服从&#8221;两项分布&#8221;，因此我们可以计算出p的置信区间。所谓<a rel=\"nofollow\" href=\"http://zh.wikipedia.org/wiki/%E7%BD%AE%E4%BF%A1%E5%8C%BA%E9%97%B4\">&#8220;置信区间&#8221;</a>，就是说，以某个概率而言，p会落在的那个区间。比如，某个产品的好评率是80%，但是这个值不一定可信。根据统计学，我们只能说，有95%的把握可以断定，好评率在75%到85%之间，即置信区间是[75%, 85%]。</p>\n<p>这样一来，排名算法就比较清晰了：</p>\n<blockquote>\n<p>　　<strong>第一步，计算每个项目的&#8221;好评率&#8221;（即赞成票的比例）。</strong></p>\n<p>　　<strong>第二步，计算每个&#8221;好评率&#8221;的置信区间（以95%的概率）。</strong></p>\n<p>　　<strong>第三步，根据置信区间的下限值，进行排名。这个值越大，排名就越高。</strong></p>\n</blockquote>\n<p>这样做的原理是，置信区间的宽窄与样本的数量有关。比如，A有8张赞成票，2张反对票；B有80张赞成票，20张反对票。这两个项目的赞成票比例都是80%，但是B的置信区间（假定[75%, 85%]）会比A（假定[70%, 90%]）窄得多，因此B的置信区间的下限值（75%）会比A（70%）大，所以B应该排在A前面。</p>\n<p>置信区间的实质，就是进行可信度的修正，弥补样本量过小的影响。如果样本多，就说明比较可信，不需要很大的修正，所以置信区间会比较窄，下限值会比较大；如果样本少，就说明不一定可信，必须进行较大的修正，所以置信区间会比较宽，下限值会比较小。</p>\n<p>二项分布的置信区间有多种计算公式，最常见的是<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Normal_approximation_interval\">&#8220;正态区间&#8221;</a>（Normal approximation interval），教科书里几乎都是这种方法。但是，它只适用于样本较多的情况（np > 5 且 n(1 − p) > 5），对于小样本，它的准确性很差。</p>\n<p>1927年，美国数学家 Edwin Bidwell Wilson提出了一个修正公式，被称为<a rel=\"nofollow\" href=\"http://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Wilson_score_interval\">&#8220;威尔逊区间&#8221;</a>，很好地解决了小样本的准确性问题。</p>\n<p>　　<img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=%5Cfrac%7B%5Chat%7Bp%7D%2B%5Cfrac%7B1%7D%7B2n%7Dz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%5Cpm%20z_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%5Csqrt%7B%5Cfrac%7B%5Chat%7Bp%7D(1-%5Chat%7Bp%7D)%7D%7Bn%7D%2B%5Cfrac%7Bz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%7D%7B4n%5E%7B2%7D%7D%7D%7D%7B1%2B%5Cfrac%7B1%7D%7Bn%7Dz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%7D&#038;chs=180\" /></p>\n<p>在上面的公式中，<img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/dfa5f703chart.png\" />表示样本的&#8221;赞成票比例&#8221;，n表示样本的大小，<img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/fd88478echart.png\" />表示对应某个置信水平的z统计量，这是一个常数，可以通过查表或统计软件包得到。一般情况下，在95%的置信水平下，z统计量的值为1.96。</p>\n<p>威尔逊置信区间的均值为</p>\n<p>　　<img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/a49518a8chart.png\" /></p>\n<p>它的下限值为</p>\n<p>　　<img src=\"http://chart.googleapis.com/chart?cht=tx&#038;chl=%5Cfrac%7B%5Chat%7Bp%7D%2B%5Cfrac%7B1%7D%7B2n%7Dz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D-z_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%5Csqrt%7B%5Cfrac%7B%5Chat%7Bp%7D(1-%5Chat%7Bp%7D)%7D%7Bn%7D%2B%5Cfrac%7Bz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%7D%7B4n%5E%7B2%7D%7D%7D%7D%7B1%2B%5Cfrac%7B1%7D%7Bn%7Dz%5E%7B2%7D_%7B1-%5Cfrac%7B%5Calpha%7D%7B2%7D%7D%7D&#038;chs=150\" /></p>\n<p>可以看到，当n的值足够大时，这个下限值会趋向<img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/dfa5f703chart.png\" />。如果n非常小（投票人很少），这个下限值会大大小于<img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/dfa5f703chart.png\" />。实际上，起到了降低&#8221;赞成票比例&#8221;的作用，使得该项目的得分变小、排名下降。</p>\n<p>Reddit的评论排名，目前就使用这个算法。</p>\n<p>　　<img src=\"http://image.beekka.com/blog/201203/bg2012032003.png\" /></p>\n<p>[参考文献]</p>\n<p>　　* <a rel=\"nofollow\" href=\"http://www.evanmiller.org/how-not-to-sort-by-average-rating.html\">How Not To Sort By Average Rating</a></p>\n<p>（完）</p>\n<div>\n<h3>文档信息</h3>\n<ul>\n<li>版权声明：自由转载-非商用-非衍生-保持署名 | <a rel=\"nofollow\" href=\"http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh\">Creative Commons BY-NC-ND 3.0</a></li>\n<li>原文网址：<a rel=\"nofollow\" href=\"http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_wilson_score_interval.html\">http://www.ruanyifeng.com/blog/2012/03/ranking_algorithm_wilson_score_interval.html</a></li>\n<li>最后修改时间：2012年3月20日 02:56</li>\n<li>付费支持：<a rel=\"nofollow\" href=\"https://mai.alipay.com/p.htm?id=2012010602227616\"><img alt=\"支付宝担保交易\" src=\"http://chinadigitaltimes.net/chinese/files/2012/03/3a976ef2rmb_32.png.png\" /></a> | <a rel=\"nofollow\" href=\"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&#038;business=yifeng.ruan@gmail.com&#038;currency_code=USD&#038;amount=2.99&#038;return=http://www.ruanyifeng.com/thank.html&#038;item_name=Ruan%20YiFeng's%20Blog&#038;undefined_quantity=1&#038;no_note=0\"><img alt=\"paypal\" src=\"http://chinadigitaltimes.net/chinese/files/2012/03/5ca83e43dollar_32.png.png\" /></a> </li>\n</ul>\n</div>\n<div>\n<p><a rel=\"nofollow\" href=\"http://yipinzao.com/\"><img src=\"http://www.ruanyifeng.com/blog/images/ad_yipinzao.jpg\" /></a></p>\n</div>\n<p><img src=\"http://chinadigitaltimes.net/chinese/files/2012/03/919a5805g2012032001.png-150x150.png\" /></p>\n<p><small>本文由自动聚合程序取自网络，内容和观点不代表数字时代立场</small></p>\n<p><iframe src=\"https://docs.google.com/spreadsheet/embeddedform?formkey=dGRpN3FrVThuMFFsZHBZcmNGLW94dEE6MQ\" width=\"450\" height=\"309\" frameborder=\"0\" marginheight=\"0\" marginwidth=\"0\">Loading&#8230;</iframe></p>\n<form method=\"POST\" action=\"http://www.feedblitz.com/f/f.fbz?AddNewUserDirect\">\n定期获得翻墙信息？<a href=\"http://www.feedblitz.com/f/?Sub=750556\">请电邮订阅数字时代</a> <br /><input name=\"EMAIL\" maxlength=\"64\" type=\"text\" size=\"25\" value=\"\"><br />\n<input name=\"FEEDID\" type=\"hidden\" value=\"750556\"><br />\n<input name=\"PUBLISHER\" type=\"hidden\" value=\"7485568\"><br />\n<input type=\"submit\" value=\"订阅!\"><br />\n</form>\n","author":1004,"categories":[9203],"tags":[5908,9400,8795]}